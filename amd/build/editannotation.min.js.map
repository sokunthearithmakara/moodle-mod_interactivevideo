{"version":3,"file":"editannotation.min.js","sources":["../src/editannotation.js"],"sourcesContent":["/* eslint-disable complexity */\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Edit interactions module\n *\n * @module     mod_interactivevideo/editannotation\n * @copyright  2024 Sokunthearith Makara <sokunthearithmakara@gmail.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport $ from 'jquery';\nimport {add as addToast} from 'core/toast';\nimport Notification from 'core/notification';\nimport {dispatchEvent} from 'core/event_dispatcher';\nimport quickform from './quickform';\nimport ModalEvents from 'core/modal_events';\nimport './libraries/jquery-ui';\n\nlet ModalFactory;\nlet ctRenderer = {};\nlet player;\nlet totaltime;\nlet currentTime;\nlet playerReady = false;\nconst isRTL = $('html').attr('dir') == 'rtl';\nconst isBS5 = $('body').hasClass('bs-5');\nconst bsAffix = isBS5 ? '-bs' : '';\nlet $loader = $('#background-loading');\nlet $progressbar = $('#video-nav #progress');\nlet $scrollbar = $('#scrollbar');\nlet $scrollhead = $('#scrollhead-top');\nlet $videonav = $('#video-nav');\n/**\n * Replace the progress bar on the video navigation.\n * @param {Number} percentage - Percentage to replace the progress bar.\n * @returns {void}\n * */\nconst replaceProgressBars = (percentage) => {\n    percentage = percentage < 0 ? 0 : percentage;\n    percentage = percentage > 100 ? 100 : percentage;\n    $progressbar.css('width', percentage + '%');\n    $scrollbar.css('left', percentage + '%');\n    $scrollhead.css('left', percentage + '%');\n};\n/**\n * Render the annotations on the video navigation.\n * @param {Array} annos - Annotations to render.\n * @param {Number} start - Start time of the video.\n * @param {Number} totaltime - Total time of the video.\n * @returns {void}\n * */\nconst renderVideoNav = async function(annos, start, totaltime) {\n    if (annos.length == 0) {\n        $videonav.find('ul').empty();\n        return;\n    }\n\n    $videonav.find('ul').empty();\n    $(\"#video-timeline-wrapper .skipsegment\").remove();\n    annos.forEach(async(x) => {\n        const render = ctRenderer[x.type];\n        await render.renderItemOnVideoNavigation(x);\n    });\n\n    const time = await player.getCurrentTime();\n    // Replace progress bar.\n    const percentage = (time - start) / totaltime * 100;\n    replaceProgressBars(percentage);\n    dispatchEvent('annotationitemsrendered', {'annotations': annos});\n};\n\nexport default {\n    /**\n     * Initialize function on page loads.\n     * @param {String} url video url\n     * @param {Number} coursemodule cm id\n     * @param {Number} interaction cm instance\n     * @param {Number} course course id\n     * @param {Number} start video start time\n     * @param {Number} end video end time\n     * @param {Number} coursecontextid course context id\n     * @param {String} type video type\n     * @param {Object} displayoptions display options\n     * @param {Number} userid user id\n     * @param {String} posterimage poster image\n     * @param {String} extendedcompletion extended completion\n     */\n    init: async function(url, coursemodule, interaction, course, start, end, coursecontextid,\n        type = 'yt', displayoptions, userid, posterimage, extendedcompletion) {\n\n        if (!ModalFactory) {\n            try {\n                ModalFactory = await import('core/modal_factory');\n            } catch (error) {\n                ModalFactory = await import('core/modal');\n            }\n        }\n        displayoptions = $('#doptions').length > 0 ? JSON.parse($('#doptions').text()) : displayoptions;\n\n        let $videonav = $('#video-nav');\n        let $videotimeline = $('#video-timeline');\n        let $annotationlist = $('#annotation-list');\n        let $annotationcanvas = $('#annotation-canvas');\n        let $timelinewrapper = $('#timeline-wrapper');\n        let $videowrapper = $('#video-wrapper');\n        let $playpause = $('#playpause');\n        let $timelineitemswrapper = $('#timeline-items-wrapper');\n        let $addcontent = $('#addcontent');\n\n        quickform();\n\n        require(['theme_boost/bootstrap/modal']);\n        require(['theme_boost/bootstrap/tooltip']);\n        /**\n         * Util function to display notification\n         * @param {String} msg message text\n         * @param {String} type message type\n         */\n        const addNotification = (msg, type = \"info\") => {\n            addToast(msg, {\n                type: type\n            });\n        };\n\n        start = Number(start);\n        if (isNaN(start)) {\n            start = 0;\n        }\n\n        end = Number(end);\n        if (isNaN(end)) {\n            end = null;\n        }\n\n        let annotations = []; // Annotations.\n        let contentTypes; // Content types.\n\n        /**\n         * Convert seconds to HH:MM:SS format\n         * @param {Number} s second\n         * @param {Boolean} dynamic if true, only show minutes and seconds if less than one hour\n         * @param {Boolean} rounded if true, second is rounded\n         * @returns formatted timestamp\n         */\n        const convertSecondsToHMS = (s, dynamic = false, rounded = true) => {\n            if (rounded) {\n                s = Math.round(s);\n            }\n            let hours = Math.floor(s / 3600);\n            let minutes = Math.floor((s - hours * 3600) / 60);\n            let seconds = s - hours * 3600 - minutes * 60;\n            if (rounded && seconds > 59.5) {\n                seconds = 0;\n                minutes++;\n                if (minutes > 59) {\n                    minutes = 0;\n                    hours++;\n                }\n            }\n            if (minutes < 10) {\n                minutes = '0' + minutes;\n            }\n\n            if (rounded) {\n                seconds = Math.round(seconds);\n            } else {\n                seconds = parseFloat(seconds).toFixed(2);\n            }\n\n            if (seconds < 10) {\n                seconds = '0' + seconds;\n            }\n\n            if (dynamic && hours == 0) {\n                return minutes + ':' + seconds;\n            }\n\n            return (hours < 10 ? '0' + hours : hours) + ':' + minutes + ':' + seconds;\n        };\n\n        let activeid = null; // Current active annotation id. Mainly used when editing to relaunch the interaction afte editing.\n\n        /**\n         * Handle rendering of annotation items on the list\n         * @param {Array} annotations array of annotation objects\n         * @returns\n         */\n        const renderAnnotationItems = (annotations) => {\n            $('#annotationwrapper .loader').remove();\n            $annotationlist.empty().removeClass(\"d-flex align-items-center justify-content-center\");\n            if (player.live) {\n                $timelinewrapper.addClass('no-pointer-events');\n                $annotationlist.html(\n                    `${M.util.get_string('interactionsnotsupportedonlivevideo', 'mod_interactivevideo')}`)\n                    .addClass(\"d-flex align-items-center justify-content-center\");\n                return;\n            }\n            renderVideoNav(annotations, start, totaltime);\n            if (annotations.length == 0) {\n                $annotationlist.html(`${M.util.get_string('clickaddtoaddinteraction', 'mod_interactivevideo')}`)\n                    .addClass(\"d-flex align-items-center justify-content-center\");\n                return;\n            }\n            annotations.sort(function(a, b) {\n                // First sort by timestamp, then by type.\n                if (Number(a.timestamp) === Number(b.timestamp)) {\n                    return String(a.type).localeCompare(String(b.type));\n                }\n                // Sort by timestamp.\n                return Number(a.timestamp) - Number(b.timestamp);\n            });\n\n            annotations.forEach(function(item) {\n                let listItem = $('#annotation-template').clone();\n                try {\n                    ctRenderer[item.type].renderEditItem(annotations, listItem, item);\n                } catch (e) {\n                    window.console.error(e, item);\n                }\n            });\n\n            let xp = annotations.filter(x => x.xp).map(x => Number(x.xp)).reduce((a, b) => a + b, 0);\n            $(\"#xp span\").text(xp);\n\n            if (activeid) {\n                const activeAnno = annotations.find(x => x.id == activeid);\n                if (activeAnno) {\n                    ctRenderer[activeAnno.type].postEditCallback(activeAnno);\n                }\n            }\n        };\n\n        /**\n         * Get annotations from the server and execute the rendering function\n         * @returns\n         */\n        const getAnnotations = () => {\n            const getItems = $.ajax({\n                url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                method: \"POST\",\n                dataType: \"text\",\n                data: {\n                    action: 'get_items',\n                    sesskey: M.cfg.sesskey,\n                    id: interaction,\n                    contextid: M.cfg.contextid,\n                    coursecontextid: M.cfg.courseContextId\n                }\n            });\n\n            const getContentTypes = $.ajax({\n                url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                method: \"POST\",\n                dataType: \"text\",\n                data: {\n                    action: 'get_all_contenttypes',\n                    sesskey: M.cfg.sesskey,\n                    contextid: M.cfg.contextid,\n                    coursecontextid: M.cfg.courseContextId\n                }\n            });\n\n            $.when(getItems, getContentTypes).done(async function(items, contenttypes) {\n                annotations = JSON.parse(items[0]);\n                if (player.live) {\n                    annotations = [];\n                }\n                contentTypes = JSON.parse(contenttypes[0]);\n                // Remove all annotations that are not in the enabled content types.\n                annotations = annotations.filter(x => contentTypes.find(y => y.name === x.type));\n                const getRenderers = new Promise((resolve) => {\n                    let count = 0;\n                    contentTypes.forEach(x => {\n                        require(['' + x.amdmodule], function(Type) {\n                            ctRenderer[x.name] = new Type(player, annotations, interaction,\n                                course, 0, 0, 0, 0, type, 0, totaltime, start, end, x, coursemodule,\n                                null, displayoptions, null, extendedcompletion, {\n                                isEditMode: true,\n                            });\n                            count++;\n                            ctRenderer[x.name].init();\n                            if (count == contentTypes.length) {\n                                resolve(ctRenderer);\n                            }\n                        });\n                    });\n                });\n                annotations.map(x => {\n                    let prop = contentTypes.find(y => y.name === x.type);\n                    // Clean up the prop by removing author, authorlink, description;\n                    delete prop.author;\n                    delete prop.authorlink;\n                    delete prop.description;\n                    x.prop = JSON.stringify(prop);\n                    x.editMode = true;\n                    return x;\n                });\n                ctRenderer = await getRenderers;\n                renderAnnotationItems(annotations);\n            });\n        };\n\n        /**\n         * Validate given timestamp against format\n         * @param {String} timestamp formatted timestamp hh:mm:ss\n         * @param {String} fld field selector\n         * @param {String} existing existing value\n         * @returns\n         */\n        const validateTimestampFormat = (timestamp, fld, existing) => {\n            const regex = /^([0-9]{2}):([0-5][0-9]):([0-5][0-9])(\\.\\d{2})?$/;\n            if (!regex.test(timestamp)) {\n                addNotification(M.util.get_string('invalidtimestampformat', 'mod_interactivevideo'), 'danger');\n                if (existing) {\n                    $(fld).val(existing);\n                } else {\n                    $(fld).val(convertSecondsToHMS(start, false, false));\n                }\n                return false;\n            }\n            return true;\n        };\n\n        /**\n         * Validate timestamp against start and end time of the video, existing timestamp and skip segments\n         * @param {String} timestamp formatted timestamp\n         * @param {String} fld field selector\n         * @param {String} existing existing value\n         * @param {Number} seconds\n         * @param {Boolean} checkduration if true, check against start and end time\n         * @param {Boolean} checkexisting if true, check against existing annotations\n         * @param {Boolean} checkskipsegment if true, check against skip segments\n         * @returns\n         */\n        const validateTimeStartEnd = (timestamp, fld, existing, seconds, checkduration,\n            checkexisting, checkskipsegment) => {\n            // Convert the timestamp to seconds.\n            const parts = timestamp.split(':');\n            timestamp = Number(parts[0]) * 3600 + Number(parts[1]) * 60 + Number(parts[2]);\n            // Make sure the timestamp is between start and end.\n            if (checkduration) {\n                if (timestamp > end || timestamp < start) {\n                    const message = M.util.get_string('timemustbebetweenstartandendtime', 'mod_interactivevideo', {\n                        \"start\": convertSecondsToHMS(start, true, false),\n                        \"end\": convertSecondsToHMS(end, true, false)\n                    });\n                    addNotification(message, 'danger');\n                    if (existing) {\n                        $(fld).val(existing);\n                    } else {\n                        $(fld).val(convertSecondsToHMS(start, false, false));\n                    }\n                    return -1;\n                }\n            }\n\n            // Make sure the timestamp is not already in the list.\n            if (checkexisting) {\n                if (annotations.find(x => x.timestamp == timestamp) && timestamp != seconds) {\n                    addNotification(M.util.get_string('interactionalreadyexists', 'mod_interactivevideo'), 'danger');\n                    if (existing) {\n                        $(fld).val(existing);\n                    } else {\n                        $(fld).val(convertSecondsToHMS(start, false, false));\n                    }\n                    return -1;\n                }\n            }\n\n            // Make sure timestamp is not in a skip segment.\n            if (checkskipsegment) {\n                const skipsegments = annotations.filter((annotation) => annotation.type == 'skipsegment');\n                const skip = skipsegments.find(x => Number(x.timestamp) < Number(timestamp)\n                    && Number(x.title) > Number(timestamp));\n                if (skip) {\n                    addNotification(M.util.get_string('interactionisbetweentheskipsegment', 'mod_interactivevideo', {\n                        \"start\": convertSecondsToHMS(skip.timestamp, true, false),\n                        \"end\": convertSecondsToHMS(skip.title, true, false)\n                    }), 'danger');\n                    if (existing) {\n                        $(fld).val(existing);\n                    } else {\n                        $(fld).val(convertSecondsToHMS(start, false, false));\n                    }\n                    return -1;\n                }\n            }\n\n            return timestamp;\n        };\n\n        /**\n         * Run interaction\n         * @param {Object} annotation annotation object\n         */\n        const runInteraction = (annotation) => {\n            // Remove the previous message but keep the one below the video.\n            $('#annotation-modal').modal('hide');\n            $('#message').not('[data-placement=bottom]').not('.sticky').remove();\n            $('#end-screen').remove();\n            player.pause();\n            const activityType = ctRenderer[annotation.type];\n            activityType.runInteraction(annotation);\n        };\n\n        /**\n         * Correct the start and end time.\n         * @param {Number} duration Total duration of the video.\n         * @returns {Object} Object containing start and end time.\n         */\n        const updateTime = async(duration) => {\n            duration = Number(duration);\n            let toUpdatetime = false;\n            if (!end || end == 0) {\n                toUpdatetime = true;\n            }\n            if (!start || start >= duration || start < 0 || start >= duration) {\n                toUpdatetime = true;\n            }\n            start = start > duration ? 0 : start;\n            if (toUpdatetime) {\n                await $.ajax({\n                    url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                    method: \"POST\",\n                    dataType: \"text\",\n                    data: {\n                        action: 'update_videotime',\n                        sesskey: M.cfg.sesskey,\n                        cmid: coursemodule,\n                        courseid: course,\n                        id: interaction,\n                        start: start,\n                        end: !end || end == 0 ? duration : end,\n                        contextid: M.cfg.contextid\n                    }\n                });\n            }\n            end = !end || end == 0 || end > duration ? duration : end;\n            return {start, end};\n        };\n\n        /**\n         * Set of events to run after the video player is ready.\n         */\n        const onReady = async() => {\n            if (player.live) {\n                end = Number.MAX_SAFE_INTEGER;\n            }\n            if (player.type != 'yt') {\n                player.pause();\n            }\n            const isPaused = await player.isPaused();\n            if (!isPaused) {\n                if (!player.live) {\n                    await player.seek(start);\n                }\n                player.pause();\n                onReady();\n                return;\n            }\n            player.unMute();\n            if (player.audio) {\n                $annotationcanvas.addClass('bg-black');\n            }\n            if (displayoptions.passwordprotected == 1) {\n                // Remove start screen, set .video-block to d-none, #annotation-canvas remove d-none.\n                $('#start-screen').removeClass('d-none');\n                $('#video-block').removeClass('no-pointer bg-transparent');\n            }\n            if (player.type != 'vimeo'\n                && player.type != 'html5video'\n                && player.type != 'panopto'\n                && player.type != \"peertube\"\n                && player.type != \"dyntube\"\n                && player.type != \"rutube\") { // Vimeo/HTML5 does not pause/play on click.\n                $('#video-block').addClass('no-pointer');\n            }\n\n            if (player.support.playbackrate == false) {\n                $('#changerate').remove();\n            } else {\n                $('#changerate').removeClass('d-none');\n            }\n\n            if (player.support.quality == false) {\n                $('#changequality').remove();\n            } else {\n                $('#changequality').removeClass('d-none');\n            }\n\n            let t = player.totaltime;\n\n            ({start, end} = await updateTime(t));\n\n            totaltime = end - start;\n            // Recalculate the ratio of the video.\n            let ratio = 16 / 9;\n            if (!displayoptions.usefixedratio || displayoptions.usefixedratio == 0) {\n                ratio = player.aspectratio;\n            }\n            $videowrapper.css('padding-bottom', (1 / ratio) * 100 + '%');\n\n            playerReady = true;\n            $annotationcanvas.removeClass('d-none w-0');\n\n            // Handle timeline block.\n            $videotimeline.css({\n                'background-image': 'url(' + posterimage + ')',\n                'background-size': 'contain',\n                'background-repeat': 'no-repeat',\n            });\n            $timelinewrapper.find('#duration').text(convertSecondsToHMS(end, true));\n            $timelinewrapper.find('#currenttime').text(convertSecondsToHMS(start, true));\n\n            // Render minute markers.\n            const minutes = Math.floor(totaltime / 60);\n            $timelineitemswrapper.css('width', (minutes * 300) + 'px'); // 300px per minute as default.\n            const relWidth = $('#timeline-items').width();\n            $('#minute-markers, #minute-markers-bg, #vseek').css('width', relWidth + 'px');\n            let startPercentage = 0;\n            let newStart = start;\n            if (start % 60 != 0) {\n                startPercentage = (60 - (start % 60)) / totaltime * 100;\n                newStart = start + (60 - (start % 60));\n                $('#minute-markers, #minute-markers-bg').append(`<div class=\"minute-marker position-absolute\"\n                        style=\"left: 0%;\"><div class=\"text-white minute-label\"></div></div>`);\n            }\n            for (let i = newStart; i <= end; i += 60) {\n                let percentage = ((i - newStart) / totaltime * 100) + startPercentage;\n                let marker = '';\n                // Format h:m (e.g 3h1m).\n                if (i >= 3600) {\n                    marker = Math.floor(i / 3600) + 'h' + Math.floor((i % 3600) / 60) + 'm';\n                } else {\n                    marker = Math.floor(i / 60) + 'm';\n                }\n                $('#minute-markers').append(`<div class=\"minute-marker position-absolute\"\n                         style=\"left: ${percentage}%;\"><div class=\"text-white minute-label\">${marker}</div></div>`);\n                $('#minute-markers-bg').append(`<div class=\"minute-marker position-absolute\"\n                            style=\"left: ${percentage}%;\"></div>`);\n            }\n\n            if (end % 60 != 0) {\n                $('#minute-markers, #minute-markers-bg').append(`<div class=\"minute-marker position-absolute\"\n                        style=\"left: 100%;\"><div class=\"text-white minute-label\"></div></div>`);\n            }\n\n            // Set caption to null.\n            try {\n                player.setCaption('');\n            } catch (e) {\n                // Do nothing.\n            }\n\n            $scrollbar.css('left', 0);\n            $scrollhead.css('left', 0);\n\n            getAnnotations();\n        };\n\n        /**\n         * Run when video ended (i.e. arrives at 'end' time)\n         */\n        const onEnded = () => {\n            player.pause();\n            $playpause.find('i').removeClass('bi-pause-fill').addClass('bi-play-fill').toggleClass('rotate-360');\n            // Cover the video with a message on a white background div.\n            $videowrapper.append(`<div id=\"end-screen\" class=\"border position-absolute w-100 h-100 bg-white d-flex\n                     justify-content-center align-items-center\" style=\"top: 0; left: 0;\">\n                     <button class=\"btn btn-danger border-0 iv-rounded-circle\" style=\"font-size: 1.5rem;\" id=\"restart\">\n                    <i class=\"bi bi-arrow-repeat\" style=\"font-size: x-large;\"></i></button></div>`);\n            $progressbar.css('width', '100%');\n            $scrollbar.css('left', '100%');\n            $scrollhead.css('left', '100%');\n            // Focus on the restart button.\n            $('#message #restart').focus();\n\n            // If the current time matches the timestamp of an annotation, highlight the annotation.\n            const currentAnnotation = annotations.find((annotation) => annotation.timestamp == end);\n            if (currentAnnotation) {\n                $annotationlist.find('tr').removeClass('active');\n                $annotationlist.find('tr[data-id=\"' + currentAnnotation.id + '\"]').addClass('active');\n                // Show tooltip for two seconds.\n                $videonav.find('.annotation[data-id=\"' + currentAnnotation.id + '\"] .item').tooltip('show');\n                setTimeout(function() {\n                    $videonav.find('.annotation[data-id=\"' + currentAnnotation.id + '\"] .item').tooltip('hide');\n                }, 2000);\n            }\n        };\n\n        /**\n         * Execute when video is sought\n         * @param {Number} t seconds\n         * @returns\n         */\n        const onSeek = async function(t) {\n            if (!playerReady) {\n                return;\n            }\n            if (t) {\n                t = Number(t);\n            } else {\n                t = await player.getCurrentTime();\n            }\n            if (t > start && t < end) {\n                $('#end-screen').remove();\n            }\n            const percentage = (t - start) / (totaltime) * 100;\n            $scrollbar.css('left', percentage + '%');\n            $scrollhead.css('left', percentage + '%');\n            $timelinewrapper.find('#currenttime').text(convertSecondsToHMS(t, true));\n            dispatchEvent('timeupdate', {'time': t});\n        };\n\n        let onPlayingInterval;\n        let visualized = false;\n        /**\n         * Excute when video plays (i.e. start or resume)\n         */\n        const onPlaying = async() => {\n            if (player.live) {\n                return;\n            }\n            const intervalFunction = async function() {\n                let thisTime = await player.getCurrentTime();\n                const isPlaying = await player.isPlaying();\n                const isEnded = await player.isEnded();\n                if (!isPlaying) {\n                    cancelAnimationFrame(onPlayingInterval);\n                    return;\n                }\n\n                if (thisTime < start) {\n                    await player.seek(start);\n                    thisTime = start;\n                }\n\n                if (thisTime >= end || isEnded) {\n                    player.stop(end);\n                    cancelAnimationFrame(onPlayingInterval);\n                    onEnded();\n                    return;\n                }\n                dispatchEvent('timeupdate', {'time': thisTime});\n                let percentage = (thisTime - start) / (totaltime) * 100;\n                // Scroll the timeline so that the current time is in the middle of the timeline.\n                const scrollBar = document.getElementById('scrollbar');\n                // Check if the scrollbar is in view.\n                const rect = scrollBar.getBoundingClientRect();\n                if (rect.left < 0 || rect.right > window.innerWidth) {\n                    scrollBar.scrollIntoView({behavior: \"instant\", block: \"center\", inline: \"center\"});\n                }\n\n                // If the current time matches the timestamp of an annotation, highlight the annotation\n                const currentAnnotation = annotations.find(x => (thisTime - player.frequency) <= x.timestamp\n                    && (thisTime + player.frequency) >= x.timestamp);\n                if (currentAnnotation) {\n                    $annotationlist.find(`tr:not([data-id=\"${currentAnnotation.id}\"])`).removeClass('active');\n                    if (!$annotationlist.find(`tr[data-id=\"${currentAnnotation.id}\"]`).hasClass('active')) {\n                        $annotationlist.find(`tr[data-id=\"${currentAnnotation.id}\"]`)\n                            .addClass('active')\n                            .trigger('mouseenter');\n                        setTimeout(function() {\n                            $annotationlist.find(`tr[data-id=\"${currentAnnotation.id}\"]`).trigger('mouseleave');\n                        }, 2000);\n                    }\n                }\n\n                // If current time is within the skipsegment, seek to the end of the segment.\n                let skipsegments = annotations.filter((annotation) => annotation.type == 'skipsegment');\n                let skip = skipsegments.find(x => Number(x.timestamp) < Number(thisTime)\n                    && Number(x.title) > Number(thisTime));\n                if (skip) {\n                    await player.seek(Number(skip.title));\n                    // Replace the progress bar.\n                    percentage = (skip.title - start) / totaltime * 100;\n                    replaceProgressBars(percentage);\n                }\n            };\n            if (player.useAnimationFrame) {\n                const animate = async() => {\n                    const isPlaying = await player.isPlaying();\n                    if (isPlaying) {\n                        intervalFunction();\n                        onPlayingInterval = requestAnimationFrame(animate);\n                    }\n                };\n                onPlayingInterval = requestAnimationFrame(animate);\n            } else {\n                const isPlaying = await player.isPlaying();\n                if (isPlaying) {\n                    intervalFunction();\n                }\n            }\n        };\n\n        const onplay = async() => {\n            $('#message, #end-screen').not('.sticky').remove();\n            $playpause.find('i').removeClass('bi-play-fill').addClass('bi-pause-fill').removeClass('rotate-360');\n            if (player.audio && !visualized) {\n                player.visualizer();\n                visualized = true;\n            }\n        };\n\n        /**\n         * Excute when video is paused.\n         */\n        const onPause = () => {\n            cancelAnimationFrame(onPlayingInterval);\n            $playpause.find('i').removeClass('bi-pause-fill').addClass('bi-play-fill').toggleClass('rotate-360');\n        };\n\n        // Implement the player\n        require(['mod_interactivevideo/player/' + type], function(VideoPlayer) {\n            if (displayoptions.passwordprotected == 1) {\n                // Remove start screen, set .video-block to d-none, #annotation-canvas remove d-none.\n                $('#video-block').addClass('no-pointer bg-transparent');\n                $annotationcanvas.removeClass('d-none w-0');\n            }\n            player = new VideoPlayer();\n            player.load(\n                url,\n                start,\n                end,\n                {\n                    'customStart': true,\n                    'passwordprotected': displayoptions.passwordprotected == 1,\n                    'showControls': false,\n                    'keyboard': true,\n                }\n            );\n            window.IVPLAYER = player;\n        });\n\n        $(document).one('iv:playerReady', function() {\n            onReady();\n        });\n\n        $(document).on('iv:playerPaused', function() {\n            onPause();\n        });\n\n        $(document).on('iv:playerPlaying', function() {\n            onPlaying();\n        });\n\n        $(document).on('iv:playerPlay', function() {\n            onplay();\n        });\n\n        $(document).on('iv:playerEnded', function() {\n            onEnded();\n        });\n\n        $(document).on('iv:playerSeek', function(e) {\n            onSeek(e.detail.time);\n        });\n\n        $(document).on('iv:playerError', function() {\n            $annotationcanvas.removeClass('d-none w-0');\n            $('#start-screen').addClass('d-none');\n            $('#video-block').addClass('no-pointer bg-transparent');\n            $('#spinner').remove();\n            $('.loader').removeClass('loader');\n            if ($('#player').is(':empty')) {\n                $('#player').html(`<div class=\"alert alert-danger d-flex text-center h-100 rounded-0\n                         align-items-center justify-content-center\">\n                        <img src=\"${M.cfg.wwwroot}/mod/interactivevideo/pix/404-error.png\" alt=\"Error\" class=\"w-25\">\n                        </div>`);\n            } else {\n                addNotification(M.util.get_string('thereisanissueloadingvideo', 'mod_interactivevideo'), 'danger');\n            }\n        });\n\n        $(document).on('timeupdate', function(e) {\n            if (!playerReady) {\n                player.pause();\n                return;\n            }\n            const thisTime = e.detail.time;\n            $timelinewrapper.find('#currenttime').text(convertSecondsToHMS(thisTime, true));\n            let percentage = (thisTime - start) / (totaltime) * 100;\n            replaceProgressBars(percentage);\n        });\n\n        // Post annotation update (add, edit, clone).\n        $(document).on('annotationupdated', function(e) {\n            // Remove any tooltips that may be open.\n            $('.tooltip').remove();\n            $.ajax({\n                url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                method: \"POST\",\n                dataType: \"text\",\n                data: {\n                    action: 'update_ivitems_cache',\n                    sesskey: M.cfg.sesskey,\n                    contextid: M.cfg.contextid,\n                    cmid: interaction,\n                },\n            });\n            if ($('#annotation-list-bulk-edit').hasClass('active')) {\n                $('#annotation-list-bulk-edit').trigger('click');\n            }\n            const action = e.originalEvent.detail.action;\n            if (action == 'import') {\n                annotations = e.originalEvent.detail.annotations;\n                renderAnnotationItems(annotations);\n                addNotification(M.util.get_string('interactionimported', 'mod_interactivevideo'), 'success');\n                return;\n            }\n            let updated = e.originalEvent.detail.annotation;\n            if (action == 'edit' || action == 'draft' || action == 'savedraft') {\n                annotations = annotations.filter(function(item) {\n                    return item.id != updated.id;\n                });\n            }\n            updated.prop = JSON.stringify(contentTypes.find(x => x.name === updated.type));\n            annotations.push(updated);\n            if (action == 'add') {\n                activeid = updated.id;\n            } else {\n                activeid = null;\n            }\n            annotations.map(x => {\n                x.editMode = true;\n                return x;\n            });\n            renderAnnotationItems(annotations);\n            if (action == 'add' || action == 'clone') {\n                addNotification(M.util.get_string('interactionadded', 'mod_interactivevideo'), 'success');\n                $annotationlist.find(`tr[data-id=\"${updated.id}\"]`).addClass('active');\n            } else if (action == 'edit') {\n                addNotification(M.util.get_string('interactionupdated', 'mod_interactivevideo'), 'success');\n                $annotationlist.find(`tr[data-id=\"${updated.id}\"]`).addClass('active');\n                setTimeout(function() {\n                    $annotationlist.find(`tr[data-id=\"${updated.id}\"]`).removeClass('active');\n                }, 1500);\n            }\n\n            // If draft exists, activate the save button.\n            if (annotations.find(x => x.status == 'draft')) {\n                $timelinewrapper.find('#savedraft').removeAttr('disabled').addClass('pulse');\n            } else {\n                $timelinewrapper.find('#savedraft').attr('disabled', 'disabled').removeClass('pulse');\n            }\n\n        });\n\n        // Re-render annotation list and timeline after an annotation is deleted.\n        $(document).on('annotationdeleted', function(e) {\n            // Remove any tooltips that may be open.\n            $('.tooltip').remove();\n            const annotation = e.originalEvent.detail.annotation;\n            activeid = null;\n            $annotationlist.find(`tr[data-id=\"${annotation.id}\"]`).addClass('deleted');\n            setTimeout(function() {\n                annotations = annotations.filter(function(item) {\n                    return item.id != annotation.id;\n                });\n                renderAnnotationItems(annotations);\n                addNotification(M.util.get_string('interactiondeleted', 'mod_interactivevideo'), 'success');\n            }, 1000);\n            if ($($('#annotation-list-bulk-edit')).hasClass('active')) {\n                $('#annotation-list-bulk-edit').trigger('click');\n            }\n        });\n\n        // Implement create annotation\n        $(document).on('click', '#addcontentdropdown .dropdown-item', async function(e) {\n            if (!playerReady) {\n                return;\n            }\n            $('#addcontentdropdown .dropdown-item').removeClass('active');\n            // Check if the target item is a link.\n            if ($(e.target).is('a')) {\n                return;\n            }\n\n            const ctype = $(this).data('type');\n            player.pause();\n            let timestamp = currentTime || await player.getCurrentTime();\n            timestamp = Number(timestamp.toFixed(2));\n            const contenttype = contentTypes.find(x => x.name == ctype);\n            if (contenttype.hastimestamp) {\n                if (annotations.find(x => x.timestamp == timestamp)) {\n                    addNotification(M.util.get_string('interactionalreadyexists', 'mod_interactivevideo'), 'danger');\n                    return;\n                }\n                // Check skip segments\n                const skipsegments = annotations.filter(x => x.type == 'skipsegment');\n                const skip = skipsegments.find(x => Number(x.timestamp) < Number(currentTime)\n                    && Number(x.title) > Number(currentTime));\n                if (skip) {\n                    addNotification(M.util.get_string('interactionisbetweentheskipsegment', 'mod_interactivevideo'), 'danger');\n                    return;\n                }\n            }\n            if (!contenttype.allowmultiple && annotations.find(x => x.type == ctype)) {\n                addNotification(M.util.get_string(\n                    'thisinteractionalreadyexists', 'mod_interactivevideo', contenttype.title), 'danger');\n                return;\n            }\n            currentTime = null;\n            ctRenderer[ctype].addAnnotation(annotations, contenttype.hastimestamp ? timestamp : -1, coursemodule);\n        });\n\n        // Implement edit annotation\n        $(document).on('click', 'tr.annotation .edit', async function(e) {\n            e.preventDefault();\n            const timestamp = $(this).closest('.annotation').data('timestamp');\n            const id = $(this).closest('.annotation').data('id');\n            const contenttype = $(this).closest('.annotation').data('type');\n            ctRenderer[contenttype].editAnnotation(annotations, id, coursemodule);\n            const t = await player.getCurrentTime();\n            if (timestamp && t != timestamp) {\n                await player.seek(timestamp, true);\n            }\n            const isPlaying = await player.isPlaying();\n            if (isPlaying) {\n                player.pause();\n            }\n        });\n\n        // Implement copy annotation\n        $(document).on('click', 'tr.annotation .copy', async function(e) {\n            e.preventDefault();\n            const id = $(this).closest('.annotation').data('id');\n            const contenttype = $(this).closest('.annotation').data('type');\n            const time = await player.getCurrentTime();\n            ctRenderer[contenttype].cloneAnnotation(id, time);\n        });\n\n        // Implement delete annotation.\n        $(document).on('click', 'tr.annotation .delete', async function(e) {\n            e.preventDefault();\n            const isPaused = await player.isPaused();\n            if (!isPaused) {\n                player.pause();\n            }\n            const id = $(this).closest('.annotation').data('id');\n            const annotation = annotations.find(annotation => annotation.id == id);\n            try {\n                Notification.deleteCancelPromise(\n                    M.util.get_string('deleteinteraction', 'mod_interactivevideo'),\n                    M.util.get_string('deleteinteractionconfirm', 'mod_interactivevideo'),\n                    M.util.get_string('delete', 'mod_interactivevideo'),\n                ).then(() => {\n                    return ctRenderer[annotation.type].deleteAnnotation(annotations, id);\n                }).catch(() => {\n                    return;\n                });\n            } catch {\n                Notification.saveCancel(\n                    M.util.get_string('deleteinteraction', 'mod_interactivevideo'),\n                    M.util.get_string('deleteinteractionconfirm', 'mod_interactivevideo'),\n                    M.util.get_string('delete', 'mod_interactivevideo'),\n                    function() {\n                        return ctRenderer[annotation.type].deleteAnnotation(annotations, id);\n                    }\n                );\n            }\n        });\n\n        // Implement view annotation.\n        $(document).on('click', 'tr.annotation .title', async function(e) {\n            e.preventDefault();\n            const timestamp = $(this).closest('.annotation').data('timestamp');\n            // Update the progress bar.\n            const percentage = (timestamp - start) / totaltime * 100;\n            replaceProgressBars(percentage);\n            let currentTime = await player.getCurrentTime();\n            if (currentTime != timestamp) {\n                await player.seek(timestamp, true);\n            }\n            player.pause();\n            const id = $(this).closest('.annotation').data('id');\n            const theAnnotation = annotations.find(annotation => annotation.id == id);\n            setTimeout(() => {\n                runInteraction(theAnnotation);\n            }, 500);\n        });\n\n        // Implement go to timestamp.\n        $(document).on('click', 'tr.annotation .timestamp', async function(e) {\n            e.preventDefault();\n            const timestamp = $(this).data('timestamp');\n            await player.seek(timestamp);\n            player.play();\n        });\n\n        // Right click on the video nav or video timeline to add a new interaction.\n        $(document).on('contextmenu', '#vseek, #video-timeline', async function(e) {\n            if (!playerReady) {\n                return;\n            }\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const percentage = e.offsetX / $(this).width();\n            replaceProgressBars(percentage * 100);\n            currentTime = (percentage * totaltime) + start;\n            let t = await player.getCurrentTime();\n            if (t != currentTime) {\n                await player.seek(currentTime);\n            }\n            player.pause();\n            $addcontent.trigger('click');\n        });\n\n        // Right click on the scrollbar to add a new interaction.\n        $(document).on('contextmenu', '#scrollbar, #scrollhead-top', async function(e) {\n            if (!playerReady) {\n                return;\n            }\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            currentTime = await player.getCurrentTime();\n            $addcontent.trigger('click');\n        });\n\n        // Click the play/pause button on the timeline region to pause/play video.\n        $(document).on('click', '#playpause', async function(e) {\n            if (!playerReady) {\n                return;\n            }\n            e.preventDefault();\n            // Pause or resume the video.\n            let isPlaying = await player.isPlaying();\n            if (isPlaying) {\n                player.pause();\n            } else {\n                let t = await player.getCurrentTime();\n                if (t >= end) {\n                    $('#end-screen #restart').trigger('click');\n                } else {\n                    player.play();\n                }\n            }\n        });\n\n        $(document).on('click', '#video-block', function(e) {\n            if (!playerReady) {\n                return;\n            }\n            e.preventDefault();\n            $playpause.trigger('click');\n        });\n\n        // Right click on the annotation indicator to edit the annotation.\n        $(document).on('contextmenu', '#video-nav .annotation', function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const id = $(this).data('id');\n            // Trigger click on the edit button.\n            $annotationlist.find(`tr.annotation[data-id=\"${id}\"] .edit`).trigger('click');\n        });\n\n        // Quick edit.\n        $(document).on('contextmenu', '[data-editable]', function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            if ($('[data-field].editing').length > 0) {\n                return;\n            }\n            const fld = $(this).data('editable');\n            $(this).hide();\n            $(this).siblings('[data-field=\"' + fld + '\"]').removeClass('d-none').focus().addClass('editing');\n            if (fld == 'timestamp') {\n                $(this).closest('tr')\n                    .append(`<div class=\"timestamp-info position-absolute\">\n                        ${M.util.get_string('rightclicktosetcurrenttime', 'mod_interactivevideo')}</div>`);\n            }\n        });\n\n        $(document).on('contextmenu', '[data-field=\"timestamp\"]', async function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const time = await player.getCurrentTime();\n            $(this).val(convertSecondsToHMS(time, false, false));\n        });\n\n        $(document).on('keyup', '[data-field].editing', function(e) {\n            $(this).removeClass('is-invalid');\n            const initialValue = $(this).data('initial-value');\n            const val = $(this).val();\n            const fld = $(this).data('field');\n            if (val == '') {\n                $(this).addClass('is-invalid');\n            }\n\n            // If escape key is pressed, revert the value.\n            if (e.key == 'Escape') {\n                $(this).val(initialValue);\n                $(this).removeClass('editing');\n                $(this).addClass('d-none');\n                $(this).siblings('[data-editable]').show();\n                $('.timestamp-info').remove();\n                return;\n            }\n            // If enter key is pressed, save the value.\n            if (e.key == 'Enter') {\n\n                let seconds;\n                if (fld == 'timestamp') {\n                    const parts = initialValue.split(':');\n                    seconds = Number(parts[0]) * 3600 + Number(parts[1]) * 60 + Number(parts[2]);\n                    if (!validateTimestampFormat(val, '[data-field].editing', initialValue)) {\n                        $(this).addClass('is-invalid');\n                        return;\n                    }\n                    const timestamp = validateTimeStartEnd(val, '[data-field].editing', initialValue, seconds,\n                        true, true, true);\n                    if (timestamp == -1) {\n                        $(this).addClass('is-invalid');\n                        return;\n                    }\n                    seconds = timestamp;\n                }\n\n                if ($(this).hasClass('is-invalid')) {\n                    return;\n                }\n                if (val == initialValue) {\n                    $(this).removeClass('editing');\n                    $(this).addClass('d-none');\n                    $(this).siblings('[data-editable]').show();\n                    return;\n                }\n                const id = $(this).data('id');\n                $.ajax({\n                    url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                    method: \"POST\",\n                    dataType: \"text\",\n                    data: {\n                        action: 'quick_edit_field',\n                        sesskey: M.cfg.sesskey,\n                        id: id,\n                        field: fld,\n                        contextid: M.cfg.contextid,\n                        value: fld == 'timestamp' ? seconds : val,\n                    },\n                    success: function(data) {\n                        $('.timestamp-info').remove();\n                        const updated = JSON.parse(data);\n                        dispatchEvent('annotationupdated', {\n                            annotation: updated,\n                            action: 'edit'\n                        });\n                    }\n                });\n                return;\n            }\n        });\n\n        $(document).on('blur', '[data-field].editing', function() {\n            const initialValue = $(this).data('initial-value');\n            $(this).val(initialValue);\n            $(this).removeClass('editing');\n            $(this).addClass('d-none');\n            $(this).siblings('[data-editable]').show();\n            $('.timestamp-info').remove();\n        });\n        // End quick edit.\n\n        $(document).on('click', '#end-screen #restart', async function(e) {\n            e.preventDefault();\n            $('#end-screen').remove();\n            await player.seek(start);\n            player.play();\n        });\n\n        // Display tooltip on anntation indicator when annotation on the list is hovered.\n        $(document).on('mouseenter', 'tr.annotation', function() {\n            const id = $(this).data('id');\n            $videonav.find(`ul li[data-id=\"${id}\"] .item`).tooltip('show');\n        });\n\n        // Remove tooltip when annotation on the list is not hovered.\n        $(document).on('mouseleave', 'tr.annotation', function() {\n            const id = $(this).data('id');\n            $videonav.find(`ul li[data-id=\"${id}\"] .item`).tooltip('hide');\n            if (!isBS5) {\n                $('.tooltip').remove();\n            }\n        });\n\n        // Highlight annotation on the list when annotation indicator is hovered.\n        $(document).on('mouseover', '#video-nav ul li', function() {\n            const id = $(this).data('id');\n            $annotationlist.find(`tr.annotation[data-id=\"${id}\"]`).addClass('active');\n        });\n\n        // Remove highlight when annotation indicator is not hovered.\n        $(document).on('mouseout', '#video-nav ul li', function() {\n            const id = $(this).data('id');\n            $annotationlist.find(`tr.annotation[data-id=\"${id}\"]`).removeClass('active');\n        });\n\n        // Validate timestamp when the timestamp field is changed.\n        $(document).on('change', '.timestamp-input, .timestamp-field input', function() {\n            $(this).removeClass('is-invalid');\n            const parts = $(this).val().split(':');\n            const seconds = Number(parts[0]) * 3600 + Number(parts[1]) * 60 + Number(parts[2]);\n            if (!validateTimestampFormat($(this).val(), this)) {\n                $(this).addClass('is-invalid');\n                return;\n            }\n\n            const timestamp = validateTimeStartEnd($(this).val(), this, \"00:00:00\", seconds, true, false, true);\n\n            if (timestamp == -1) {\n                $(this).addClass('is-invalid');\n                return;\n            }\n        });\n\n        let $vseekbar = $('#vseek #bar');\n\n        const appendTimestampMarker = (seconds, rounded) => {\n            const formattedTime = convertSecondsToHMS(seconds, true, rounded);\n            $vseekbar.append(`<div id=\"position-marker\">\n                    <div id=\"position\" class=\"py-0 px-1\" style=\"top:-25px;\">${formattedTime}</div></div>`);\n        };\n\n        $(document).on('annotationitemsrendered', function() {\n            $timelinewrapper.find(`[data${bsAffix}-toggle=\"tooltip\"]`).tooltip({\n                'boundary': 'window',\n                'container': '#timeline',\n            });\n            // Put the minute markers on the timeline;\n            let targetAnnotation = null;\n            // Destroy draggable and resizable if already initialized.\n            try {\n                $('#timeline-items .annotation, #video-timeline-wrapper .skipsegment').draggable('destroy');\n                $('#timeline-items .annotation, #video-timeline-wrapper .skipsegment').resizable('destroy');\n            } catch (e) {\n                // Do nothing.\n            }\n            $('#timeline-items .annotation.li-draggable').draggable({\n                'axis': 'x',\n                'start': async function() {\n                    const isPaused = await player.isPaused();\n                    if (!isPaused) {\n                        player.pause();\n                    }\n                    appendTimestampMarker($(this).data('timestamp'));\n                    $('.tooltip, #message').remove();\n                    $('#timeline-items').addClass('no-pointer-events');\n                },\n                'drag': async function(event, ui) {\n                    $('.tooltip').remove();\n                    let timestamp = ((ui.position.left + 5) / $('#timeline-items').width()) * totaltime + start;\n                    if (timestamp < start) {\n                        timestamp = start;\n                        ui.position.left = -5;\n                    }\n                    if (timestamp > end) {\n                        timestamp = end;\n                        ui.position.left = $('#timeline-items').width() - 5;\n                    }\n                    let percentage = (timestamp - start) / totaltime * 100;\n                    if (percentage < 0) {\n                        percentage = 0;\n                    }\n                    $('#scrollbar, #position-marker, #scrollhead-top').css('left', percentage + '%');\n                    $(this).css('left', percentage + '%');\n                    await player.seek(timestamp);\n                    $('#vseek #position').text(convertSecondsToHMS(timestamp, true, false));\n                },\n                'stop': async function(event, ui) {\n                    $('.tooltip').remove();\n                    $('#vseek #position-marker').remove();\n                    setTimeout(function() {\n                        $('#timeline-items').removeClass('no-pointer-events');\n                    }, 200);\n                    let timestamp = ((ui.position.left + 5) / $('#timeline-items').width()) * totaltime + start;\n                    if (timestamp < start) {\n                        timestamp = start;\n                        $(this).css('left', '-5px');\n                    }\n                    if (timestamp > end) {\n                        timestamp = end;\n                        $(this).css('left', 'calc(100% - 5px)');\n                    }\n                    let percentage = (timestamp - start) / totaltime * 100;\n                    if (percentage < 0) {\n                        percentage = 0;\n                    }\n                    $('#scrollbar, #position-marker, #scrollhead-top').css('left', percentage + '%');\n                    const id = $(this).data('id');\n                    targetAnnotation = annotations.find(x => x.id == id);\n                    const existingAnnotation = annotations.find(x => x.timestamp == timestamp && x.id != id);\n                    if (existingAnnotation) {\n                        addNotification(M.util.get_string('interactionalreadyexists', 'mod_interactivevideo'), 'danger');\n                        renderAnnotationItems(annotations);\n                        return;\n                    }\n                    if (targetAnnotation.timestamp == timestamp) {\n                        return;\n                    }\n                    targetAnnotation.timestamp = timestamp;\n                    targetAnnotation.status = \"draft\";\n                    dispatchEvent('annotationupdated', {\n                        annotation: targetAnnotation,\n                        action: 'draft'\n                    });\n                    $('#scrollbar, #position-marker, #scrollhead-top').css('left', percentage + '%');\n                }\n            });\n\n            $('#video-timeline-wrapper .skipsegment').draggable({\n                'axis': 'x',\n                'start': async function() {\n                    const isPaused = await player.isPaused();\n                    if (!isPaused) {\n                        player.pause();\n                    }\n                    $('#message').remove();\n                    appendTimestampMarker($(this).data('timestamp'));\n                    $('#timeline-items').addClass('no-pointer-events');\n                },\n                'drag': async function(event, ui) {\n                    const id = $(this).data('id');\n                    targetAnnotation = annotations.find(x => x.id == id);\n                    let timestamp = ((ui.position.left) / $('#video-timeline').width()) * totaltime + start;\n                    if (timestamp < start) {\n                        timestamp = start;\n                    }\n\n                    if (timestamp > end) {\n                        timestamp = end;\n                    }\n\n                    let percentage = (timestamp - start) / totaltime * 100;\n                    if (percentage < 0) {\n                        percentage = 0;\n                    }\n                    $('#scrollbar, #position-marker, #scrollhead-top').css('left', percentage + '%');\n                    await player.seek(timestamp);\n                    $('#vseek #position').text(convertSecondsToHMS(timestamp, true, false));\n                },\n                'stop': async function(event, ui) {\n                    $('#vseek #position-marker').remove();\n                    setTimeout(function() {\n                        $('#timeline-items').removeClass('no-pointer-events');\n                    }, 200);\n                    let timestamp = ((ui.position.left) / $('#video-timeline').width()) * totaltime + start;\n                    const id = $(this).data('id');\n                    targetAnnotation = annotations.find(x => x.id == id);\n                    let skipduration = Number(targetAnnotation.title) - Number(targetAnnotation.timestamp);\n                    if (timestamp < 0 && timestamp + skipduration < start) {\n                        renderAnnotationItems(annotations);\n                        return;\n                    }\n                    if (timestamp > end) {\n                        renderAnnotationItems(annotations);\n                        return;\n                    }\n                    if (timestamp < start) {\n                        skipduration = skipduration - Math.abs(start - timestamp);\n                        timestamp = start;\n                    }\n                    if (timestamp + skipduration > end) {\n                        skipduration = Math.abs(end - timestamp);\n                        timestamp = end - skipduration;\n                    }\n                    if (skipduration <= 0) {\n                        renderAnnotationItems(annotations);\n                        return;\n                    }\n                    const existingAnnotation = annotations.find(x => x.timestamp == timestamp && x.id != id);\n                    if (existingAnnotation) {\n                        addNotification(M.util.get_string('interactionalreadyexists', 'mod_interactivevideo'), 'danger');\n                        renderAnnotationItems(annotations);\n                        return;\n                    }\n                    if (targetAnnotation.timestamp == timestamp) {\n                        renderAnnotationItems(annotations);\n                        return;\n                    }\n                    targetAnnotation.timestamp = timestamp;\n                    targetAnnotation.title = timestamp + skipduration;\n                    if (targetAnnotation.title > end) {\n                        targetAnnotation.title = end;\n                    }\n                    targetAnnotation.status = \"draft\";\n                    dispatchEvent('annotationupdated', {\n                        annotation: targetAnnotation,\n                        action: 'draft'\n                    });\n                    let percentage = (timestamp - start) / totaltime * 100;\n                    if (percentage < 0) {\n                        percentage = 0;\n                    }\n                    $('#scrollbar, #position-marker, #scrollhead-top').css('left', percentage + '%');\n                }\n            });\n\n            $('#video-timeline-wrapper .skipsegment').resizable({\n                'containment': '#video-timeline-wrapper',\n                'handles': 'e, w',\n                'start': async function() {\n                    const isPaused = await player.isPaused();\n                    if (!isPaused) {\n                        player.pause();\n                    }\n                    $('#message').remove();\n                    appendTimestampMarker($(this).data('timestamp'));\n                    $('#timeline-items').addClass('no-pointer-events');\n                },\n                'resize': async function(event, ui) {\n                    let timestamp;\n                    if (ui.originalPosition.left != ui.position.left || ui.originalSize.width == ui.size.width) {\n                        if (ui.position.left < 0) {\n                            ui.position.left = 0;\n                        }\n                        timestamp = ((ui.position.left) / $('#video-timeline').width()) * totaltime + start;\n                    } else {\n                        timestamp = ((ui.position.left + ui.size.width) / $('#video-timeline').width()) * totaltime + start;\n                    }\n                    let percentage = (timestamp - start) / totaltime * 100;\n                    if (isNaN(percentage) || percentage < 0) {\n                        percentage = 0;\n                    }\n                    if (percentage > 100) {\n                        percentage = 100;\n                    }\n                    $('#scrollbar, #position-marker, #scrollhead-top').css('left', percentage + '%');\n                    await player.seek(timestamp);\n                    $('#vseek #position').text(convertSecondsToHMS(timestamp, true, false));\n                },\n                'stop': async function(event, ui) {\n                    $('#vseek #position-marker').remove();\n                    setTimeout(function() {\n                        $('#timeline-items').removeClass('no-pointer-events');\n                    }, 200);\n                    const id = $(this).data('id');\n                    targetAnnotation = annotations.find(x => x.id == id);\n                    let timestamp, direction;\n                    if (ui.originalPosition.left != ui.position.left) {\n                        if (ui.position.left < 0) {\n                            ui.position.left = 0;\n                        }\n                        timestamp = ((ui.position.left) / $('#video-timeline').width()) * totaltime + start;\n                        direction = \"left\";\n                    } else {\n                        timestamp = ((ui.position.left + ui.size.width) / $('#video-timeline').width()) * totaltime + start;\n                        direction = \"right\";\n                    }\n                    const existingAnnotation = annotations.find(x => x.timestamp == timestamp && x.id != id);\n                    if (existingAnnotation) {\n                        addNotification(M.util.get_string('interactionalreadyexists', 'mod_interactivevideo'), 'danger');\n                        renderAnnotationItems(annotations);\n                        return;\n                    }\n                    if (targetAnnotation.timestamp == timestamp) {\n                        return;\n                    }\n                    if (direction == \"left\") {\n                        targetAnnotation.timestamp = timestamp;\n                    } else {\n                        targetAnnotation.title = timestamp;\n                        if (targetAnnotation.title > end) {\n                            targetAnnotation.title = end;\n                        }\n                    }\n                    targetAnnotation.status = 'draft';\n                    dispatchEvent('annotationupdated', {\n                        annotation: targetAnnotation,\n                        action: 'draft'\n                    });\n\n                    let percentage = (timestamp - start) / totaltime * 100;\n                    if (isNaN(percentage) || percentage < 0) {\n                        percentage = 0;\n                    }\n                    if (percentage > 100) {\n                        percentage = 100;\n                    }\n                    $('#scrollbar, #position-marker, #scrollhead-top').css('left', percentage + '%');\n                }\n            });\n\n            $('#video-timeline-wrapper .skipsegment').off('contextmenu').on('contextmenu', function(e) {\n                e.preventDefault();\n                e.stopImmediatePropagation();\n                const id = $(this).data('id');\n                $(`tr.annotation[data-id=\"${id}\"] .edit`).trigger('click');\n            });\n\n            $('#video-timeline-wrapper .skipsegment').off('click').on('click', async function(e) {\n                e.preventDefault();\n                const timestamp = $(this).data('timestamp');\n                await player.seek(timestamp);\n                const isPaused = await player.isPaused();\n                if (!isPaused) {\n                    player.pause();\n                }\n            });\n\n            $('#video-timeline-wrapper .skipsegment .delete-skipsegment').off('click').on('click', function(e) {\n                e.preventDefault();\n                const id = $(this).closest('.skipsegment').data('id');\n                $(`tr.annotation[data-id=\"${id}\"] .delete`).trigger('click');\n            });\n        });\n\n        $('#scrollbar').draggable({\n            'containment': '#timeline-items',\n            'axis': 'x',\n            'cursor': 'col-resize',\n            'start': async function(event, ui) {\n                const isPaused = await player.isPaused();\n                if (!isPaused) {\n                    player.pause();\n                }\n                $('#timeline-items').addClass('no-pointer-events');\n                $(\"#message\").remove();\n                appendTimestampMarker(((ui.position.left) / $('#timeline-items').width()) * totaltime + start, false);\n            },\n            'drag': async function(event, ui) {\n                let timestamp = ((ui.position.left) / $('#timeline-items').width()) * totaltime + start;\n                let percentage = (timestamp - start) / totaltime * 100;\n                $('#vseek #position').text(convertSecondsToHMS(timestamp, true, false));\n                $('#vseek #position-marker, #scrollhead-top, #scrollbar')\n                    .css('left', percentage + '%');\n                await player.seek(timestamp);\n            },\n            'stop': async function(event, ui) {\n                $('#vseek #position-marker').remove();\n                setTimeout(function() {\n                    $('#timeline-items').removeClass('no-pointer-events');\n                }, 200);\n                // Convert the position to percentage\n                let timestamp = ((ui.position.left) / $('#timeline-items').width()) * totaltime + start;\n                let percentage = (timestamp - start) / totaltime * 100;\n                if (isNaN(percentage) || percentage < 0) {\n                    percentage = 0;\n                }\n                if (percentage > 100) {\n                    percentage = 100;\n                }\n                $('#scrollbar, #scrollhead-top').css('left', percentage + '%');\n                const isPaused = await player.isPaused();\n                if (!isPaused) {\n                    player.pause();\n                }\n            }\n        });\n\n        $('#scrollhead-top').draggable({\n            'axis': 'x',\n            'cursor': 'col-resize',\n            'start': async function(event, ui) {\n                const isPaused = await player.isPaused();\n                if (!isPaused) {\n                    player.pause();\n                }\n                $('#vseek').addClass('no-pointer-events');\n                $(\"#message\").remove();\n                appendTimestampMarker(((ui.position.left) / $('#vseek').width()) * totaltime + start, false);\n            },\n            'drag': async function(event, ui) {\n                let timestamp = ((ui.position.left) / $('#vseek').width()) * totaltime + start;\n                let percentage = (timestamp - start) / totaltime * 100;\n                if (isNaN(percentage) || percentage < 0) {\n                    percentage = 0;\n                }\n                if (percentage > 100) {\n                    percentage = 100;\n                }\n                if (timestamp < start) {\n                    timestamp = start;\n                }\n                $('#vseek #position').text(convertSecondsToHMS(timestamp, true, false));\n                $('#vseek #position-marker, #scrollhead-top, #scrollbar')\n                    .css('left', percentage + '%');\n                await player.seek(timestamp);\n            },\n            'stop': async function(event, ui) {\n                $('#vseek #position-marker').remove();\n                setTimeout(function() {\n                    $('#vseek').removeClass('no-pointer-events');\n                }, 200);\n                // Convert the position to percentage\n                let timestamp = ((ui.position.left) / $('#vseek').width()) * totaltime + start;\n                if (timestamp < start) {\n                    timestamp = start;\n                }\n                let percentage = (timestamp - start) / totaltime * 100;\n                if (isNaN(percentage) || percentage < 0) {\n                    percentage = 0;\n                }\n                if (percentage > 100) {\n                    percentage = 100;\n                }\n                $('#scrollbar, #scrollhead-top').css('left', percentage + '%');\n                let t = await player.getCurrentTime();\n                if (t === timestamp) {\n                    return;\n                }\n                const isPaused = await player.isPaused();\n                if (!isPaused) {\n                    player.pause();\n                }\n            }\n        });\n\n        // Resize timeline.\n        $('#timeline-wrapper').resizable({\n            'handles': 'n',\n            'minHeight': 125,\n            'maxHeight': 500,\n            'start': function() {\n                $('#top-region, #timeline-wrapper').addClass('no-pointer-events');\n            },\n            'resize': function(event, ui) {\n                $('#top-region').css('height', `calc(100dvh - ${ui.size.height + 70}px)`);\n            },\n            'stop': function() {\n                $('#top-region, #timeline-wrapper').removeClass('no-pointer-events');\n                localStorage.setItem('timeline-height', $('#timeline-wrapper').height());\n            }\n        });\n\n        // Resize player region.\n        $('#separator').draggable({\n            'axis': 'x',\n            'containment': '#wrapper',\n            'grid': [1, 0],\n            'start': function() {\n                $('#wrapper').addClass('no-pointer-events');\n            },\n            drag: function() {\n                const parentOffset = $(this).offset();\n                const width = parentOffset.left;\n                if (!isRTL) {\n                    $('#player-region').css('width', width + 'px');\n                    $('#content-region').css('width', 'calc(100% - ' + width + 'px)');\n                } else {\n                    $('#player-region').css('width', 'calc(100% - ' + width + 'px)');\n                    $('#content-region').css('width', width + 'px');\n                }\n            },\n            stop: function() {\n                const width = $(this).offset().left;\n                // Save this to local storage\n                localStorage.setItem('player-width', width);\n                $('#wrapper').removeClass('no-pointer-events');\n            }\n        });\n\n        // Set player region width from the saved width in local storage.\n        const playerWidth = localStorage.getItem('player-width');\n        if (playerWidth > 0 && window.innerWidth > 992) {\n            $('#separator').css('left', playerWidth + 'px');\n            if (!isRTL) {\n                $('#player-region').css('width', playerWidth + 'px');\n                $('#content-region').css('width', 'calc(100% - ' + playerWidth + 'px)');\n            } else {\n                $('#player-region').css('width', 'calc(100% - ' + playerWidth + 'px)');\n                $('#content-region').css('width', playerWidth + 'px');\n            }\n        } else {\n            $('#separator').css('left', `50%`);\n            $('#player-region').css('width', `50%`);\n            $('#content-region').css('width', `50%`);\n        }\n\n        // Set timeline height from saved height in local storage.\n        const timelineHeight = localStorage.getItem('timeline-height');\n        if (timelineHeight) {\n            $('#timeline-wrapper').css('height', timelineHeight + 'px');\n            $('#top-region').css('height', `calc(100dvh - ${Number(timelineHeight) + 70}px)`);\n        }\n\n        // Seek bar functionalities\n        $('#vseek #bar, #video-timeline').on('mouseenter', function(e) {\n            $('#cursorbar, #position-marker').remove();\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            // First clone the #scrollbar and place it where the cursor is.\n            let $scrollbar = $('#scrollbar').clone();\n            $scrollbar.attr('id', 'cursorbar');\n            $scrollbar.addClass('no-pointer-events');\n\n            const parentOffset = $(this).offset();\n            const relX = e.pageX - parentOffset.left;\n\n            $scrollbar.css('left', (relX + 5) + 'px');\n            $scrollbar.find('#scrollhead').remove();\n            const percentage = relX / $(this).width();\n            const time = percentage * (totaltime) + start;\n            const formattedTime = convertSecondsToHMS(time, true, false);\n            $('#vseek #bar').append(`<div id=\"position-marker\">\n                    <div id=\"position\" class=\"py-0 px-1\" style=\"top:-25px;\">${formattedTime}</div></div>`);\n            $('#vseek #position-marker').css('left', relX + 'px');\n            $('#timeline-items').append($scrollbar);\n        });\n\n        $('#vseek #bar, #video-timeline').on('mouseleave', function(e) {\n            e.stopImmediatePropagation();\n            $('#vseek #position-marker, #cursorbar').remove();\n            // Remove highlight.\n            $('tr.annotation.active').removeClass('active');\n        });\n\n        $('#vseek #bar, #video-timeline').on('mousemove', function(e) {\n            e.stopImmediatePropagation();\n            const parentOffset = $(this).offset();\n            const relX = e.pageX - parentOffset.left;\n            const percentage = relX / $(this).width();\n            let time = percentage * (totaltime) + start;\n            if (time < start) {\n                time = start;\n            }\n            const formattedTime = convertSecondsToHMS(time, true, false);\n            // Move the cursorbar\n            $('#cursorbar').css('left', (relX + 5) + 'px');\n            $('#vseek #position').text(formattedTime);\n            $('#vseek #position-marker').css('left', relX + 'px');\n        });\n\n        // Run interaction when annotation indicator is clicked.\n        $(document).on('click', '#video-nav .annotation', async function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const id = $(this).data('id');\n            const annotation = annotations.find(x => x.id == id);\n            $loader.fadeIn(300);\n            if (await player.getCurrentTime() != annotation.timestamp) {\n                await player.seek(annotation.timestamp);\n            }\n            $loader.fadeOut(300);\n            runInteraction(annotation);\n        });\n\n        // Seek video on click on timeline or video nav.\n        $(document).on('click', '#vseek #bar, #video-timeline', async function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const percentage = e.offsetX / $(this).width();\n            const time = percentage * (totaltime) + start;\n            const t = await player.getCurrentTime();\n            if (t === time) {\n                return;\n            }\n            replaceProgressBars(percentage * 100);\n            $loader.fadeIn(300);\n            const isPaused = await player.isPaused();\n            if (!isPaused) {\n                player.pause();\n            }\n            await player.seek(time);\n            $loader.fadeOut(300);\n            $(\"#message, #end-screen\").remove();\n        });\n\n        // Implement timeline zoom out.\n        $('#zoomout').on('click', function() {\n            const currentLevel = $timelineitemswrapper.css('width'); // In px.\n            const newLevel = parseInt(currentLevel) - 300;\n            $timelineitemswrapper.css('width', newLevel + 'px');\n            const relWidth = $('#timeline-items').width();\n            $('#minute-markers, #minute-markers-bg, #vseek').css('width', relWidth + 'px');\n            let timelineElement = document.getElementById('timeline');\n            if (timelineElement.scrollWidth <= timelineElement.clientWidth) {\n                $(this).attr('disabled', 'disabled');\n            }\n            dispatchEvent('annotationitemsrendered', {'annotations': annotations});\n        });\n\n        // Implement timeline zoom in.\n        $('#zoomin').on('click', function() {\n            const currentLevel = $timelineitemswrapper.css('width'); // In px.\n            const newLevel = parseInt(currentLevel) + 300;\n            $timelineitemswrapper.css('width', newLevel + 'px');\n            const relWidth = $('#timeline-items').width();\n            $('#minute-markers, #minute-markers-bg, #vseek').css('width', relWidth + 'px');\n            $('#zoomout').removeAttr('disabled');\n            dispatchEvent('annotationitemsrendered', {'annotations': annotations});\n        });\n\n        // Implement zoom in and zoom out on mouse scroll on timeline.\n        $(\"#timeline\").on('wheel', function(e) {\n            if (e.ctrlKey || e.metaKey) {\n                e.preventDefault();\n                if (e.originalEvent.deltaY < 0) {\n                    $('#zoomin').trigger('click');\n                } else {\n                    $('#zoomout').trigger('click');\n                }\n            }\n        });\n\n        document.getElementById('timeline').addEventListener('scroll', function() {\n            document.getElementById('minute-markers-wrapper').scrollLeft = this.scrollLeft;\n            document.getElementById('vseek').style.left = -this.scrollLeft + 'px';\n            document.getElementById('minute-markers-bg-wrapper').style.left = -this.scrollLeft + 'px';\n            document.getElementById('scrollbar').scrollHeight = this.scrollHeight;\n        });\n\n        // Save timeline changes.\n        $('#savedraft').on('click', function(e) {\n            e.stopImmediatePropagation();\n            let draftAnnotations = annotations.filter(x => x.status == 'draft');\n            let count = 0;\n            draftAnnotations.forEach(function(a) {\n                $.ajax({\n                    url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                    method: \"POST\",\n                    dataType: \"text\",\n                    data: {\n                        action: 'quick_edit_field',\n                        sesskey: M.cfg.sesskey,\n                        id: a.id,\n                        field: 'timestamp',\n                        contextid: M.cfg.contextid,\n                        value: a.timestamp,\n                    },\n                    success: function(data) {\n                        const updated = JSON.parse(data);\n                        dispatchEvent('annotationupdated', {\n                            annotation: updated,\n                            action: 'savedraft'\n                        });\n                    }\n                });\n                if (a.type == 'skipsegment') {\n                    $.ajax({\n                        url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                        method: \"POST\",\n                        dataType: \"text\",\n                        data: {\n                            action: 'quick_edit_field',\n                            sesskey: M.cfg.sesskey,\n                            id: a.id,\n                            field: 'title',\n                            contextid: M.cfg.contextid,\n                            value: a.title,\n                        },\n                        success: function(data) {\n                            const updated = JSON.parse(data);\n                            dispatchEvent('annotationupdated', {\n                                annotation: updated,\n                                action: 'savedraft'\n                            });\n                        }\n                    });\n                }\n                count++;\n                if (count == draftAnnotations.length) {\n                    addNotification(M.util.get_string('draftsaved', 'mod_interactivevideo'), 'success');\n                }\n            });\n\n        });\n\n\n        // Launch content selection modal.\n        let contentTypeModal;\n        $addcontent.on('click', async function(e) {\n            e.preventDefault();\n            if (!playerReady) {\n                return;\n            }\n            if (contentTypeModal) {\n                contentTypeModal.show();\n                return;\n            }\n            contentTypeModal = await ModalFactory.create({\n                title: '',\n                body: '',\n                backdrop: 'static',\n                removeOnHide: false,\n            });\n            let root = contentTypeModal.getRoot();\n            let $body = $('#contentmodal-original .modal-content').html();\n            root.attr('id', 'contentmodal');\n            root.find('.modal-dialog .modal-content').html($body);\n            contentTypeModal.show();\n\n            root.on(ModalEvents.hidden, function() {\n                $('#addcontentdropdown .dropdown-item').removeClass('active');\n            });\n\n            root.on(ModalEvents.shown, function() {\n                player.pause();\n                // Apply jelly animation after DOM is ready\n                setTimeout(() => {\n                    root.addClass('jelly-anim');\n                }, 10);\n\n                // Make the modal draggable.\n                root.find('.modal-dialog').draggable({\n                    handle: \".modal-header\"\n                });\n            });\n\n            root.on('click', '.modal-header [type=\"button\"]', function() {\n                contentTypeModal.hide();\n            });\n\n            root.on('click', '.dropdown-item', function() {\n                root.removeClass('jelly-anim');\n                contentTypeModal.hide();\n            });\n        });\n\n        // Inform user to save changes before close or unload the current page.\n        window.addEventListener('beforeunload', (e) => {\n            if (annotations.find(x => x.status == 'draft')) {\n                const confirmationMessage = M.util.get_string('unsavedchanges', 'mod_interactivevideo');\n                e.returnValue = confirmationMessage;\n                return confirmationMessage;\n            }\n            return true;\n        });\n\n        // Implement the rate change.\n        $(document).on('click', '.changerate', function(e) {\n            e.preventDefault();\n            const rate = $(this).data('rate');\n            player.setRate(rate);\n            $('.changerate').find('i').removeClass('bi-check');\n            $(this).find('i').addClass('bi-check');\n        });\n\n        $(document).on('iv:playerRateChange', function(e) {\n            $('.changerate').find('i').removeClass('bi-check');\n            $(`.changerate[data-rate=\"${e.originalEvent.detail.rate}\"]`).find('i').addClass('bi-check');\n        });\n\n        // Handle video control:: Quality change\n        $(\"#changequality\").on('shown.bs.dropdown', async function() {\n            let quality = await player.getQualities();\n            $('#qualitieslist').empty();\n            let currentQuality = quality.currentQuality;\n            if (currentQuality === null) {\n                currentQuality = $(this).data('current');\n            }\n            let qualities = quality.qualities;\n            let qualitiesLabel = quality.qualitiesLabel;\n            qualities.forEach((q, i) => {\n                $('#qualitieslist').append(`<a class=\"dropdown-item changequality px-3\" data-quality=\"${q}\"\n                         href=\"#\"><i class=\"bi ${q == currentQuality ? 'bi-check' : ''} fa-fw\"></i>${qualitiesLabel[i]}</a>`);\n            });\n            $(this).find(`[data${bsAffix}-toggle=dropdown]`).dropdown('update');\n        });\n\n        $(document).on('click', '.changequality', function(e) {\n            e.preventDefault();\n            const quality = $(this).data('quality');\n            player.setQuality(quality);\n            $('.changequality').find('i').removeClass('bi-check');\n            $(this).find('i').addClass('bi-check');\n        });\n\n        // Observe timeline-wrapper width change.\n        let timelineWrapper = document.getElementById('timeline-wrapper');\n        let resizeTimeout;\n        let resizeObserver = new ResizeObserver(() => {\n            clearTimeout(resizeTimeout);\n            resizeTimeout = setTimeout(() => {\n                const relWidth = $('#timeline-items').width();\n                $('#minute-markers, #minute-markers-bg, #vseek').css('width', relWidth + 'px');\n            }, 100);\n        });\n\n        resizeObserver.observe(timelineWrapper);\n\n        // Implement import content\n        $(document).on('click', '#importcontent', async function(e) {\n            e.preventDefault();\n            const importmodal = await ModalFactory.create({\n                body: ``,\n                title: M.util.get_string('importcontent', 'mod_interactivevideo'),\n                footer: `<button type=\"button\" class=\"btn btn-secondary border-0\" data${bsAffix}-dismiss=\"modal\">\n                        ${M.util.get_string('cancel', 'mod_interactivevideo')}</button>\n                        <button type=\"button\" class=\"btn btn-primary border-0\" id=\"importcontentbutton\">\n                        ${M.util.get_string('import', 'mod_interactivevideo')}</button>`,\n                show: false,\n                large: true,\n                removeOnClose: true,\n                isVerticallyCentered: true,\n            });\n            let root = importmodal.getRoot();\n            root.attr('id', 'importmodal');\n            importmodal.show();\n            root.off(ModalEvents.shown);\n            root.on(ModalEvents.shown, async function() {\n                root.find('.modal-dialog').draggable({\n                    handle: \".modal-header\"\n                });\n\n                // Render the course select dropdown.\n                $.ajax({\n                    url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                    method: \"POST\",\n                    dataType: \"text\",\n                    data: {\n                        action: 'get_taught_courses',\n                        sesskey: M.cfg.sesskey,\n                        contextid: M.cfg.contextid,\n                        userid: userid\n                    },\n                    success: function(data) {\n                        let courses = JSON.parse(data);\n                        // Sort courses by name.\n                        courses.sort((a, b) => a.fullname.localeCompare(b.fullname));\n                        let courseSelect = `<select class=\"${isBS5 ? 'form' : 'custom'}-select w-100\" id=\"importcourse\">`;\n                        courses.forEach(course => {\n                            courseSelect += `<option value=\"${course.id}\">${course.fullname} (${course.shortname})</option>`;\n                        });\n                        courseSelect += `</select>`;\n                        let selectfield = `<div class=\"iv-form-group selectcourse\">\n                            <label class=\"iv-font-weight-bold form-label\" for=\"importcourse\">\n                            ${M.util.get_string('selectcourse', 'mod_interactivevideo')}</label>\n                            ${courseSelect}</div>`;\n                        root.find('.modal-body').empty();\n                        root.find('.modal-body').append(selectfield);\n\n                        // Default current course.\n                        root.find('#importcourse').val(course);\n                        root.find('#importcourse').trigger('change');\n                    }\n                });\n            });\n\n            root.on(ModalEvents.hidden, function() {\n                importmodal.destroy();\n            });\n\n            root.off('change', '#importcourse');\n            root.on('change', '#importcourse', function() {\n                root.find('.selectcm, .select-interaction').remove();\n                $.ajax({\n                    url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                    method: \"POST\",\n                    dataType: \"text\",\n                    data: {\n                        action: 'get_cm_by_courseid',\n                        sesskey: M.cfg.sesskey,\n                        contextid: M.cfg.contextid,\n                        courseid: $(this).val()\n                    },\n                    success: function(data) {\n                        let cms = JSON.parse(data);\n                        cms.sort((a, b) => a.name.localeCompare(b.name));\n                        let cmSelect = `<select class=\"${isBS5 ? 'form' : 'custom'}-select w-100\" id=\"importcm\">\n                        <option value=\"\">${M.util.get_string('select', 'mod_interactivevideo')}</option>`;\n                        cms.forEach(cm => {\n                            cmSelect += `<option value=\"${cm.id}\"\n                                 ${cm.id == interaction ? 'disabled' : ''}>${cm.name}</option>`;\n                        });\n                        cmSelect += `</select>`;\n                        let selectfield = `<div class=\"iv-form-group selectcm\">\n                        <label for=\"importcm\" class=\"iv-font-weight-bold form-label\">\n                        ${M.util.get_string('selectactivity', 'mod_interactivevideo')}</label>\n                        ${cmSelect}</div>`;\n                        root.find('.selectcourse').after(selectfield);\n                    }\n                });\n            });\n\n            root.off('change', '#importcm');\n            root.on('change', '#importcm', async function() {\n                root.find('.select-interaction').remove();\n                root.find('#importcm').after(`<div class=\"select-interaction py-3\">\n                    <iframe src=\"${M.cfg.wwwroot + '/mod/interactivevideo/view.php?i=' + $(this).val()}&embed=1&preview=1\"\n                    frameborder=0 width=\"100%\" height=\"500\" class=\"loader\"></iframe></div>`);\n                let interactions = await $.ajax({\n                    url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                    method: \"POST\",\n                    dataType: \"text\",\n                    data: {\n                        action: 'get_items',\n                        sesskey: M.cfg.sesskey,\n                        id: $(this).val(),\n                        contextid: M.cfg.contextid,\n                        coursecontextid: M.cfg.courseContextId\n                    }\n                });\n                interactions = JSON.parse(interactions);\n                interactions = interactions.filter(x => x.type != 'skipsegment');\n                if (interactions.length == 0) {\n                    root.find('.select-interaction').append(`<div class=\"alert alert-warning mt-3\">\n                        ${M.util.get_string('nocontent', 'mod_interactivevideo')}</div>`);\n                    return;\n                }\n\n                root.find('.select-interaction').append(`<div class=\"input-group mb-1 w-100 flex-nowrap align-items-center\n                     no-pointer\">\n                     <div class=\"input-group-prepend border-0 invisible\">\n                            <label class=\"input-group-text bg-white\">\n                                <input type=\"checkbox\"/>\n                                <i class=\"bi bi-plus iv-ml-3 fs-unset\"></i>\n                            </label>\n                        </div>\n                        <input type=\"text\" class=\"form-control border-0 iv-font-weight-bold\"\n                        value=\"${M.util.get_string('title', 'mod_interactivevideo')}\">\n                        <input type=\"text\" class=\"form-control border-0 iv-font-weight-bold\" style=\"max-width: 50px;\"\n                        value=\"XP\">\n                        <input type=\"text\" style=\"max-width: 150px;\"\n                         value=\"${M.util.get_string('timestamp', 'mod_interactivevideo')}\"\n                        class=\"form-control border-0 iv-font-weight-bold\"></div>`);\n\n                interactions = interactions.map(int => {\n                    // Get the icon and check if the interaction is out of range (start, end time);\n                    const ctype = contentTypes.find(y => y.name === int.type);\n                    int.prop = JSON.stringify(ctype);\n                    int.icon = ctype.icon;\n                    if ((int.timestamp > end || int.timestamp < start) && int.timestamp > 0) {\n                        int.outside = true;\n                    } else {\n                        int.outside = false;\n                    }\n                    // Check if the interaction can be added (e.g. annotation content type can only be added once per activity);\n                    if (!ctype.allowmultiple && annotations.find(x => x.type == int.type)) {\n                        int.disabled = true;\n                    }\n                    return int;\n                });\n\n                interactions.sort((a, b) => a.timestamp - b.timestamp);\n                let inputs = '';\n                interactions.forEach(int => {\n                    const inputgroup = `<div class=\"input-group mb-1 w-100 flex-nowrap align-items-center\"\n                        data-id=\"${int.id}\">\n                        <div class=\"input-group-prepend\">\n                            <label class=\"input-group-text\">\n                                <input type=\"checkbox\" ${int.disabled ? 'disabled' : ''}/>\n                                <i class=\"${int.icon} iv-ml-3 fs-unset\"></i>\n                            </label>\n                        </div>\n                        <input type=\"text\" class=\"form-control name\" ${int.timestamp < 0 ? 'readonly' : ''}\n                        value=\"${int.title}\">\n                        <input type=\"text\" style=\"max-width: 50px;\" ${int.timestamp < 0 || int.hascompletion == 0 ? 'readonly' : ''}\n                        class=\"form-control xp\" value=\"${int.xp}\">\n                        <input type=\"text\" placeholder=\"00:00:00\" style=\"max-width: 150px;\" ${int.timestamp < 0 ? 'readonly' : ''}\n                        class=\"form-control timestamp-input ${int.outside ? 'is-invalid' : ''}\"\n                        value=\"${int.timestamp < 0 ? int.timestamp : convertSecondsToHMS(int.timestamp, false, false)}\"></div>`;\n                    inputs += inputgroup;\n                });\n                root.find('.select-interaction').append(inputs);\n\n                root.off('click', '#importcontentbutton').on('click', '#importcontentbutton',\n                    async function(e) {\n                        e.preventDefault();\n                        let $selected = root.find(`.select-interaction input[type=\"checkbox\"]:checked`);\n                        let selectedInt = [];\n                        $selected.each(function() {\n                            let $row = $(this).closest('.input-group');\n                            const name = $row.find('.name').val();\n                            if (name.trim() == '') {\n                                return;\n                            }\n                            let timestamp = $row.find('.timestamp-input').val();\n                            if (timestamp == '') {\n                                return;\n                            }\n\n                            if (Number(timestamp) < 0) {\n                                timestamp = Number(timestamp);\n                            } else {\n                                const parts = timestamp.split(':');\n                                timestamp = Number(parts[0]) * 3600 + Number(parts[1]) * 60 + Number(parts[2]);\n                                if (annotations.find(x => x.timestamp == timestamp)) {\n                                    return;\n                                }\n                            }\n                            let id = $row.data('id');\n                            let int = interactions.find(x => x.id == id);\n                            int.title = name;\n                            int.timestamp = timestamp;\n                            let xp = Number($row.find('.xp').val());\n                            if (isNaN(xp) || xp == '') {\n                                xp = 0;\n                            }\n                            int.xp = xp;\n                            selectedInt.push(int);\n                        });\n                        if (selectedInt.length == 0) {\n                            addNotification(M.util.get_string('selectinteraction', 'mod_interactivevideo'), 'danger');\n                            return;\n                        } else {\n                            let interactions = await $.ajax({\n                                url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                                method: \"POST\",\n                                dataType: \"text\",\n                                data: {\n                                    action: 'import_annotations',\n                                    sesskey: M.cfg.sesskey,\n                                    contextid: M.cfg.contextid,\n                                    annotations: JSON.stringify(selectedInt),\n                                    tocourse: M.cfg.courseId,\n                                    fromcourse: $('#importcourse').val(),\n                                    tocm: interaction,\n                                    fromcm: $('#importcm').val(),\n                                    module: coursemodule\n                                }\n                            });\n                            interactions = JSON.parse(interactions);\n\n                            // Dismiss modal.\n                            importmodal.hide();\n\n                            // Add the imported annotations to the current annotations.\n                            annotations = annotations.concat(interactions);\n                            dispatchEvent('annotationupdated', {\n                                annotations: annotations,\n                                action: 'import'\n                            });\n\n                            // Get interaction that allowmultiple false and init each one.\n                            interactions.forEach(int => {\n                                if (!int.allowmultiple) {\n                                    ctRenderer[int.type].init();\n                                }\n                            });\n                        }\n                    });\n            });\n        });\n\n        // Implement content type filter.\n        $(document).on('keyup', '#contentmodal #contentsearch', function() {\n            let search = $(this).val().toLowerCase();\n\n            $('#addcontentdropdown .dropdown-item').removeClass('d-none').addClass('d-flex');\n\n            if (search == '') {\n                return;\n            }\n\n            $('#contentmodal #addcontentdropdown .dropdown-item').each(function() {\n                let text = $(this).find('.contenttype-title').text().toLowerCase();\n                if (text.includes(search)) {\n                    $(this).addClass('d-flex').removeClass('d-none');\n                } else {\n                    $(this).addClass('d-none').removeClass('d-flex');\n                }\n            });\n        });\n\n        // Implement fast forward and rewind.\n        const fastforward = async(e) => {\n            let time = await player.getCurrentTime();\n            if (time >= end) {\n                return;\n            }\n            if (e.ctrlKey || e.metaKey) {\n                time += 1;\n            } else {\n                time += 0.2;\n            }\n            if (time > end) {\n                time = end;\n            }\n            await player.seek(time);\n        };\n        $(document).on('click', '#fast-forward', async function(e) {\n            e.preventDefault();\n            fastforward(e);\n        });\n\n        let fastForwardInterval;\n        $(document).on('mousedown', '#fast-forward', async function(e) {\n            e.preventDefault();\n            fastForwardInterval = setInterval(async() => {\n                fastforward(e);\n                if (await player.getCurrentTime() >= end) {\n                    clearInterval(fastForwardInterval);\n                }\n            }, 200);\n        });\n\n        $(document).on('mouseup mouseleave', '#fast-forward', function() {\n            clearInterval(fastForwardInterval);\n        });\n\n        const rewind = async(e) => {\n            let time = await player.getCurrentTime();\n            if (time <= start) {\n                return;\n            }\n            if (e.ctrlKey || e.metaKey) {\n                time -= 1;\n            } else {\n                time -= 0.2;\n            }\n            if (time < start) {\n                time = start;\n            }\n            await player.seek(time);\n        };\n        $(document).on('click', '#rewind', async function(e) {\n            e.preventDefault();\n            rewind(e);\n        });\n\n        let rewindInterval;\n        $(document).on('mousedown', '#rewind', async function(e) {\n            e.preventDefault();\n            rewindInterval = setInterval(async() => {\n                rewind(e);\n                if (await player.getCurrentTime() <= start) {\n                    clearInterval(rewindInterval);\n                }\n            }, 200);\n        });\n\n        $(document).on('mouseup mouseleave', '#rewind', function() {\n            clearInterval(rewindInterval);\n        });\n\n        // Remove all event listeners before leaving the page.\n        window.addEventListener('beforeunload', function() {\n            $(document).off();\n            cancelAnimationFrame(onPlayingInterval);\n        });\n\n        // Event lister for bulk action.\n        $(document).on('click', '#annotation-list-bulk-edit', async function(e) {\n            e.preventDefault();\n            document.body.focus();\n            if ($(this).hasClass('active')) {\n                // Remove all checkboxes.\n                $('#annotation-list').find('.form-check').remove();\n                $(this).removeClass('active');\n                $('#annotation-list').find('tr').each(function() {\n                    $(this).removeClass('b-active');\n                });\n                $('body').removeClass('iv-bulk-edit');\n                $('#annotation-list-bulk-checkall').addClass('d-none');\n                return;\n            }\n            $(this).addClass('active');\n            $('#annotation-list-bulk-checkall').removeClass('d-none active');\n            $('body').addClass('iv-bulk-edit');\n            let li = $('#annotation-list').find('tr');\n            li.each(function() {\n                let id = $(this).data('id');\n                let type = $(this).data('type');\n                // Find first td.\n                let td = $(this).find('td').first().find('div');\n                td.prepend(`<div class=\"form-check form-check-inline iv-mr-0\">\n                        <input class=\"form-check-input\" type=\"checkbox\" data-type=\"${type}\" id=\"annotation-${id}\" value=\"${id}\">\n                        <label class=\"form-check-label\" for=\"annotation-${id}\"></label></div>`);\n            });\n        });\n\n        // Event lister for bulk check all.\n        $(document).on('click', '#annotation-list-bulk-checkall', function(e) {\n            e.preventDefault();\n            let check = !$(this).hasClass('active');\n\n            // Uncheck all checkboxes.\n            $('tr.annotation .form-check-input').each(function() {\n                if ((!$(this).is(':checked') && check) || ($(this).is(':checked') && !check)) {\n                    $(this).trigger('click');\n                }\n            });\n\n            $(this).toggleClass('active');\n\n        });\n\n        $(document).on('click', 'tr.annotation .form-check-input', function(e) {\n            e.stopImmediatePropagation();\n            if ($(this).is(':checked')) {\n                $(this).closest('tr').addClass('b-active');\n            } else {\n                $(this).closest('tr').removeClass('b-active');\n            }\n\n            let checked = $('#annotation-list').find('tr .form-check-input:checked');\n\n            if (checked.length == 0) {\n                $('#annotation-list-bulk .bulk-actions').hide();\n            } else {\n                $('#annotation-list-bulk .bulk-actions').show();\n            }\n        });\n\n        $(document).on('click', '#annotation-list-bulk-delete', async function(e) {\n            e.preventDefault();\n            let ids = [];\n            let types = [];\n            let checked = $('#annotation-list').find('tr .form-check-input:checked');\n            checked.each(function() {\n                ids.push($(this).val());\n                types.push($(this).data('type'));\n            });\n            if (ids.length == 0) {\n                return;\n            }\n            const promises = ids.map((id, index) => {\n                return new Promise((resolve) => {\n                    let type = types[index];\n                    ctRenderer[type].deleteAnnotation(annotations, id, true);\n                    resolve();\n                });\n            });\n\n            await Promise.all(promises);\n            dispatchEvent('annotationsdeleted', {\n                annotations: this.annotations,\n                ids: ids,\n            });\n        });\n\n        $(document).on('click', '#annotation-list-bulk-copy', async function(e) {\n            e.preventDefault();\n            let copiedIds = $('#annotation-list').find('tr .form-check-input:checked')\n                .map(function() {\n                    return $(this).val();\n                }).get();\n            if (copiedIds.length == 0) {\n                return;\n            }\n            let copiedAnnotations = annotations.filter(x => copiedIds.includes(x.id));\n            copiedAnnotations = copiedAnnotations.map(function(item) {\n                item.wwwroot = M.cfg.wwwroot;\n                return item;\n            });\n            copiedAnnotations = JSON.stringify(copiedAnnotations);\n            // Copy to storage.\n            window.localStorage.setItem('copiedAnnotations', copiedAnnotations);\n            $('#annotation-list-bulk-paste').removeAttr('disabled');\n            $('#annotation-list-bulk-paste').addClass('btn-primary');\n            $('#annotation-list-bulk-paste').find('i').removeClass('bi-clipboard').addClass('bi-clipboard-fill');\n            addNotification(M.util.get_string('annotationscopied', 'mod_interactivevideo'), 'success');\n        });\n\n        $(document).on('click', '#annotation-list-bulk-download', async function(e) {\n            e.preventDefault();\n            $(this).attr('disabled', 'disabled');\n            $(this).find('i').addClass('fa-spin fa-circle-o-notch fa').removeClass('bi bi-download');\n            let downloadIds = $('#annotation-list').find('tr .form-check-input:checked')\n                .map(function() {\n                    return $(this).val();\n                }).get();\n\n            if (downloadIds.length == 0) {\n                return;\n            }\n\n            let copiedAnnotations = annotations.filter(x => downloadIds.includes(x.id));\n            copiedAnnotations = copiedAnnotations.map(function(item) {\n                item.wwwroot = M.cfg.wwwroot;\n                return item;\n            });\n\n            const downloadTask = await $.ajax({\n                url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                method: \"POST\",\n                dataType: \"text\",\n                data: {\n                    action: 'download_annotations',\n                    sesskey: M.cfg.sesskey,\n                    contextid: M.cfg.contextid,\n                    courseid: course,\n                    annotations: JSON.stringify(copiedAnnotations).replace(/</g, '&lt;').replace(/>/g, '&gt;'),\n                    cmid: coursemodule\n                }\n            });\n\n            window.open(downloadTask, '_blank');\n\n            $(this).removeAttr('disabled');\n            $(this).find('i').removeClass('fa-spin fa-circle-o-notch fa').addClass('bi bi-download');\n        });\n\n        // Bulk set as defaults.\n        $(document).on('click', '#annotation-list-bulk-setdefault', async function(e) {\n            e.preventDefault();\n            let selectedIds = $('#annotation-list').find('tr .form-check-input:checked')\n                .map(function() {\n                    return $(this).val();\n                }).get();\n            if (selectedIds.length == 0) {\n                return;\n            }\n            let selectedAnnotations = annotations.filter(x => selectedIds.includes(x.id));\n            // Make sure the annotations are unique based on type.\n            selectedAnnotations = selectedAnnotations.filter((item, index, self) =>\n                index === self.findIndex((t) => (\n                    t.type === item.type\n                ))\n            );\n\n            await $.ajax({\n                url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                method: \"POST\",\n                dataType: \"text\",\n                data: {\n                    action: 'set_defaults',\n                    sesskey: M.cfg.sesskey,\n                    contextid: M.cfg.contextid,\n                    courseid: course,\n                    defaults: JSON.stringify(selectedAnnotations),\n                }\n            });\n            // Trigger the -edit button to reset the view.\n            $('#annotation-list-bulk-edit').trigger('click');\n            addNotification(M.util.get_string('annotationssavedasdefaults', 'mod_interactivevideo'), 'success');\n        });\n\n        // Bulk upload.\n        let ModalForm;\n        $(document).on('click', '#annotation-list-bulk-upload', async function(e) {\n            e.preventDefault();\n            if (!ModalForm) {\n                ModalForm = await import('core_form/modalform');\n            }\n\n            const data = {\n                contextid: M.cfg.contextid,\n                id: coursemodule,\n                courseid: course,\n                annotationid: interaction,\n                prevent: annotations.filter(x => JSON.parse(x.prop).allowmultiple == false).map(x => x.type).join(','),\n            };\n\n            let title = M.util.get_string('uploadannotations', 'mod_interactivevideo');\n            const form = new ModalForm({\n                modalConfig: {\n                    title: title,\n                },\n                formClass: \"mod_interactivevideo\\\\form\\\\bulk_upload_form\",\n                args: data,\n            });\n\n            form.show();\n\n            form.addEventListener(form.events.FORM_SUBMITTED, async(e) => {\n                let imported = e.detail.new;\n                // Check if the imported annotations are valid.\n                imported = imported.filter(x => contentTypes.find(y => y.name === x.type));\n                annotations = annotations.concat(imported);\n                dispatchEvent('annotationupdated', {\n                    annotations: annotations,\n                    action: 'import'\n                });\n            });\n        });\n\n        window.addEventListener('storage', function(e) {\n            // Activate paste button on other tabs.\n            e.stopImmediatePropagation();\n            if (e.key === 'copiedAnnotations') {\n                // Activate paste button.\n                $('#annotation-list-bulk-paste').removeAttr('disabled');\n                $('#annotation-list-bulk-paste').addClass('btn-primary');\n                $('#annotation-list-bulk-paste').find('i').removeClass('bi-clipboard').addClass('bi-clipboard-fill');\n            }\n        });\n\n        // Activate paste button on page load if there are copied annotations.\n        let copiedAnnotations = window.localStorage.getItem('copiedAnnotations');\n        if (copiedAnnotations !== null) {\n            // Don't activate if the same cm.\n            copiedAnnotations = JSON.parse(copiedAnnotations);\n            if (copiedAnnotations[0].cmid == coursemodule) {\n                return;\n            }\n            // Activate paste button.\n            $('#annotation-list-bulk-paste').removeAttr('disabled');\n            $('#annotation-list-bulk-paste').addClass('btn-primary');\n            $('#annotation-list-bulk-paste').find('i').removeClass('bi-clipboard').addClass('bi-clipboard-fill');\n        }\n\n        // Paste annotations.\n        $(document).on('click', '#annotation-list-bulk-paste', async function(e) {\n            e.preventDefault();\n            let copiedAnnotations = window.localStorage.getItem('copiedAnnotations');\n            if (copiedAnnotations === null) {\n                return;\n            }\n            copiedAnnotations = JSON.parse(copiedAnnotations);\n            // Make sure we don't copy the interaction with allowmultiple false;\n            copiedAnnotations = copiedAnnotations.filter(x => {\n                let allowmultiple = JSON.parse(x.prop).allowmultiple;\n                return allowmultiple || (!allowmultiple && !annotations.find(y => y.type == x.type));\n            });\n            if (copiedAnnotations.length == 0) {\n                addNotification(M.util.get_string('annotationscopied', 'mod_interactivevideo'), 'danger');\n                return;\n            }\n            const fromCourse = copiedAnnotations[0].courseid;\n            const fromCm = copiedAnnotations[0].cmid;\n            const toCourse = course;\n            // If it is from the same cm, we need to change the title.\n            if (fromCm == coursemodule) {\n                copiedAnnotations = copiedAnnotations.filter(a => a.type != 'skipsegment').map(function(item) {\n                    if (item.timestamp >= 0) {\n                        item.timestamp = Number(item.timestamp) + 0.1;\n                        item.title = item.title + ' (' + M.util.get_string('copynoun', 'mod_interactivevideo') + ')';\n                    }\n                    return item;\n                });\n            }\n\n            let interactions = await $.ajax({\n                url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                method: \"POST\",\n                dataType: \"text\",\n                data: {\n                    action: 'import_annotations',\n                    sesskey: M.cfg.sesskey,\n                    contextid: M.cfg.contextid,\n                    annotations: JSON.stringify(copiedAnnotations),\n                    tocourse: toCourse,\n                    fromcourse: fromCourse,\n                    tocm: interaction,\n                    fromcm: fromCm,\n                    module: coursemodule\n                }\n            });\n            interactions = JSON.parse(interactions);\n            // Add the imported annotations to the current annotations.\n            annotations = annotations.concat(interactions);\n            dispatchEvent('annotationupdated', {\n                annotations: annotations,\n                action: 'import'\n            });\n\n            // Get interaction that allowmultiple false and init each one.\n            interactions.forEach(int => {\n                if (!int.allowmultiple) {\n                    ctRenderer[int.type].init();\n                }\n            });\n\n        });\n\n        // Bulk deleted\n        $(document).on('annotationsdeleted', function(e) {\n            const ids = e.originalEvent.detail.ids;\n            ids.forEach(function(id) {\n                $(`tr[data-id=\"${id}\"]`).addClass('deleted');\n            });\n            $('#annotation-list-bulk-edit').trigger('click');\n            setTimeout(function() {\n                annotations = annotations.filter(function(item) {\n                    return !ids.includes(item.id);\n                });\n                renderAnnotationItems(annotations);\n                addNotification(M.util.get_string('interactionsdeleted', 'mod_interactivevideo', ids.length), 'success');\n            }, 1000);\n        });\n\n        // Implement keyboard shortcuts.\n        document.addEventListener('keydown', async function(e) {\n            // Ignore spacebar when focus is on an input, textarea, or button\n            const activeTag = document.activeElement.tagName.toLowerCase();\n            if (activeTag !== 'body') {\n                return;\n            }\n\n            if ($('body').hasClass('disablekb')) {\n                return;\n            }\n\n            if (e.code === 'Space') {\n                e.preventDefault(); // Prevent page scroll.\n                if (await player.isPaused()) {\n                    player.play();\n                } else {\n                    player.pause();\n                }\n            } else if (e.code === 'KeyA' && !e.ctrlKey && !e.metaKey) {\n                e.preventDefault();\n                // Launch add content modal.\n                $addcontent.trigger('click');\n            } else if (e.code === 'ArrowRight') {\n                e.preventDefault();\n                // Fast forward.\n                let time = await player.getCurrentTime();\n                if (time >= end || time + 1 > end) {\n                    return;\n                }\n                player.seek(time + 1);\n            } else if (e.code === 'ArrowLeft') {\n                e.preventDefault();\n                // Rewind 10 seconds.\n                let time = await player.getCurrentTime();\n                if (time <= start || time - 1 < start) {\n                    return;\n                }\n                player.seek(time - 1);\n            } else if (e.code === 'KeyI') {\n                e.preventDefault();\n                // Launch import content modal.\n                $('#importcontent').trigger('click');\n            } else if (e.code === 'KeyX') {\n                e.preventDefault();\n                // Launch delete content modal.\n                $('#annotation-list-bulk-delete').trigger('click');\n            } else if (e.code === 'KeyD') {\n                e.preventDefault();\n                // Launch download content modal.\n                $('#annotation-list-bulk-download').trigger('click');\n            } else if (e.code === 'KeyC') {\n                e.preventDefault();\n                // Launch copy content modal.\n                $('#annotation-list-bulk-copy').trigger('click');\n            } else if (e.code === 'KeyP') {\n                e.preventDefault();\n                // Launch paste content modal.\n                $('#annotation-list-bulk-paste').trigger('click');\n            } else if (e.code === 'KeyE') {\n                e.preventDefault();\n                // Launch edit content modal.\n                $('#annotation-list-bulk-edit').trigger('click');\n            } else if (e.code === 'KeyA' && (e.ctrlKey || e.metaKey) && $('#annotation-list-bulk-edit').hasClass('active')) {\n                e.preventDefault();\n                // Launch add content modal.\n                $('#annotation-list-bulk-checkall').trigger('click');\n            } else if (e.code === 'KeyU') {\n                e.preventDefault();\n                // Launch upload content modal.\n                $('#annotation-list-bulk-upload').trigger('click');\n            } else if (e.code === 'Equal') {\n                e.preventDefault();\n                // Launch download content modal.\n                $('#zoomin').trigger('click');\n            } else if (e.code === 'Minus') {\n                e.preventDefault();\n                // Launch download content modal.\n                $('#zoomout').trigger('click');\n            } else if (e.code === 'KeyS' && (e.ctrlKey || e.metaKey)) {\n                e.preventDefault();\n                // Save content.\n                $('#savedraft').trigger('click');\n            }\n        });\n    }\n};\n"],"names":["ModalFactory","player","totaltime","currentTime","ctRenderer","playerReady","isRTL","attr","isBS5","hasClass","bsAffix","$loader","$progressbar","$scrollbar","$scrollhead","$videonav","replaceProgressBars","percentage","css","renderVideoNav","async","annos","start","length","find","empty","remove","forEach","render","x","type","renderItemOnVideoNavigation","time","getCurrentTime","init","url","coursemodule","interaction","course","end","coursecontextid","displayoptions","userid","posterimage","extendedcompletion","error","JSON","parse","text","$videotimeline","$annotationlist","$annotationcanvas","$timelinewrapper","$videowrapper","$playpause","$timelineitemswrapper","$addcontent","require","addNotification","msg","Number","isNaN","contentTypes","annotations","convertSecondsToHMS","s","dynamic","rounded","Math","round","hours","floor","minutes","seconds","parseFloat","toFixed","activeid","renderAnnotationItems","removeClass","live","addClass","html","M","util","get_string","sort","a","b","timestamp","String","localeCompare","item","listItem","clone","renderEditItem","e","window","console","xp","filter","map","reduce","activeAnno","id","postEditCallback","getAnnotations","getItems","$","ajax","cfg","wwwroot","method","dataType","data","action","sesskey","contextid","courseContextId","getContentTypes","when","done","items","contenttypes","y","name","getRenderers","Promise","resolve","count","amdmodule","Type","isEditMode","prop","author","authorlink","description","stringify","editMode","validateTimestampFormat","fld","existing","test","val","validateTimeStartEnd","checkduration","checkexisting","checkskipsegment","parts","split","message","skip","annotation","title","runInteraction","modal","not","pause","updateTime","duration","toUpdatetime","cmid","courseid","onReady","MAX_SAFE_INTEGER","isPaused","seek","unMute","audio","passwordprotected","support","playbackrate","quality","t","ratio","usefixedratio","aspectratio","relWidth","width","startPercentage","newStart","append","i","marker","setCaption","onEnded","toggleClass","focus","currentAnnotation","tooltip","setTimeout","onSeek","onPlayingInterval","visualized","onPlaying","intervalFunction","thisTime","isPlaying","isEnded","cancelAnimationFrame","stop","scrollBar","document","getElementById","rect","getBoundingClientRect","left","right","innerWidth","scrollIntoView","behavior","block","inline","frequency","trigger","useAnimationFrame","animate","requestAnimationFrame","onplay","visualizer","onPause","VideoPlayer","load","IVPLAYER","one","on","detail","is","originalEvent","updated","push","status","removeAttr","target","ctype","this","contenttype","hastimestamp","allowmultiple","addAnnotation","preventDefault","closest","editAnnotation","cloneAnnotation","deleteCancelPromise","then","deleteAnnotation","catch","saveCancel","theAnnotation","play","stopImmediatePropagation","offsetX","hide","siblings","initialValue","key","show","field","value","success","$vseekbar","appendTimestampMarker","formattedTime","targetAnnotation","draggable","resizable","event","ui","position","skipduration","abs","originalPosition","originalSize","size","direction","off","height","localStorage","setItem","drag","offset","playerWidth","getItem","timelineHeight","contentTypeModal","parentOffset","relX","pageX","fadeIn","fadeOut","currentLevel","newLevel","parseInt","timelineElement","scrollWidth","clientWidth","ctrlKey","metaKey","deltaY","addEventListener","scrollLeft","style","scrollHeight","draftAnnotations","create","body","backdrop","removeOnHide","root","getRoot","$body","ModalEvents","hidden","shown","handle","confirmationMessage","returnValue","rate","setRate","getQualities","currentQuality","qualities","qualitiesLabel","q","dropdown","setQuality","resizeTimeout","timelineWrapper","resizeObserver","ResizeObserver","clearTimeout","observe","importmodal","footer","large","removeOnClose","isVerticallyCentered","courses","fullname","courseSelect","shortname","selectfield","destroy","cms","cmSelect","cm","after","interactions","int","icon","outside","disabled","inputs","inputgroup","hascompletion","$selected","selectedInt","each","$row","trim","tocourse","courseId","fromcourse","tocm","fromcm","module","concat","search","toLowerCase","includes","fastforward","fastForwardInterval","setInterval","clearInterval","rewind","rewindInterval","ModalForm","first","prepend","check","ids","types","promises","index","all","copiedIds","get","copiedAnnotations","downloadIds","downloadTask","replace","open","selectedIds","selectedAnnotations","self","findIndex","defaults","annotationid","prevent","join","form","modalConfig","formClass","args","events","FORM_SUBMITTED","imported","new","fromCourse","fromCm","toCourse","activeElement","tagName","code"],"mappings":"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"}