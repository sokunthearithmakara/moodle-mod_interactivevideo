{"version":3,"file":"editannotation.min.js","sources":["../src/editannotation.js"],"sourcesContent":["/* eslint-disable complexity */\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Edit interactions module\n *\n * @module     mod_interactivevideo/editannotation\n * @copyright  2024 Sokunthearith Makara <sokunthearithmakara@gmail.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport $ from 'jquery';\nimport {add as addToast} from 'core/toast';\nimport Notification from 'core/notification';\nimport {dispatchEvent} from 'core/event_dispatcher';\nimport quickform from './quickform';\nimport ModalEvents from 'core/modal_events';\nimport './libraries/jquery-ui';\n\nlet ModalFactory;\nlet ctRenderer = {};\nlet player;\nlet totaltime;\nlet currentTime;\nlet playerReady = false;\nconst isRTL = $('html').attr('dir') == 'rtl';\nconst isBS5 = $('body').hasClass('bs-5');\nconst bsAffix = isBS5 ? '-bs' : '';\nlet $loader = $('#background-loading');\nlet $progressbar = $('#video-nav #progress');\nlet $scrollbar = $('#scrollbar');\nlet $scrollhead = $('#scrollhead-top');\nlet $videonav = $('#video-nav');\n/**\n * Replace the progress bar on the video navigation.\n * @param {Number} percentage - Percentage to replace the progress bar.\n * @returns {void}\n * */\nconst replaceProgressBars = (percentage) => {\n    percentage = percentage < 0 ? 0 : percentage;\n    percentage = percentage > 100 ? 100 : percentage;\n    $progressbar.css('width', percentage + '%');\n    $scrollbar.css('left', percentage + '%');\n    $scrollhead.css('left', percentage + '%');\n};\n/**\n * Render the annotations on the video navigation.\n * @param {Array} annos - Annotations to render.\n * @param {Number} start - Start time of the video.\n * @param {Number} totaltime - Total time of the video.\n * @returns {void}\n * */\nconst renderVideoNav = async function(annos, start, totaltime) {\n    if (annos.length == 0) {\n        $videonav.find('ul').empty();\n        return;\n    }\n\n    $videonav.find('ul').empty();\n    $(\"#video-timeline-wrapper .skipsegment\").remove();\n    annos.forEach(async(x) => {\n        const render = ctRenderer[x.type];\n        await render.renderItemOnVideoNavigation(x);\n    });\n\n    const time = await player.getCurrentTime();\n    // Replace progress bar.\n    const percentage = (time - start) / totaltime * 100;\n    replaceProgressBars(percentage);\n    dispatchEvent('annotationitemsrendered', {'annotations': annos});\n};\n\nexport default {\n    /**\n     * Initialize function on page loads.\n     * @param {String} url video url\n     * @param {Number} coursemodule cm id\n     * @param {Number} interaction cm instance\n     * @param {Number} course course id\n     * @param {Number} start video start time\n     * @param {Number} end video end time\n     * @param {Number} coursecontextid course context id\n     * @param {String} type video type\n     * @param {Object} displayoptions display options\n     * @param {Number} userid user id\n     * @param {String} posterimage poster image\n     * @param {String} extendedcompletion extended completion\n     */\n    init: async function(url, coursemodule, interaction, course, start, end, coursecontextid,\n        type = 'yt', displayoptions, userid, posterimage, extendedcompletion) {\n\n        if (!ModalFactory) {\n            try {\n                ModalFactory = await import('core/modal_factory');\n            } catch (error) {\n                ModalFactory = await import('core/modal');\n            }\n        }\n        displayoptions = $('#doptions').length > 0 ? JSON.parse($('#doptions').text()) : displayoptions;\n\n        let $videonav = $('#video-nav');\n        let $videotimeline = $('#video-timeline');\n        let $annotationlist = $('#annotation-list');\n        let $annotationcanvas = $('#annotation-canvas');\n        let $timelinewrapper = $('#timeline-wrapper');\n        let $videowrapper = $('#video-wrapper');\n        let $playpause = $('#playpause');\n        let $timelineitemswrapper = $('#timeline-items-wrapper');\n        let $addcontent = $('#addcontent');\n\n        quickform();\n\n        require(['theme_boost/bootstrap/modal']);\n        require(['theme_boost/bootstrap/tooltip']);\n        /**\n         * Util function to display notification\n         * @param {String} msg message text\n         * @param {String} type message type\n         */\n        const addNotification = (msg, type = \"info\") => {\n            addToast(msg, {\n                type: type\n            });\n        };\n\n        start = Number(start);\n        if (isNaN(start)) {\n            start = 0;\n        }\n\n        end = Number(end);\n        if (isNaN(end)) {\n            end = null;\n        }\n\n        let annotations = []; // Annotations.\n        let contentTypes; // Content types.\n\n        /**\n         * Convert seconds to HH:MM:SS format\n         * @param {Number} s second\n         * @param {Boolean} dynamic if true, only show minutes and seconds if less than one hour\n         * @param {Boolean} rounded if true, second is rounded\n         * @returns formatted timestamp\n         */\n        const convertSecondsToHMS = (s, dynamic = false, rounded = true) => {\n            if (rounded) {\n                s = Math.round(s);\n            }\n            let hours = Math.floor(s / 3600);\n            let minutes = Math.floor((s - hours * 3600) / 60);\n            let seconds = s - hours * 3600 - minutes * 60;\n            if (rounded && seconds > 59.5) {\n                seconds = 0;\n                minutes++;\n                if (minutes > 59) {\n                    minutes = 0;\n                    hours++;\n                }\n            }\n            if (minutes < 10) {\n                minutes = '0' + minutes;\n            }\n\n            if (rounded) {\n                seconds = Math.round(seconds);\n            } else {\n                seconds = parseFloat(seconds).toFixed(2);\n            }\n\n            if (seconds < 10) {\n                seconds = '0' + seconds;\n            }\n\n            if (dynamic && hours == 0) {\n                return minutes + ':' + seconds;\n            }\n\n            return (hours < 10 ? '0' + hours : hours) + ':' + minutes + ':' + seconds;\n        };\n\n        let activeid = null; // Current active annotation id. Mainly used when editing to relaunch the interaction afte editing.\n\n        /**\n         * Handle rendering of annotation items on the list\n         * @param {Array} annotations array of annotation objects\n         * @returns\n         */\n        const renderAnnotationItems = (annotations) => {\n            $('#annotationwrapper .loader').remove();\n            $annotationlist.empty().removeClass(\"d-flex align-items-center justify-content-center\");\n            if (player.live) {\n                $timelinewrapper.addClass('no-pointer-events');\n                $annotationlist.html(\n                    `${M.util.get_string('interactionsnotsupportedonlivevideo', 'mod_interactivevideo')}`)\n                    .addClass(\"d-flex align-items-center justify-content-center\");\n                return;\n            }\n            renderVideoNav(annotations, start, totaltime);\n            if (annotations.length == 0) {\n                $annotationlist.html(`${M.util.get_string('clickaddtoaddinteraction', 'mod_interactivevideo')}`)\n                    .addClass(\"d-flex align-items-center justify-content-center\");\n                return;\n            }\n            annotations.sort(function(a, b) {\n                // First sort by timestamp, then by type.\n                if (Number(a.timestamp) === Number(b.timestamp)) {\n                    return String(a.type).localeCompare(String(b.type));\n                }\n                // Sort by timestamp.\n                return Number(a.timestamp) - Number(b.timestamp);\n            });\n\n            annotations.forEach(function(item) {\n                let listItem = $('#annotation-template').clone();\n                ctRenderer[item.type].renderEditItem(annotations, listItem, item);\n            });\n\n            let xp = annotations.filter(x => x.xp).map(x => Number(x.xp)).reduce((a, b) => a + b, 0);\n            $(\"#xp span\").text(xp);\n\n            if (activeid) {\n                const activeAnno = annotations.find(x => x.id == activeid);\n                if (activeAnno) {\n                    ctRenderer[activeAnno.type].postEditCallback(activeAnno);\n                }\n            }\n        };\n\n        /**\n         * Get annotations from the server and execute the rendering function\n         * @returns\n         */\n        const getAnnotations = () => {\n            const getItems = $.ajax({\n                url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                method: \"POST\",\n                dataType: \"text\",\n                data: {\n                    action: 'get_items',\n                    sesskey: M.cfg.sesskey,\n                    id: interaction,\n                    contextid: M.cfg.contextid,\n                    coursecontextid: M.cfg.courseContextId\n                }\n            });\n\n            const getContentTypes = $.ajax({\n                url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                method: \"POST\",\n                dataType: \"text\",\n                data: {\n                    action: 'get_all_contenttypes',\n                    sesskey: M.cfg.sesskey,\n                    contextid: M.cfg.contextid,\n                    coursecontextid: M.cfg.courseContextId\n                }\n            });\n\n            $.when(getItems, getContentTypes).done(async function(items, contenttypes) {\n                annotations = JSON.parse(items[0]);\n                if (player.live) {\n                    annotations = [];\n                }\n                contentTypes = JSON.parse(contenttypes[0]);\n                // Remove all annotations that are not in the enabled content types.\n                annotations = annotations.filter(x => contentTypes.find(y => y.name === x.type));\n                const getRenderers = new Promise((resolve) => {\n                    let count = 0;\n                    contentTypes.forEach(x => {\n                        require(['' + x.amdmodule], function(Type) {\n                            ctRenderer[x.name] = new Type(player, annotations, interaction,\n                                course, 0, 0, 0, 0, type, 0, totaltime, start, end, x, coursemodule,\n                                null, displayoptions, null, extendedcompletion, {\n                                isEditMode: true,\n                            });\n                            count++;\n                            ctRenderer[x.name].init();\n                            if (count == contentTypes.length) {\n                                resolve(ctRenderer);\n                            }\n                        });\n                    });\n                });\n                annotations.map(x => {\n                    let prop = contentTypes.find(y => y.name === x.type);\n                    // Clean up the prop by removing author, authorlink, description;\n                    delete prop.author;\n                    delete prop.authorlink;\n                    delete prop.description;\n                    x.prop = JSON.stringify(prop);\n                    x.editMode = true;\n                    return x;\n                });\n                ctRenderer = await getRenderers;\n                renderAnnotationItems(annotations);\n            });\n        };\n\n        /**\n         * Validate given timestamp against format\n         * @param {String} timestamp formatted timestamp hh:mm:ss\n         * @param {String} fld field selector\n         * @param {String} existing existing value\n         * @returns\n         */\n        const validateTimestampFormat = (timestamp, fld, existing) => {\n            const regex = /^([0-9]{2}):([0-5][0-9]):([0-5][0-9])(\\.\\d{2})?$/;\n            if (!regex.test(timestamp)) {\n                addNotification(M.util.get_string('invalidtimestampformat', 'mod_interactivevideo'), 'danger');\n                if (existing) {\n                    $(fld).val(existing);\n                } else {\n                    $(fld).val(convertSecondsToHMS(start, false, false));\n                }\n                return false;\n            }\n            return true;\n        };\n\n        /**\n         * Validate timestamp against start and end time of the video, existing timestamp and skip segments\n         * @param {String} timestamp formatted timestamp\n         * @param {String} fld field selector\n         * @param {String} existing existing value\n         * @param {Number} seconds\n         * @param {Boolean} checkduration if true, check against start and end time\n         * @param {Boolean} checkexisting if true, check against existing annotations\n         * @param {Boolean} checkskipsegment if true, check against skip segments\n         * @returns\n         */\n        const validateTimeStartEnd = (timestamp, fld, existing, seconds, checkduration,\n            checkexisting, checkskipsegment) => {\n            // Convert the timestamp to seconds.\n            const parts = timestamp.split(':');\n            timestamp = Number(parts[0]) * 3600 + Number(parts[1]) * 60 + Number(parts[2]);\n            // Make sure the timestamp is between start and end.\n            if (checkduration) {\n                if (timestamp > end || timestamp < start) {\n                    const message = M.util.get_string('timemustbebetweenstartandendtime', 'mod_interactivevideo', {\n                        \"start\": convertSecondsToHMS(start, true, false),\n                        \"end\": convertSecondsToHMS(end, true, false)\n                    });\n                    addNotification(message, 'danger');\n                    if (existing) {\n                        $(fld).val(existing);\n                    } else {\n                        $(fld).val(convertSecondsToHMS(start, false, false));\n                    }\n                    return -1;\n                }\n            }\n\n            // Make sure the timestamp is not already in the list.\n            if (checkexisting) {\n                if (annotations.find(x => x.timestamp == timestamp) && timestamp != seconds) {\n                    addNotification(M.util.get_string('interactionalreadyexists', 'mod_interactivevideo'), 'danger');\n                    if (existing) {\n                        $(fld).val(existing);\n                    } else {\n                        $(fld).val(convertSecondsToHMS(start, false, false));\n                    }\n                    return -1;\n                }\n            }\n\n            // Make sure timestamp is not in a skip segment.\n            if (checkskipsegment) {\n                const skipsegments = annotations.filter((annotation) => annotation.type == 'skipsegment');\n                const skip = skipsegments.find(x => Number(x.timestamp) < Number(timestamp)\n                    && Number(x.title) > Number(timestamp));\n                if (skip) {\n                    addNotification(M.util.get_string('interactionisbetweentheskipsegment', 'mod_interactivevideo', {\n                        \"start\": convertSecondsToHMS(skip.timestamp, true, false),\n                        \"end\": convertSecondsToHMS(skip.title, true, false)\n                    }), 'danger');\n                    if (existing) {\n                        $(fld).val(existing);\n                    } else {\n                        $(fld).val(convertSecondsToHMS(start, false, false));\n                    }\n                    return -1;\n                }\n            }\n\n            return timestamp;\n        };\n\n        /**\n         * Run interaction\n         * @param {Object} annotation annotation object\n         */\n        const runInteraction = (annotation) => {\n            // Remove the previous message but keep the one below the video.\n            $('#annotation-modal').modal('hide');\n            $('#message').not('[data-placement=bottom]').not('.sticky').remove();\n            $('#end-screen').remove();\n            player.pause();\n            const activityType = ctRenderer[annotation.type];\n            activityType.runInteraction(annotation);\n        };\n\n        /**\n         * Correct the start and end time.\n         * @param {Number} duration Total duration of the video.\n         * @returns {Object} Object containing start and end time.\n         */\n        const updateTime = async(duration) => {\n            duration = Number(duration);\n            let toUpdatetime = false;\n            if (!end || end == 0) {\n                toUpdatetime = true;\n            }\n            if (!start || start >= duration || start < 0 || start >= duration) {\n                toUpdatetime = true;\n            }\n            start = start > duration ? 0 : start;\n            if (toUpdatetime) {\n                await $.ajax({\n                    url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                    method: \"POST\",\n                    dataType: \"text\",\n                    data: {\n                        action: 'update_videotime',\n                        sesskey: M.cfg.sesskey,\n                        cmid: coursemodule,\n                        courseid: course,\n                        id: interaction,\n                        start: start,\n                        end: !end || end == 0 ? duration : end,\n                        contextid: M.cfg.contextid\n                    }\n                });\n            }\n            end = !end || end == 0 || end > duration ? duration : end;\n            return {start, end};\n        };\n\n        /**\n         * Set of events to run after the video player is ready.\n         */\n        const onReady = async() => {\n            if (player.live) {\n                end = Number.MAX_SAFE_INTEGER;\n            }\n            if (player.type != 'yt') {\n                player.pause();\n            }\n            const isPaused = await player.isPaused();\n            if (!isPaused) {\n                if (!player.live) {\n                    await player.seek(start);\n                }\n                player.pause();\n                onReady();\n                return;\n            }\n            player.unMute();\n            if (player.audio) {\n                $annotationcanvas.addClass('bg-black');\n            }\n            if (displayoptions.passwordprotected == 1) {\n                // Remove start screen, set .video-block to d-none, #annotation-canvas remove d-none.\n                $('#start-screen').removeClass('d-none');\n                $('#video-block').removeClass('no-pointer bg-transparent');\n            }\n            if (player.type != 'vimeo'\n                && player.type != 'html5video'\n                && player.type != 'panopto'\n                && player.type != \"peertube\"\n                && player.type != \"dyntube\"\n                && player.type != \"rutube\") { // Vimeo/HTML5 does not pause/play on click.\n                $('#video-block').addClass('no-pointer');\n            }\n\n            if (player.support.playbackrate == false) {\n                $('#changerate').remove();\n            } else {\n                $('#changerate').removeClass('d-none');\n            }\n\n            if (player.support.quality == false) {\n                $('#changequality').remove();\n            } else {\n                $('#changequality').removeClass('d-none');\n            }\n\n            let t = player.totaltime;\n\n            ({start, end} = await updateTime(t));\n\n            totaltime = end - start;\n            // Recalculate the ratio of the video.\n            let ratio = 16 / 9;\n            if (!displayoptions.usefixedratio || displayoptions.usefixedratio == 0) {\n                ratio = player.aspectratio;\n            }\n            $videowrapper.css('padding-bottom', (1 / ratio) * 100 + '%');\n\n            playerReady = true;\n            $annotationcanvas.removeClass('d-none w-0');\n\n            // Handle timeline block.\n            $videotimeline.css({\n                'background-image': 'url(' + posterimage + ')',\n                'background-size': 'contain',\n                'background-repeat': 'no-repeat',\n            });\n            $timelinewrapper.find('#duration').text(convertSecondsToHMS(end, true));\n            $timelinewrapper.find('#currenttime').text(convertSecondsToHMS(start, true));\n\n            // Render minute markers.\n            const minutes = Math.floor(totaltime / 60);\n            $timelineitemswrapper.css('width', (minutes * 300) + 'px'); // 300px per minute as default.\n            const relWidth = $('#timeline-items').width();\n            $('#minute-markers, #minute-markers-bg, #vseek').css('width', relWidth + 'px');\n            let startPercentage = 0;\n            let newStart = start;\n            if (start % 60 != 0) {\n                startPercentage = (60 - (start % 60)) / totaltime * 100;\n                newStart = start + (60 - (start % 60));\n                $('#minute-markers, #minute-markers-bg').append(`<div class=\"minute-marker position-absolute\"\n                        style=\"left: 0%;\"><div class=\"text-white minute-label\"></div></div>`);\n            }\n            for (let i = newStart; i <= end; i += 60) {\n                let percentage = ((i - newStart) / totaltime * 100) + startPercentage;\n                let marker = '';\n                // Format h:m (e.g 3h1m).\n                if (i >= 3600) {\n                    marker = Math.floor(i / 3600) + 'h' + Math.floor((i % 3600) / 60) + 'm';\n                } else {\n                    marker = Math.floor(i / 60) + 'm';\n                }\n                $('#minute-markers').append(`<div class=\"minute-marker position-absolute\"\n                         style=\"left: ${percentage}%;\"><div class=\"text-white minute-label\">${marker}</div></div>`);\n                $('#minute-markers-bg').append(`<div class=\"minute-marker position-absolute\"\n                            style=\"left: ${percentage}%;\"></div>`);\n            }\n\n            if (end % 60 != 0) {\n                $('#minute-markers, #minute-markers-bg').append(`<div class=\"minute-marker position-absolute\"\n                        style=\"left: 100%;\"><div class=\"text-white minute-label\"></div></div>`);\n            }\n\n            // Set caption to null.\n            try {\n                player.setCaption('');\n            } catch (e) {\n                // Do nothing.\n            }\n\n            $scrollbar.css('left', 0);\n            $scrollhead.css('left', 0);\n\n            getAnnotations();\n        };\n\n        /**\n         * Run when video ended (i.e. arrives at 'end' time)\n         */\n        const onEnded = () => {\n            player.pause();\n            $playpause.find('i').removeClass('bi-pause-fill').addClass('bi-play-fill').toggleClass('rotate-360');\n            // Cover the video with a message on a white background div.\n            $videowrapper.append(`<div id=\"end-screen\" class=\"border position-absolute w-100 h-100 bg-white d-flex\n                     justify-content-center align-items-center\" style=\"top: 0; left: 0;\">\n                     <button class=\"btn btn-danger border-0 iv-rounded-circle\" style=\"font-size: 1.5rem;\" id=\"restart\">\n                    <i class=\"bi bi-arrow-repeat\" style=\"font-size: x-large;\"></i></button></div>`);\n            $progressbar.css('width', '100%');\n            $scrollbar.css('left', '100%');\n            $scrollhead.css('left', '100%');\n            // Focus on the restart button.\n            $('#message #restart').focus();\n\n            // If the current time matches the timestamp of an annotation, highlight the annotation.\n            const currentAnnotation = annotations.find((annotation) => annotation.timestamp == end);\n            if (currentAnnotation) {\n                $annotationlist.find('tr').removeClass('active');\n                $annotationlist.find('tr[data-id=\"' + currentAnnotation.id + '\"]').addClass('active');\n                // Show tooltip for two seconds.\n                $videonav.find('.annotation[data-id=\"' + currentAnnotation.id + '\"] .item').tooltip('show');\n                setTimeout(function() {\n                    $videonav.find('.annotation[data-id=\"' + currentAnnotation.id + '\"] .item').tooltip('hide');\n                }, 2000);\n            }\n        };\n\n        /**\n         * Execute when video is sought\n         * @param {Number} t seconds\n         * @returns\n         */\n        const onSeek = async function(t) {\n            if (!playerReady) {\n                return;\n            }\n            if (t) {\n                t = Number(t);\n            } else {\n                t = await player.getCurrentTime();\n            }\n            if (t > start && t < end) {\n                $('#end-screen').remove();\n            }\n            const percentage = (t - start) / (totaltime) * 100;\n            $scrollbar.css('left', percentage + '%');\n            $scrollhead.css('left', percentage + '%');\n            $timelinewrapper.find('#currenttime').text(convertSecondsToHMS(t, true));\n            dispatchEvent('timeupdate', {'time': t});\n        };\n\n        let onPlayingInterval;\n        let visualized = false;\n        /**\n         * Excute when video plays (i.e. start or resume)\n         */\n        const onPlaying = async() => {\n            if (player.live) {\n                return;\n            }\n            const intervalFunction = async function() {\n                let thisTime = await player.getCurrentTime();\n                const isPlaying = await player.isPlaying();\n                const isEnded = await player.isEnded();\n                if (!isPlaying) {\n                    cancelAnimationFrame(onPlayingInterval);\n                    return;\n                }\n\n                if (thisTime < start) {\n                    await player.seek(start);\n                    thisTime = start;\n                }\n\n                if (thisTime >= end || isEnded) {\n                    player.stop(end);\n                    cancelAnimationFrame(onPlayingInterval);\n                    onEnded();\n                    return;\n                }\n                dispatchEvent('timeupdate', {'time': thisTime});\n                let percentage = (thisTime - start) / (totaltime) * 100;\n                // Scroll the timeline so that the current time is in the middle of the timeline.\n                const scrollBar = document.getElementById('scrollbar');\n                // Check if the scrollbar is in view.\n                const rect = scrollBar.getBoundingClientRect();\n                if (rect.left < 0 || rect.right > window.innerWidth) {\n                    scrollBar.scrollIntoView({behavior: \"instant\", block: \"center\", inline: \"center\"});\n                }\n\n                // If the current time matches the timestamp of an annotation, highlight the annotation\n                const currentAnnotation = annotations.find(x => (thisTime - player.frequency) <= x.timestamp\n                    && (thisTime + player.frequency) >= x.timestamp);\n                if (currentAnnotation) {\n                    $annotationlist.find(`tr:not([data-id=\"${currentAnnotation.id}\"])`).removeClass('active');\n                    if (!$annotationlist.find(`tr[data-id=\"${currentAnnotation.id}\"]`).hasClass('active')) {\n                        $annotationlist.find(`tr[data-id=\"${currentAnnotation.id}\"]`)\n                            .addClass('active')\n                            .trigger('mouseenter');\n                        setTimeout(function() {\n                            $annotationlist.find(`tr[data-id=\"${currentAnnotation.id}\"]`).trigger('mouseleave');\n                        }, 2000);\n                    }\n                }\n\n                // If current time is within the skipsegment, seek to the end of the segment.\n                let skipsegments = annotations.filter((annotation) => annotation.type == 'skipsegment');\n                let skip = skipsegments.find(x => Number(x.timestamp) < Number(thisTime)\n                    && Number(x.title) > Number(thisTime));\n                if (skip) {\n                    await player.seek(Number(skip.title));\n                    // Replace the progress bar.\n                    percentage = (skip.title - start) / totaltime * 100;\n                    replaceProgressBars(percentage);\n                }\n            };\n            if (player.useAnimationFrame) {\n                const animate = async() => {\n                    const isPlaying = await player.isPlaying();\n                    if (isPlaying) {\n                        intervalFunction();\n                        onPlayingInterval = requestAnimationFrame(animate);\n                    }\n                };\n                onPlayingInterval = requestAnimationFrame(animate);\n            } else {\n                const isPlaying = await player.isPlaying();\n                if (isPlaying) {\n                    intervalFunction();\n                }\n            }\n        };\n\n        const onplay = async() => {\n            $('#message, #end-screen').not('.sticky').remove();\n            $playpause.find('i').removeClass('bi-play-fill').addClass('bi-pause-fill').removeClass('rotate-360');\n            if (player.audio && !visualized) {\n                player.visualizer();\n                visualized = true;\n            }\n        };\n\n        /**\n         * Excute when video is paused.\n         */\n        const onPause = () => {\n            cancelAnimationFrame(onPlayingInterval);\n            $playpause.find('i').removeClass('bi-pause-fill').addClass('bi-play-fill').toggleClass('rotate-360');\n        };\n\n        // Implement the player\n        require(['mod_interactivevideo/player/' + type], function(VideoPlayer) {\n            if (displayoptions.passwordprotected == 1) {\n                // Remove start screen, set .video-block to d-none, #annotation-canvas remove d-none.\n                $('#video-block').addClass('no-pointer bg-transparent');\n                $annotationcanvas.removeClass('d-none w-0');\n            }\n            player = new VideoPlayer();\n            player.load(\n                url,\n                start,\n                end,\n                {\n                    'customStart': true,\n                    'passwordprotected': displayoptions.passwordprotected == 1,\n                    'showControls': false,\n                    'keyboard': true,\n                }\n            );\n            window.IVPLAYER = player;\n        });\n\n        $(document).one('iv:playerReady', function() {\n            onReady();\n        });\n\n        $(document).on('iv:playerPaused', function() {\n            onPause();\n        });\n\n        $(document).on('iv:playerPlaying', function() {\n            onPlaying();\n        });\n\n        $(document).on('iv:playerPlay', function() {\n            onplay();\n        });\n\n        $(document).on('iv:playerEnded', function() {\n            onEnded();\n        });\n\n        $(document).on('iv:playerSeek', function(e) {\n            onSeek(e.detail.time);\n        });\n\n        $(document).on('iv:playerError', function() {\n            $annotationcanvas.removeClass('d-none w-0');\n            $('#start-screen').addClass('d-none');\n            $('#video-block').addClass('no-pointer bg-transparent');\n            $('#spinner').remove();\n            $('.loader').removeClass('loader');\n            if ($('#player').is(':empty')) {\n                $('#player').html(`<div class=\"alert alert-danger d-flex text-center h-100 rounded-0\n                         align-items-center justify-content-center\">\n                        <img src=\"${M.cfg.wwwroot}/mod/interactivevideo/pix/404-error.png\" alt=\"Error\" class=\"w-25\">\n                        </div>`);\n            } else {\n                addNotification(M.util.get_string('thereisanissueloadingvideo', 'mod_interactivevideo'), 'danger');\n            }\n        });\n\n        $(document).on('timeupdate', function(e) {\n            if (!playerReady) {\n                player.pause();\n                return;\n            }\n            const thisTime = e.detail.time;\n            $timelinewrapper.find('#currenttime').text(convertSecondsToHMS(thisTime, true));\n            let percentage = (thisTime - start) / (totaltime) * 100;\n            replaceProgressBars(percentage);\n        });\n\n        // Post annotation update (add, edit, clone).\n        $(document).on('annotationupdated', function(e) {\n            // Remove any tooltips that may be open.\n            $('.tooltip').remove();\n            $.ajax({\n                url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                method: \"POST\",\n                dataType: \"text\",\n                data: {\n                    action: 'update_ivitems_cache',\n                    sesskey: M.cfg.sesskey,\n                    contextid: M.cfg.contextid,\n                    cmid: interaction,\n                },\n            });\n            if ($('#annotation-list-bulk-edit').hasClass('active')) {\n                $('#annotation-list-bulk-edit').trigger('click');\n            }\n            const action = e.originalEvent.detail.action;\n            if (action == 'import') {\n                annotations = e.originalEvent.detail.annotations;\n                renderAnnotationItems(annotations);\n                addNotification(M.util.get_string('interactionimported', 'mod_interactivevideo'), 'success');\n                return;\n            }\n            let updated = e.originalEvent.detail.annotation;\n            if (action == 'edit' || action == 'draft' || action == 'savedraft') {\n                annotations = annotations.filter(function(item) {\n                    return item.id != updated.id;\n                });\n            }\n            updated.prop = JSON.stringify(contentTypes.find(x => x.name === updated.type));\n            annotations.push(updated);\n            if (action == 'add') {\n                activeid = updated.id;\n            } else {\n                activeid = null;\n            }\n            annotations.map(x => {\n                x.editMode = true;\n                return x;\n            });\n            renderAnnotationItems(annotations);\n            if (action == 'add' || action == 'clone') {\n                addNotification(M.util.get_string('interactionadded', 'mod_interactivevideo'), 'success');\n                $annotationlist.find(`tr[data-id=\"${updated.id}\"]`).addClass('active');\n            } else if (action == 'edit') {\n                addNotification(M.util.get_string('interactionupdated', 'mod_interactivevideo'), 'success');\n                $annotationlist.find(`tr[data-id=\"${updated.id}\"]`).addClass('active');\n                setTimeout(function() {\n                    $annotationlist.find(`tr[data-id=\"${updated.id}\"]`).removeClass('active');\n                }, 1500);\n            }\n\n            // If draft exists, activate the save button.\n            if (annotations.find(x => x.status == 'draft')) {\n                $timelinewrapper.find('#savedraft').removeAttr('disabled').addClass('pulse');\n            } else {\n                $timelinewrapper.find('#savedraft').attr('disabled', 'disabled').removeClass('pulse');\n            }\n\n        });\n\n        // Re-render annotation list and timeline after an annotation is deleted.\n        $(document).on('annotationdeleted', function(e) {\n            // Remove any tooltips that may be open.\n            $('.tooltip').remove();\n            const annotation = e.originalEvent.detail.annotation;\n            activeid = null;\n            $annotationlist.find(`tr[data-id=\"${annotation.id}\"]`).addClass('deleted');\n            setTimeout(function() {\n                annotations = annotations.filter(function(item) {\n                    return item.id != annotation.id;\n                });\n                renderAnnotationItems(annotations);\n                addNotification(M.util.get_string('interactiondeleted', 'mod_interactivevideo'), 'success');\n            }, 1000);\n            if ($($('#annotation-list-bulk-edit')).hasClass('active')) {\n                $('#annotation-list-bulk-edit').trigger('click');\n            }\n        });\n\n        // Implement create annotation\n        $(document).on('click', '#addcontentdropdown .dropdown-item', async function(e) {\n            if (!playerReady) {\n                return;\n            }\n            $('#addcontentdropdown .dropdown-item').removeClass('active');\n            // Check if the target item is a link.\n            if ($(e.target).is('a')) {\n                return;\n            }\n\n            const ctype = $(this).data('type');\n            player.pause();\n            let timestamp = currentTime || await player.getCurrentTime();\n            timestamp = Number(timestamp.toFixed(2));\n            const contenttype = contentTypes.find(x => x.name == ctype);\n            if (contenttype.hastimestamp) {\n                if (annotations.find(x => x.timestamp == timestamp)) {\n                    addNotification(M.util.get_string('interactionalreadyexists', 'mod_interactivevideo'), 'danger');\n                    return;\n                }\n                // Check skip segments\n                const skipsegments = annotations.filter(x => x.type == 'skipsegment');\n                const skip = skipsegments.find(x => Number(x.timestamp) < Number(currentTime)\n                    && Number(x.title) > Number(currentTime));\n                if (skip) {\n                    addNotification(M.util.get_string('interactionisbetweentheskipsegment', 'mod_interactivevideo'), 'danger');\n                    return;\n                }\n            }\n            if (!contenttype.allowmultiple && annotations.find(x => x.type == ctype)) {\n                addNotification(M.util.get_string(\n                    'thisinteractionalreadyexists', 'mod_interactivevideo', contenttype.title), 'danger');\n                return;\n            }\n            currentTime = null;\n            ctRenderer[ctype].addAnnotation(annotations, contenttype.hastimestamp ? timestamp : -1, coursemodule);\n        });\n\n        // Implement edit annotation\n        $(document).on('click', 'tr.annotation .edit', async function(e) {\n            e.preventDefault();\n            const timestamp = $(this).closest('.annotation').data('timestamp');\n            const id = $(this).closest('.annotation').data('id');\n            const contenttype = $(this).closest('.annotation').data('type');\n            ctRenderer[contenttype].editAnnotation(annotations, id, coursemodule);\n            const t = await player.getCurrentTime();\n            if (timestamp && t != timestamp) {\n                await player.seek(timestamp, true);\n            }\n            const isPlaying = await player.isPlaying();\n            if (isPlaying) {\n                player.pause();\n            }\n        });\n\n        // Implement copy annotation\n        $(document).on('click', 'tr.annotation .copy', async function(e) {\n            e.preventDefault();\n            const id = $(this).closest('.annotation').data('id');\n            const contenttype = $(this).closest('.annotation').data('type');\n            const time = await player.getCurrentTime();\n            ctRenderer[contenttype].cloneAnnotation(id, time);\n        });\n\n        // Implement delete annotation.\n        $(document).on('click', 'tr.annotation .delete', async function(e) {\n            e.preventDefault();\n            const isPaused = await player.isPaused();\n            if (!isPaused) {\n                player.pause();\n            }\n            const id = $(this).closest('.annotation').data('id');\n            const annotation = annotations.find(annotation => annotation.id == id);\n            try {\n                Notification.deleteCancelPromise(\n                    M.util.get_string('deleteinteraction', 'mod_interactivevideo'),\n                    M.util.get_string('deleteinteractionconfirm', 'mod_interactivevideo'),\n                    M.util.get_string('delete', 'mod_interactivevideo'),\n                ).then(() => {\n                    return ctRenderer[annotation.type].deleteAnnotation(annotations, id);\n                }).catch(() => {\n                    return;\n                });\n            } catch {\n                Notification.saveCancel(\n                    M.util.get_string('deleteinteraction', 'mod_interactivevideo'),\n                    M.util.get_string('deleteinteractionconfirm', 'mod_interactivevideo'),\n                    M.util.get_string('delete', 'mod_interactivevideo'),\n                    function() {\n                        return ctRenderer[annotation.type].deleteAnnotation(annotations, id);\n                    }\n                );\n            }\n        });\n\n        // Implement view annotation.\n        $(document).on('click', 'tr.annotation .title', async function(e) {\n            e.preventDefault();\n            const timestamp = $(this).closest('.annotation').data('timestamp');\n            // Update the progress bar.\n            const percentage = (timestamp - start) / totaltime * 100;\n            replaceProgressBars(percentage);\n            let currentTime = await player.getCurrentTime();\n            if (currentTime != timestamp) {\n                await player.seek(timestamp, true);\n            }\n            player.pause();\n            const id = $(this).closest('.annotation').data('id');\n            const theAnnotation = annotations.find(annotation => annotation.id == id);\n            setTimeout(() => {\n                runInteraction(theAnnotation);\n            }, 500);\n        });\n\n        // Implement go to timestamp.\n        $(document).on('click', 'tr.annotation .timestamp', async function(e) {\n            e.preventDefault();\n            const timestamp = $(this).data('timestamp');\n            await player.seek(timestamp);\n            player.play();\n        });\n\n        // Right click on the video nav or video timeline to add a new interaction.\n        $(document).on('contextmenu', '#vseek, #video-timeline', async function(e) {\n            if (!playerReady) {\n                return;\n            }\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const percentage = e.offsetX / $(this).width();\n            replaceProgressBars(percentage * 100);\n            currentTime = (percentage * totaltime) + start;\n            let t = await player.getCurrentTime();\n            if (t != currentTime) {\n                await player.seek(currentTime);\n            }\n            player.pause();\n            $addcontent.trigger('click');\n        });\n\n        // Right click on the scrollbar to add a new interaction.\n        $(document).on('contextmenu', '#scrollbar, #scrollhead-top', async function(e) {\n            if (!playerReady) {\n                return;\n            }\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            currentTime = await player.getCurrentTime();\n            $addcontent.trigger('click');\n        });\n\n        // Click the play/pause button on the timeline region to pause/play video.\n        $(document).on('click', '#playpause', async function(e) {\n            if (!playerReady) {\n                return;\n            }\n            e.preventDefault();\n            // Pause or resume the video.\n            let isPlaying = await player.isPlaying();\n            if (isPlaying) {\n                player.pause();\n            } else {\n                let t = await player.getCurrentTime();\n                if (t >= end) {\n                    $('#end-screen #restart').trigger('click');\n                } else {\n                    player.play();\n                }\n            }\n        });\n\n        $(document).on('click', '#video-block', function(e) {\n            if (!playerReady) {\n                return;\n            }\n            e.preventDefault();\n            $playpause.trigger('click');\n        });\n\n        // Right click on the annotation indicator to edit the annotation.\n        $(document).on('contextmenu', '#video-nav .annotation', function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const id = $(this).data('id');\n            // Trigger click on the edit button.\n            $annotationlist.find(`tr.annotation[data-id=\"${id}\"] .edit`).trigger('click');\n        });\n\n        // Quick edit.\n        $(document).on('contextmenu', '[data-editable]', function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            if ($('[data-field].editing').length > 0) {\n                return;\n            }\n            const fld = $(this).data('editable');\n            $(this).hide();\n            $(this).siblings('[data-field=\"' + fld + '\"]').removeClass('d-none').focus().addClass('editing');\n            if (fld == 'timestamp') {\n                $(this).closest('tr')\n                    .append(`<div class=\"timestamp-info position-absolute\">\n                        ${M.util.get_string('rightclicktosetcurrenttime', 'mod_interactivevideo')}</div>`);\n            }\n        });\n\n        $(document).on('contextmenu', '[data-field=\"timestamp\"]', async function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const time = await player.getCurrentTime();\n            $(this).val(convertSecondsToHMS(time, false, false));\n        });\n\n        $(document).on('keyup', '[data-field].editing', function(e) {\n            $(this).removeClass('is-invalid');\n            const initialValue = $(this).data('initial-value');\n            const val = $(this).val();\n            const fld = $(this).data('field');\n            if (val == '') {\n                $(this).addClass('is-invalid');\n            }\n\n            // If escape key is pressed, revert the value.\n            if (e.key == 'Escape') {\n                $(this).val(initialValue);\n                $(this).removeClass('editing');\n                $(this).addClass('d-none');\n                $(this).siblings('[data-editable]').show();\n                $('.timestamp-info').remove();\n                return;\n            }\n            // If enter key is pressed, save the value.\n            if (e.key == 'Enter') {\n\n                let seconds;\n                if (fld == 'timestamp') {\n                    const parts = initialValue.split(':');\n                    seconds = Number(parts[0]) * 3600 + Number(parts[1]) * 60 + Number(parts[2]);\n                    if (!validateTimestampFormat(val, '[data-field].editing', initialValue)) {\n                        $(this).addClass('is-invalid');\n                        return;\n                    }\n                    const timestamp = validateTimeStartEnd(val, '[data-field].editing', initialValue, seconds,\n                        true, true, true);\n                    if (timestamp == -1) {\n                        $(this).addClass('is-invalid');\n                        return;\n                    }\n                    seconds = timestamp;\n                }\n\n                if ($(this).hasClass('is-invalid')) {\n                    return;\n                }\n                if (val == initialValue) {\n                    $(this).removeClass('editing');\n                    $(this).addClass('d-none');\n                    $(this).siblings('[data-editable]').show();\n                    return;\n                }\n                const id = $(this).data('id');\n                $.ajax({\n                    url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                    method: \"POST\",\n                    dataType: \"text\",\n                    data: {\n                        action: 'quick_edit_field',\n                        sesskey: M.cfg.sesskey,\n                        id: id,\n                        field: fld,\n                        contextid: M.cfg.contextid,\n                        value: fld == 'timestamp' ? seconds : val,\n                    },\n                    success: function(data) {\n                        $('.timestamp-info').remove();\n                        const updated = JSON.parse(data);\n                        dispatchEvent('annotationupdated', {\n                            annotation: updated,\n                            action: 'edit'\n                        });\n                    }\n                });\n                return;\n            }\n        });\n\n        $(document).on('blur', '[data-field].editing', function() {\n            const initialValue = $(this).data('initial-value');\n            $(this).val(initialValue);\n            $(this).removeClass('editing');\n            $(this).addClass('d-none');\n            $(this).siblings('[data-editable]').show();\n            $('.timestamp-info').remove();\n        });\n        // End quick edit.\n\n        $(document).on('click', '#end-screen #restart', async function(e) {\n            e.preventDefault();\n            $('#end-screen').remove();\n            await player.seek(start);\n            player.play();\n        });\n\n        // Display tooltip on anntation indicator when annotation on the list is hovered.\n        $(document).on('mouseenter', 'tr.annotation', function() {\n            const id = $(this).data('id');\n            $videonav.find(`ul li[data-id=\"${id}\"] .item`).tooltip('show');\n        });\n\n        // Remove tooltip when annotation on the list is not hovered.\n        $(document).on('mouseleave', 'tr.annotation', function() {\n            const id = $(this).data('id');\n            $videonav.find(`ul li[data-id=\"${id}\"] .item`).tooltip('hide');\n            if (!isBS5) {\n                $('.tooltip').remove();\n            }\n        });\n\n        // Highlight annotation on the list when annotation indicator is hovered.\n        $(document).on('mouseover', '#video-nav ul li', function() {\n            const id = $(this).data('id');\n            $annotationlist.find(`tr.annotation[data-id=\"${id}\"]`).addClass('active');\n        });\n\n        // Remove highlight when annotation indicator is not hovered.\n        $(document).on('mouseout', '#video-nav ul li', function() {\n            const id = $(this).data('id');\n            $annotationlist.find(`tr.annotation[data-id=\"${id}\"]`).removeClass('active');\n        });\n\n        // Validate timestamp when the timestamp field is changed.\n        $(document).on('change', '.timestamp-input, .timestamp-field input', function() {\n            $(this).removeClass('is-invalid');\n            const parts = $(this).val().split(':');\n            const seconds = Number(parts[0]) * 3600 + Number(parts[1]) * 60 + Number(parts[2]);\n            if (!validateTimestampFormat($(this).val(), this)) {\n                $(this).addClass('is-invalid');\n                return;\n            }\n\n            const timestamp = validateTimeStartEnd($(this).val(), this, \"00:00:00\", seconds, true, false, true);\n\n            if (timestamp == -1) {\n                $(this).addClass('is-invalid');\n                return;\n            }\n        });\n\n        let $vseekbar = $('#vseek #bar');\n\n        const appendTimestampMarker = (seconds, rounded) => {\n            const formattedTime = convertSecondsToHMS(seconds, true, rounded);\n            $vseekbar.append(`<div id=\"position-marker\">\n                    <div id=\"position\" class=\"py-0 px-1\" style=\"top:-25px;\">${formattedTime}</div></div>`);\n        };\n\n        $(document).on('annotationitemsrendered', function() {\n            $timelinewrapper.find(`[data${bsAffix}-toggle=\"tooltip\"]`).tooltip({\n                'boundary': 'window',\n                'container': '#timeline',\n            });\n            // Put the minute markers on the timeline;\n            let targetAnnotation = null;\n            // Destroy draggable and resizable if already initialized.\n            try {\n                $('#timeline-items .annotation, #video-timeline-wrapper .skipsegment').draggable('destroy');\n                $('#timeline-items .annotation, #video-timeline-wrapper .skipsegment').resizable('destroy');\n            } catch (e) {\n                // Do nothing.\n            }\n            $('#timeline-items .annotation.li-draggable').draggable({\n                'axis': 'x',\n                'start': async function() {\n                    const isPaused = await player.isPaused();\n                    if (!isPaused) {\n                        player.pause();\n                    }\n                    appendTimestampMarker($(this).data('timestamp'));\n                    $('.tooltip, #message').remove();\n                    $('#timeline-items').addClass('no-pointer-events');\n                },\n                'drag': async function(event, ui) {\n                    $('.tooltip').remove();\n                    let timestamp = ((ui.position.left + 5) / $('#timeline-items').width()) * totaltime + start;\n                    if (timestamp < start) {\n                        timestamp = start;\n                        ui.position.left = -5;\n                    }\n                    if (timestamp > end) {\n                        timestamp = end;\n                        ui.position.left = $('#timeline-items').width() - 5;\n                    }\n                    let percentage = (timestamp - start) / totaltime * 100;\n                    if (percentage < 0) {\n                        percentage = 0;\n                    }\n                    $('#scrollbar, #position-marker, #scrollhead-top').css('left', percentage + '%');\n                    $(this).css('left', percentage + '%');\n                    await player.seek(timestamp);\n                    $('#vseek #position').text(convertSecondsToHMS(timestamp, true, false));\n                },\n                'stop': async function(event, ui) {\n                    $('.tooltip').remove();\n                    $('#vseek #position-marker').remove();\n                    setTimeout(function() {\n                        $('#timeline-items').removeClass('no-pointer-events');\n                    }, 200);\n                    let timestamp = ((ui.position.left + 5) / $('#timeline-items').width()) * totaltime + start;\n                    if (timestamp < start) {\n                        timestamp = start;\n                        $(this).css('left', '-5px');\n                    }\n                    if (timestamp > end) {\n                        timestamp = end;\n                        $(this).css('left', 'calc(100% - 5px)');\n                    }\n                    let percentage = (timestamp - start) / totaltime * 100;\n                    if (percentage < 0) {\n                        percentage = 0;\n                    }\n                    $('#scrollbar, #position-marker, #scrollhead-top').css('left', percentage + '%');\n                    const id = $(this).data('id');\n                    targetAnnotation = annotations.find(x => x.id == id);\n                    const existingAnnotation = annotations.find(x => x.timestamp == timestamp && x.id != id);\n                    if (existingAnnotation) {\n                        addNotification(M.util.get_string('interactionalreadyexists', 'mod_interactivevideo'), 'danger');\n                        renderAnnotationItems(annotations);\n                        return;\n                    }\n                    if (targetAnnotation.timestamp == timestamp) {\n                        return;\n                    }\n                    targetAnnotation.timestamp = timestamp;\n                    targetAnnotation.status = \"draft\";\n                    dispatchEvent('annotationupdated', {\n                        annotation: targetAnnotation,\n                        action: 'draft'\n                    });\n                    $('#scrollbar, #position-marker, #scrollhead-top').css('left', percentage + '%');\n                }\n            });\n\n            $('#video-timeline-wrapper .skipsegment').draggable({\n                'axis': 'x',\n                'start': async function() {\n                    const isPaused = await player.isPaused();\n                    if (!isPaused) {\n                        player.pause();\n                    }\n                    $('#message').remove();\n                    appendTimestampMarker($(this).data('timestamp'));\n                    $('#timeline-items').addClass('no-pointer-events');\n                },\n                'drag': async function(event, ui) {\n                    const id = $(this).data('id');\n                    targetAnnotation = annotations.find(x => x.id == id);\n                    let timestamp = ((ui.position.left) / $('#video-timeline').width()) * totaltime + start;\n                    if (timestamp < start) {\n                        timestamp = start;\n                    }\n\n                    if (timestamp > end) {\n                        timestamp = end;\n                    }\n\n                    let percentage = (timestamp - start) / totaltime * 100;\n                    if (percentage < 0) {\n                        percentage = 0;\n                    }\n                    $('#scrollbar, #position-marker, #scrollhead-top').css('left', percentage + '%');\n                    await player.seek(timestamp);\n                    $('#vseek #position').text(convertSecondsToHMS(timestamp, true, false));\n                },\n                'stop': async function(event, ui) {\n                    $('#vseek #position-marker').remove();\n                    setTimeout(function() {\n                        $('#timeline-items').removeClass('no-pointer-events');\n                    }, 200);\n                    let timestamp = ((ui.position.left) / $('#video-timeline').width()) * totaltime + start;\n                    const id = $(this).data('id');\n                    targetAnnotation = annotations.find(x => x.id == id);\n                    let skipduration = Number(targetAnnotation.title) - Number(targetAnnotation.timestamp);\n                    if (timestamp < 0 && timestamp + skipduration < start) {\n                        renderAnnotationItems(annotations);\n                        return;\n                    }\n                    if (timestamp > end) {\n                        renderAnnotationItems(annotations);\n                        return;\n                    }\n                    if (timestamp < start) {\n                        skipduration = skipduration - Math.abs(start - timestamp);\n                        timestamp = start;\n                    }\n                    if (timestamp + skipduration > end) {\n                        skipduration = Math.abs(end - timestamp);\n                        timestamp = end - skipduration;\n                    }\n                    if (skipduration <= 0) {\n                        renderAnnotationItems(annotations);\n                        return;\n                    }\n                    const existingAnnotation = annotations.find(x => x.timestamp == timestamp && x.id != id);\n                    if (existingAnnotation) {\n                        addNotification(M.util.get_string('interactionalreadyexists', 'mod_interactivevideo'), 'danger');\n                        renderAnnotationItems(annotations);\n                        return;\n                    }\n                    if (targetAnnotation.timestamp == timestamp) {\n                        renderAnnotationItems(annotations);\n                        return;\n                    }\n                    targetAnnotation.timestamp = timestamp;\n                    targetAnnotation.title = timestamp + skipduration;\n                    if (targetAnnotation.title > end) {\n                        targetAnnotation.title = end;\n                    }\n                    targetAnnotation.status = \"draft\";\n                    dispatchEvent('annotationupdated', {\n                        annotation: targetAnnotation,\n                        action: 'draft'\n                    });\n                    let percentage = (timestamp - start) / totaltime * 100;\n                    if (percentage < 0) {\n                        percentage = 0;\n                    }\n                    $('#scrollbar, #position-marker, #scrollhead-top').css('left', percentage + '%');\n                }\n            });\n\n            $('#video-timeline-wrapper .skipsegment').resizable({\n                'containment': '#video-timeline-wrapper',\n                'handles': 'e, w',\n                'start': async function() {\n                    const isPaused = await player.isPaused();\n                    if (!isPaused) {\n                        player.pause();\n                    }\n                    $('#message').remove();\n                    appendTimestampMarker($(this).data('timestamp'));\n                    $('#timeline-items').addClass('no-pointer-events');\n                },\n                'resize': async function(event, ui) {\n                    let timestamp;\n                    if (ui.originalPosition.left != ui.position.left || ui.originalSize.width == ui.size.width) {\n                        if (ui.position.left < 0) {\n                            ui.position.left = 0;\n                        }\n                        timestamp = ((ui.position.left) / $('#video-timeline').width()) * totaltime + start;\n                    } else {\n                        timestamp = ((ui.position.left + ui.size.width) / $('#video-timeline').width()) * totaltime + start;\n                    }\n                    let percentage = (timestamp - start) / totaltime * 100;\n                    if (isNaN(percentage) || percentage < 0) {\n                        percentage = 0;\n                    }\n                    if (percentage > 100) {\n                        percentage = 100;\n                    }\n                    $('#scrollbar, #position-marker, #scrollhead-top').css('left', percentage + '%');\n                    await player.seek(timestamp);\n                    $('#vseek #position').text(convertSecondsToHMS(timestamp, true, false));\n                },\n                'stop': async function(event, ui) {\n                    $('#vseek #position-marker').remove();\n                    setTimeout(function() {\n                        $('#timeline-items').removeClass('no-pointer-events');\n                    }, 200);\n                    const id = $(this).data('id');\n                    targetAnnotation = annotations.find(x => x.id == id);\n                    let timestamp, direction;\n                    if (ui.originalPosition.left != ui.position.left) {\n                        if (ui.position.left < 0) {\n                            ui.position.left = 0;\n                        }\n                        timestamp = ((ui.position.left) / $('#video-timeline').width()) * totaltime + start;\n                        direction = \"left\";\n                    } else {\n                        timestamp = ((ui.position.left + ui.size.width) / $('#video-timeline').width()) * totaltime + start;\n                        direction = \"right\";\n                    }\n                    const existingAnnotation = annotations.find(x => x.timestamp == timestamp && x.id != id);\n                    if (existingAnnotation) {\n                        addNotification(M.util.get_string('interactionalreadyexists', 'mod_interactivevideo'), 'danger');\n                        renderAnnotationItems(annotations);\n                        return;\n                    }\n                    if (targetAnnotation.timestamp == timestamp) {\n                        return;\n                    }\n                    if (direction == \"left\") {\n                        targetAnnotation.timestamp = timestamp;\n                    } else {\n                        targetAnnotation.title = timestamp;\n                        if (targetAnnotation.title > end) {\n                            targetAnnotation.title = end;\n                        }\n                    }\n                    targetAnnotation.status = 'draft';\n                    dispatchEvent('annotationupdated', {\n                        annotation: targetAnnotation,\n                        action: 'draft'\n                    });\n\n                    let percentage = (timestamp - start) / totaltime * 100;\n                    if (isNaN(percentage) || percentage < 0) {\n                        percentage = 0;\n                    }\n                    if (percentage > 100) {\n                        percentage = 100;\n                    }\n                    $('#scrollbar, #position-marker, #scrollhead-top').css('left', percentage + '%');\n                }\n            });\n\n            $('#video-timeline-wrapper .skipsegment').off('contextmenu').on('contextmenu', function(e) {\n                e.preventDefault();\n                e.stopImmediatePropagation();\n                const id = $(this).data('id');\n                $(`tr.annotation[data-id=\"${id}\"] .edit`).trigger('click');\n            });\n\n            $('#video-timeline-wrapper .skipsegment').off('click').on('click', async function(e) {\n                e.preventDefault();\n                const timestamp = $(this).data('timestamp');\n                await player.seek(timestamp);\n                const isPaused = await player.isPaused();\n                if (!isPaused) {\n                    player.pause();\n                }\n            });\n\n            $('#video-timeline-wrapper .skipsegment .delete-skipsegment').off('click').on('click', function(e) {\n                e.preventDefault();\n                const id = $(this).closest('.skipsegment').data('id');\n                $(`tr.annotation[data-id=\"${id}\"] .delete`).trigger('click');\n            });\n        });\n\n        $('#scrollbar').draggable({\n            'containment': '#timeline-items',\n            'axis': 'x',\n            'cursor': 'col-resize',\n            'start': async function(event, ui) {\n                const isPaused = await player.isPaused();\n                if (!isPaused) {\n                    player.pause();\n                }\n                $('#timeline-items').addClass('no-pointer-events');\n                $(\"#message\").remove();\n                appendTimestampMarker(((ui.position.left) / $('#timeline-items').width()) * totaltime + start, false);\n            },\n            'drag': async function(event, ui) {\n                let timestamp = ((ui.position.left) / $('#timeline-items').width()) * totaltime + start;\n                let percentage = (timestamp - start) / totaltime * 100;\n                $('#vseek #position').text(convertSecondsToHMS(timestamp, true, false));\n                $('#vseek #position-marker, #scrollhead-top, #scrollbar')\n                    .css('left', percentage + '%');\n                await player.seek(timestamp);\n            },\n            'stop': async function(event, ui) {\n                $('#vseek #position-marker').remove();\n                setTimeout(function() {\n                    $('#timeline-items').removeClass('no-pointer-events');\n                }, 200);\n                // Convert the position to percentage\n                let timestamp = ((ui.position.left) / $('#timeline-items').width()) * totaltime + start;\n                let percentage = (timestamp - start) / totaltime * 100;\n                if (isNaN(percentage) || percentage < 0) {\n                    percentage = 0;\n                }\n                if (percentage > 100) {\n                    percentage = 100;\n                }\n                $('#scrollbar, #scrollhead-top').css('left', percentage + '%');\n                const isPaused = await player.isPaused();\n                if (!isPaused) {\n                    player.pause();\n                }\n            }\n        });\n\n        $('#scrollhead-top').draggable({\n            'axis': 'x',\n            'cursor': 'col-resize',\n            'start': async function(event, ui) {\n                const isPaused = await player.isPaused();\n                if (!isPaused) {\n                    player.pause();\n                }\n                $('#vseek').addClass('no-pointer-events');\n                $(\"#message\").remove();\n                appendTimestampMarker(((ui.position.left) / $('#vseek').width()) * totaltime + start, false);\n            },\n            'drag': async function(event, ui) {\n                let timestamp = ((ui.position.left) / $('#vseek').width()) * totaltime + start;\n                let percentage = (timestamp - start) / totaltime * 100;\n                if (isNaN(percentage) || percentage < 0) {\n                    percentage = 0;\n                }\n                if (percentage > 100) {\n                    percentage = 100;\n                }\n                if (timestamp < start) {\n                    timestamp = start;\n                }\n                $('#vseek #position').text(convertSecondsToHMS(timestamp, true, false));\n                $('#vseek #position-marker, #scrollhead-top, #scrollbar')\n                    .css('left', percentage + '%');\n                await player.seek(timestamp);\n            },\n            'stop': async function(event, ui) {\n                $('#vseek #position-marker').remove();\n                setTimeout(function() {\n                    $('#vseek').removeClass('no-pointer-events');\n                }, 200);\n                // Convert the position to percentage\n                let timestamp = ((ui.position.left) / $('#vseek').width()) * totaltime + start;\n                if (timestamp < start) {\n                    timestamp = start;\n                }\n                let percentage = (timestamp - start) / totaltime * 100;\n                if (isNaN(percentage) || percentage < 0) {\n                    percentage = 0;\n                }\n                if (percentage > 100) {\n                    percentage = 100;\n                }\n                $('#scrollbar, #scrollhead-top').css('left', percentage + '%');\n                let t = await player.getCurrentTime();\n                if (t === timestamp) {\n                    return;\n                }\n                const isPaused = await player.isPaused();\n                if (!isPaused) {\n                    player.pause();\n                }\n            }\n        });\n\n        // Resize timeline.\n        $('#timeline-wrapper').resizable({\n            'handles': 'n',\n            'minHeight': 125,\n            'maxHeight': 500,\n            'start': function() {\n                $('#top-region, #timeline-wrapper').addClass('no-pointer-events');\n            },\n            'resize': function(event, ui) {\n                $('#top-region').css('height', `calc(100dvh - ${ui.size.height + 70}px)`);\n            },\n            'stop': function() {\n                $('#top-region, #timeline-wrapper').removeClass('no-pointer-events');\n                localStorage.setItem('timeline-height', $('#timeline-wrapper').height());\n            }\n        });\n\n        // Resize player region.\n        $('#separator').draggable({\n            'axis': 'x',\n            'containment': '#wrapper',\n            'grid': [1, 0],\n            'start': function() {\n                $('#wrapper').addClass('no-pointer-events');\n            },\n            drag: function() {\n                const parentOffset = $(this).offset();\n                const width = parentOffset.left;\n                if (!isRTL) {\n                    $('#player-region').css('width', width + 'px');\n                    $('#content-region').css('width', 'calc(100% - ' + width + 'px)');\n                } else {\n                    $('#player-region').css('width', 'calc(100% - ' + width + 'px)');\n                    $('#content-region').css('width', width + 'px');\n                }\n            },\n            stop: function() {\n                const width = $(this).offset().left;\n                // Save this to local storage\n                localStorage.setItem('player-width', width);\n                $('#wrapper').removeClass('no-pointer-events');\n            }\n        });\n\n        // Set player region width from the saved width in local storage.\n        const playerWidth = localStorage.getItem('player-width');\n        if (playerWidth > 0 && window.innerWidth > 992) {\n            $('#separator').css('left', playerWidth + 'px');\n            if (!isRTL) {\n                $('#player-region').css('width', playerWidth + 'px');\n                $('#content-region').css('width', 'calc(100% - ' + playerWidth + 'px)');\n            } else {\n                $('#player-region').css('width', 'calc(100% - ' + playerWidth + 'px)');\n                $('#content-region').css('width', playerWidth + 'px');\n            }\n        } else {\n            $('#separator').css('left', `50%`);\n            $('#player-region').css('width', `50%`);\n            $('#content-region').css('width', `50%`);\n        }\n\n        // Set timeline height from saved height in local storage.\n        const timelineHeight = localStorage.getItem('timeline-height');\n        if (timelineHeight) {\n            $('#timeline-wrapper').css('height', timelineHeight + 'px');\n            $('#top-region').css('height', `calc(100dvh - ${Number(timelineHeight) + 70}px)`);\n        }\n\n        // Seek bar functionalities\n        $('#vseek #bar, #video-timeline').on('mouseenter', function(e) {\n            $('#cursorbar, #position-marker').remove();\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            // First clone the #scrollbar and place it where the cursor is.\n            let $scrollbar = $('#scrollbar').clone();\n            $scrollbar.attr('id', 'cursorbar');\n            $scrollbar.addClass('no-pointer-events');\n\n            const parentOffset = $(this).offset();\n            const relX = e.pageX - parentOffset.left;\n\n            $scrollbar.css('left', (relX + 5) + 'px');\n            $scrollbar.find('#scrollhead').remove();\n            const percentage = relX / $(this).width();\n            const time = percentage * (totaltime) + start;\n            const formattedTime = convertSecondsToHMS(time, true, false);\n            $('#vseek #bar').append(`<div id=\"position-marker\">\n                    <div id=\"position\" class=\"py-0 px-1\" style=\"top:-25px;\">${formattedTime}</div></div>`);\n            $('#vseek #position-marker').css('left', relX + 'px');\n            $('#timeline-items').append($scrollbar);\n        });\n\n        $('#vseek #bar, #video-timeline').on('mouseleave', function(e) {\n            e.stopImmediatePropagation();\n            $('#vseek #position-marker, #cursorbar').remove();\n            // Remove highlight.\n            $('tr.annotation.active').removeClass('active');\n        });\n\n        $('#vseek #bar, #video-timeline').on('mousemove', function(e) {\n            e.stopImmediatePropagation();\n            const parentOffset = $(this).offset();\n            const relX = e.pageX - parentOffset.left;\n            const percentage = relX / $(this).width();\n            let time = percentage * (totaltime) + start;\n            if (time < start) {\n                time = start;\n            }\n            const formattedTime = convertSecondsToHMS(time, true, false);\n            // Move the cursorbar\n            $('#cursorbar').css('left', (relX + 5) + 'px');\n            $('#vseek #position').text(formattedTime);\n            $('#vseek #position-marker').css('left', relX + 'px');\n        });\n\n        // Run interaction when annotation indicator is clicked.\n        $(document).on('click', '#video-nav .annotation', async function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const id = $(this).data('id');\n            const annotation = annotations.find(x => x.id == id);\n            $loader.fadeIn(300);\n            if (await player.getCurrentTime() != annotation.timestamp) {\n                await player.seek(annotation.timestamp);\n            }\n            $loader.fadeOut(300);\n            runInteraction(annotation);\n        });\n\n        // Seek video on click on timeline or video nav.\n        $(document).on('click', '#vseek #bar, #video-timeline', async function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const percentage = e.offsetX / $(this).width();\n            const time = percentage * (totaltime) + start;\n            const t = await player.getCurrentTime();\n            if (t === time) {\n                return;\n            }\n            replaceProgressBars(percentage * 100);\n            $loader.fadeIn(300);\n            const isPaused = await player.isPaused();\n            if (!isPaused) {\n                player.pause();\n            }\n            await player.seek(time);\n            $loader.fadeOut(300);\n            $(\"#message, #end-screen\").remove();\n        });\n\n        // Implement timeline zoom out.\n        $('#zoomout').on('click', function() {\n            const currentLevel = $timelineitemswrapper.css('width'); // In px.\n            const newLevel = parseInt(currentLevel) - 300;\n            $timelineitemswrapper.css('width', newLevel + 'px');\n            const relWidth = $('#timeline-items').width();\n            $('#minute-markers, #minute-markers-bg, #vseek').css('width', relWidth + 'px');\n            let timelineElement = document.getElementById('timeline');\n            if (timelineElement.scrollWidth <= timelineElement.clientWidth) {\n                $(this).attr('disabled', 'disabled');\n            }\n            dispatchEvent('annotationitemsrendered', {'annotations': annotations});\n        });\n\n        // Implement timeline zoom in.\n        $('#zoomin').on('click', function() {\n            const currentLevel = $timelineitemswrapper.css('width'); // In px.\n            const newLevel = parseInt(currentLevel) + 300;\n            $timelineitemswrapper.css('width', newLevel + 'px');\n            const relWidth = $('#timeline-items').width();\n            $('#minute-markers, #minute-markers-bg, #vseek').css('width', relWidth + 'px');\n            $('#zoomout').removeAttr('disabled');\n            dispatchEvent('annotationitemsrendered', {'annotations': annotations});\n        });\n\n        // Implement zoom in and zoom out on mouse scroll on timeline.\n        $(\"#timeline\").on('wheel', function(e) {\n            if (e.ctrlKey || e.metaKey) {\n                e.preventDefault();\n                if (e.originalEvent.deltaY < 0) {\n                    $('#zoomin').trigger('click');\n                } else {\n                    $('#zoomout').trigger('click');\n                }\n            }\n        });\n\n        document.getElementById('timeline').addEventListener('scroll', function() {\n            document.getElementById('minute-markers-wrapper').scrollLeft = this.scrollLeft;\n            document.getElementById('vseek').style.left = -this.scrollLeft + 'px';\n            document.getElementById('minute-markers-bg-wrapper').style.left = -this.scrollLeft + 'px';\n            document.getElementById('scrollbar').scrollHeight = this.scrollHeight;\n        });\n\n        // Save timeline changes.\n        $('#savedraft').on('click', function(e) {\n            e.stopImmediatePropagation();\n            let draftAnnotations = annotations.filter(x => x.status == 'draft');\n            let count = 0;\n            draftAnnotations.forEach(function(a) {\n                $.ajax({\n                    url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                    method: \"POST\",\n                    dataType: \"text\",\n                    data: {\n                        action: 'quick_edit_field',\n                        sesskey: M.cfg.sesskey,\n                        id: a.id,\n                        field: 'timestamp',\n                        contextid: M.cfg.contextid,\n                        value: a.timestamp,\n                    },\n                    success: function(data) {\n                        const updated = JSON.parse(data);\n                        dispatchEvent('annotationupdated', {\n                            annotation: updated,\n                            action: 'savedraft'\n                        });\n                    }\n                });\n                if (a.type == 'skipsegment') {\n                    $.ajax({\n                        url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                        method: \"POST\",\n                        dataType: \"text\",\n                        data: {\n                            action: 'quick_edit_field',\n                            sesskey: M.cfg.sesskey,\n                            id: a.id,\n                            field: 'title',\n                            contextid: M.cfg.contextid,\n                            value: a.title,\n                        },\n                        success: function(data) {\n                            const updated = JSON.parse(data);\n                            dispatchEvent('annotationupdated', {\n                                annotation: updated,\n                                action: 'savedraft'\n                            });\n                        }\n                    });\n                }\n                count++;\n                if (count == draftAnnotations.length) {\n                    addNotification(M.util.get_string('draftsaved', 'mod_interactivevideo'), 'success');\n                }\n            });\n\n        });\n\n\n        // Launch content selection modal.\n        let contentTypeModal;\n        $addcontent.on('click', async function(e) {\n            e.preventDefault();\n            if (!playerReady) {\n                return;\n            }\n            if (contentTypeModal) {\n                contentTypeModal.show();\n                return;\n            }\n            contentTypeModal = await ModalFactory.create({\n                title: '',\n                body: '',\n                backdrop: 'static',\n                removeOnHide: false,\n            });\n            let root = contentTypeModal.getRoot();\n            let $body = $('#contentmodal-original .modal-content').html();\n            root.attr('id', 'contentmodal');\n            root.find('.modal-dialog .modal-content').html($body);\n            contentTypeModal.show();\n\n            root.on(ModalEvents.hidden, function() {\n                $('#addcontentdropdown .dropdown-item').removeClass('active');\n            });\n\n            root.on(ModalEvents.shown, function() {\n                player.pause();\n                // Apply jelly animation after DOM is ready\n                setTimeout(() => {\n                    root.addClass('jelly-anim');\n                }, 10);\n\n                // Make the modal draggable.\n                root.find('.modal-dialog').draggable({\n                    handle: \".modal-header\"\n                });\n            });\n\n            root.on('click', '.modal-header [type=\"button\"]', function() {\n                contentTypeModal.hide();\n            });\n\n            root.on('click', '.dropdown-item', function() {\n                root.removeClass('jelly-anim');\n                contentTypeModal.hide();\n            });\n        });\n\n        // Inform user to save changes before close or unload the current page.\n        window.addEventListener('beforeunload', (e) => {\n            if (annotations.find(x => x.status == 'draft')) {\n                const confirmationMessage = M.util.get_string('unsavedchanges', 'mod_interactivevideo');\n                e.returnValue = confirmationMessage;\n                return confirmationMessage;\n            }\n            return true;\n        });\n\n        // Implement the rate change.\n        $(document).on('click', '.changerate', function(e) {\n            e.preventDefault();\n            const rate = $(this).data('rate');\n            player.setRate(rate);\n            $('.changerate').find('i').removeClass('bi-check');\n            $(this).find('i').addClass('bi-check');\n        });\n\n        $(document).on('iv:playerRateChange', function(e) {\n            $('.changerate').find('i').removeClass('bi-check');\n            $(`.changerate[data-rate=\"${e.originalEvent.detail.rate}\"]`).find('i').addClass('bi-check');\n        });\n\n        // Handle video control:: Quality change\n        $(\"#changequality\").on('shown.bs.dropdown', async function() {\n            let quality = await player.getQualities();\n            $('#qualitieslist').empty();\n            let currentQuality = quality.currentQuality;\n            if (currentQuality === null) {\n                currentQuality = $(this).data('current');\n            }\n            let qualities = quality.qualities;\n            let qualitiesLabel = quality.qualitiesLabel;\n            qualities.forEach((q, i) => {\n                $('#qualitieslist').append(`<a class=\"dropdown-item changequality px-3\" data-quality=\"${q}\"\n                         href=\"#\"><i class=\"bi ${q == currentQuality ? 'bi-check' : ''} fa-fw\"></i>${qualitiesLabel[i]}</a>`);\n            });\n            $(this).find(`[data${bsAffix}-toggle=dropdown]`).dropdown('update');\n        });\n\n        $(document).on('click', '.changequality', function(e) {\n            e.preventDefault();\n            const quality = $(this).data('quality');\n            player.setQuality(quality);\n            $('.changequality').find('i').removeClass('bi-check');\n            $(this).find('i').addClass('bi-check');\n        });\n\n        // Observe timeline-wrapper width change.\n        let timelineWrapper = document.getElementById('timeline-wrapper');\n        let resizeTimeout;\n        let resizeObserver = new ResizeObserver(() => {\n            clearTimeout(resizeTimeout);\n            resizeTimeout = setTimeout(() => {\n                const relWidth = $('#timeline-items').width();\n                $('#minute-markers, #minute-markers-bg, #vseek').css('width', relWidth + 'px');\n            }, 100);\n        });\n\n        resizeObserver.observe(timelineWrapper);\n\n        // Implement import content\n        $(document).on('click', '#importcontent', async function(e) {\n            e.preventDefault();\n            const importmodal = await ModalFactory.create({\n                body: ``,\n                title: M.util.get_string('importcontent', 'mod_interactivevideo'),\n                footer: `<button type=\"button\" class=\"btn btn-secondary border-0\" data${bsAffix}-dismiss=\"modal\">\n                        ${M.util.get_string('cancel', 'mod_interactivevideo')}</button>\n                        <button type=\"button\" class=\"btn btn-primary border-0\" id=\"importcontentbutton\">\n                        ${M.util.get_string('import', 'mod_interactivevideo')}</button>`,\n                show: false,\n                large: true,\n                removeOnClose: true,\n                isVerticallyCentered: true,\n            });\n            let root = importmodal.getRoot();\n            root.attr('id', 'importmodal');\n            importmodal.show();\n            root.off(ModalEvents.shown);\n            root.on(ModalEvents.shown, async function() {\n                root.find('.modal-dialog').draggable({\n                    handle: \".modal-header\"\n                });\n\n                // Render the course select dropdown.\n                $.ajax({\n                    url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                    method: \"POST\",\n                    dataType: \"text\",\n                    data: {\n                        action: 'get_taught_courses',\n                        sesskey: M.cfg.sesskey,\n                        contextid: M.cfg.contextid,\n                        userid: userid\n                    },\n                    success: function(data) {\n                        let courses = JSON.parse(data);\n                        // Sort courses by name.\n                        courses.sort((a, b) => a.fullname.localeCompare(b.fullname));\n                        let courseSelect = `<select class=\"${isBS5 ? 'form' : 'custom'}-select w-100\" id=\"importcourse\">`;\n                        courses.forEach(course => {\n                            courseSelect += `<option value=\"${course.id}\">${course.fullname} (${course.shortname})</option>`;\n                        });\n                        courseSelect += `</select>`;\n                        let selectfield = `<div class=\"iv-form-group selectcourse\">\n                            <label class=\"iv-font-weight-bold form-label\" for=\"importcourse\">\n                            ${M.util.get_string('selectcourse', 'mod_interactivevideo')}</label>\n                            ${courseSelect}</div>`;\n                        root.find('.modal-body').empty();\n                        root.find('.modal-body').append(selectfield);\n\n                        // Default current course.\n                        root.find('#importcourse').val(course);\n                        root.find('#importcourse').trigger('change');\n                    }\n                });\n            });\n\n            root.on(ModalEvents.hidden, function() {\n                importmodal.destroy();\n            });\n\n            root.off('change', '#importcourse');\n            root.on('change', '#importcourse', function() {\n                root.find('.selectcm, .select-interaction').remove();\n                $.ajax({\n                    url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                    method: \"POST\",\n                    dataType: \"text\",\n                    data: {\n                        action: 'get_cm_by_courseid',\n                        sesskey: M.cfg.sesskey,\n                        contextid: M.cfg.contextid,\n                        courseid: $(this).val()\n                    },\n                    success: function(data) {\n                        let cms = JSON.parse(data);\n                        cms.sort((a, b) => a.name.localeCompare(b.name));\n                        let cmSelect = `<select class=\"${isBS5 ? 'form' : 'custom'}-select w-100\" id=\"importcm\">\n                        <option value=\"\">${M.util.get_string('select', 'mod_interactivevideo')}</option>`;\n                        cms.forEach(cm => {\n                            cmSelect += `<option value=\"${cm.id}\"\n                                 ${cm.id == interaction ? 'disabled' : ''}>${cm.name}</option>`;\n                        });\n                        cmSelect += `</select>`;\n                        let selectfield = `<div class=\"iv-form-group selectcm\">\n                        <label for=\"importcm\" class=\"iv-font-weight-bold form-label\">\n                        ${M.util.get_string('selectactivity', 'mod_interactivevideo')}</label>\n                        ${cmSelect}</div>`;\n                        root.find('.selectcourse').after(selectfield);\n                    }\n                });\n            });\n\n            root.off('change', '#importcm');\n            root.on('change', '#importcm', async function() {\n                root.find('.select-interaction').remove();\n                root.find('#importcm').after(`<div class=\"select-interaction py-3\">\n                    <iframe src=\"${M.cfg.wwwroot + '/mod/interactivevideo/view.php?i=' + $(this).val()}&embed=1&preview=1\"\n                    frameborder=0 width=\"100%\" height=\"500\" class=\"loader\"></iframe></div>`);\n                let interactions = await $.ajax({\n                    url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                    method: \"POST\",\n                    dataType: \"text\",\n                    data: {\n                        action: 'get_items',\n                        sesskey: M.cfg.sesskey,\n                        id: $(this).val(),\n                        contextid: M.cfg.contextid,\n                        coursecontextid: M.cfg.courseContextId\n                    }\n                });\n                interactions = JSON.parse(interactions);\n                interactions = interactions.filter(x => x.type != 'skipsegment');\n                if (interactions.length == 0) {\n                    root.find('.select-interaction').append(`<div class=\"alert alert-warning mt-3\">\n                        ${M.util.get_string('nocontent', 'mod_interactivevideo')}</div>`);\n                    return;\n                }\n\n                root.find('.select-interaction').append(`<div class=\"input-group mb-1 w-100 flex-nowrap align-items-center\n                     no-pointer\">\n                     <div class=\"input-group-prepend border-0 invisible\">\n                            <label class=\"input-group-text bg-white\">\n                                <input type=\"checkbox\"/>\n                                <i class=\"bi bi-plus iv-ml-3 fs-unset\"></i>\n                            </label>\n                        </div>\n                        <input type=\"text\" class=\"form-control border-0 iv-font-weight-bold\"\n                        value=\"${M.util.get_string('title', 'mod_interactivevideo')}\">\n                        <input type=\"text\" class=\"form-control border-0 iv-font-weight-bold\" style=\"max-width: 50px;\"\n                        value=\"XP\">\n                        <input type=\"text\" style=\"max-width: 150px;\"\n                         value=\"${M.util.get_string('timestamp', 'mod_interactivevideo')}\"\n                        class=\"form-control border-0 iv-font-weight-bold\"></div>`);\n\n                interactions = interactions.map(int => {\n                    // Get the icon and check if the interaction is out of range (start, end time);\n                    const ctype = contentTypes.find(y => y.name === int.type);\n                    int.prop = JSON.stringify(ctype);\n                    int.icon = ctype.icon;\n                    if ((int.timestamp > end || int.timestamp < start) && int.timestamp > 0) {\n                        int.outside = true;\n                    } else {\n                        int.outside = false;\n                    }\n                    // Check if the interaction can be added (e.g. annotation content type can only be added once per activity);\n                    if (!ctype.allowmultiple && annotations.find(x => x.type == int.type)) {\n                        int.disabled = true;\n                    }\n                    return int;\n                });\n\n                interactions.sort((a, b) => a.timestamp - b.timestamp);\n                let inputs = '';\n                interactions.forEach(int => {\n                    const inputgroup = `<div class=\"input-group mb-1 w-100 flex-nowrap align-items-center\"\n                        data-id=\"${int.id}\">\n                        <div class=\"input-group-prepend\">\n                            <label class=\"input-group-text\">\n                                <input type=\"checkbox\" ${int.disabled ? 'disabled' : ''}/>\n                                <i class=\"${int.icon} iv-ml-3 fs-unset\"></i>\n                            </label>\n                        </div>\n                        <input type=\"text\" class=\"form-control name\" ${int.timestamp < 0 ? 'readonly' : ''}\n                        value=\"${int.title}\">\n                        <input type=\"text\" style=\"max-width: 50px;\" ${int.timestamp < 0 || int.hascompletion == 0 ? 'readonly' : ''}\n                        class=\"form-control xp\" value=\"${int.xp}\">\n                        <input type=\"text\" placeholder=\"00:00:00\" style=\"max-width: 150px;\" ${int.timestamp < 0 ? 'readonly' : ''}\n                        class=\"form-control timestamp-input ${int.outside ? 'is-invalid' : ''}\"\n                        value=\"${int.timestamp < 0 ? int.timestamp : convertSecondsToHMS(int.timestamp, false, false)}\"></div>`;\n                    inputs += inputgroup;\n                });\n                root.find('.select-interaction').append(inputs);\n\n                root.off('click', '#importcontentbutton').on('click', '#importcontentbutton',\n                    async function(e) {\n                        e.preventDefault();\n                        let $selected = root.find(`.select-interaction input[type=\"checkbox\"]:checked`);\n                        let selectedInt = [];\n                        $selected.each(function() {\n                            let $row = $(this).closest('.input-group');\n                            const name = $row.find('.name').val();\n                            if (name.trim() == '') {\n                                return;\n                            }\n                            let timestamp = $row.find('.timestamp-input').val();\n                            if (timestamp == '') {\n                                return;\n                            }\n\n                            if (Number(timestamp) < 0) {\n                                timestamp = Number(timestamp);\n                            } else {\n                                const parts = timestamp.split(':');\n                                timestamp = Number(parts[0]) * 3600 + Number(parts[1]) * 60 + Number(parts[2]);\n                                if (annotations.find(x => x.timestamp == timestamp)) {\n                                    return;\n                                }\n                            }\n                            let id = $row.data('id');\n                            let int = interactions.find(x => x.id == id);\n                            int.title = name;\n                            int.timestamp = timestamp;\n                            let xp = Number($row.find('.xp').val());\n                            if (isNaN(xp) || xp == '') {\n                                xp = 0;\n                            }\n                            int.xp = xp;\n                            selectedInt.push(int);\n                        });\n                        if (selectedInt.length == 0) {\n                            addNotification(M.util.get_string('selectinteraction', 'mod_interactivevideo'), 'danger');\n                            return;\n                        } else {\n                            let interactions = await $.ajax({\n                                url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                                method: \"POST\",\n                                dataType: \"text\",\n                                data: {\n                                    action: 'import_annotations',\n                                    sesskey: M.cfg.sesskey,\n                                    contextid: M.cfg.contextid,\n                                    annotations: JSON.stringify(selectedInt),\n                                    tocourse: M.cfg.courseId,\n                                    fromcourse: $('#importcourse').val(),\n                                    tocm: interaction,\n                                    fromcm: $('#importcm').val(),\n                                    module: coursemodule\n                                }\n                            });\n                            interactions = JSON.parse(interactions);\n\n                            // Dismiss modal.\n                            importmodal.hide();\n\n                            // Add the imported annotations to the current annotations.\n                            annotations = annotations.concat(interactions);\n                            dispatchEvent('annotationupdated', {\n                                annotations: annotations,\n                                action: 'import'\n                            });\n\n                            // Get interaction that allowmultiple false and init each one.\n                            interactions.forEach(int => {\n                                if (!int.allowmultiple) {\n                                    ctRenderer[int.type].init();\n                                }\n                            });\n                        }\n                    });\n            });\n        });\n\n        // Implement content type filter.\n        $(document).on('keyup', '#contentmodal #contentsearch', function() {\n            let search = $(this).val().toLowerCase();\n\n            $('#addcontentdropdown .dropdown-item').removeClass('d-none').addClass('d-flex');\n\n            if (search == '') {\n                return;\n            }\n\n            $('#contentmodal #addcontentdropdown .dropdown-item').each(function() {\n                let text = $(this).find('.contenttype-title').text().toLowerCase();\n                if (text.includes(search)) {\n                    $(this).addClass('d-flex').removeClass('d-none');\n                } else {\n                    $(this).addClass('d-none').removeClass('d-flex');\n                }\n            });\n        });\n\n        // Implement fast forward and rewind.\n        const fastforward = async(e) => {\n            let time = await player.getCurrentTime();\n            if (time >= end) {\n                return;\n            }\n            if (e.ctrlKey || e.metaKey) {\n                time += 1;\n            } else {\n                time += 0.2;\n            }\n            if (time > end) {\n                time = end;\n            }\n            await player.seek(time);\n        };\n        $(document).on('click', '#fast-forward', async function(e) {\n            e.preventDefault();\n            fastforward(e);\n        });\n\n        let fastForwardInterval;\n        $(document).on('mousedown', '#fast-forward', async function(e) {\n            e.preventDefault();\n            fastForwardInterval = setInterval(async() => {\n                fastforward(e);\n                if (await player.getCurrentTime() >= end) {\n                    clearInterval(fastForwardInterval);\n                }\n            }, 200);\n        });\n\n        $(document).on('mouseup mouseleave', '#fast-forward', function() {\n            clearInterval(fastForwardInterval);\n        });\n\n        const rewind = async(e) => {\n            let time = await player.getCurrentTime();\n            if (time <= start) {\n                return;\n            }\n            if (e.ctrlKey || e.metaKey) {\n                time -= 1;\n            } else {\n                time -= 0.2;\n            }\n            if (time < start) {\n                time = start;\n            }\n            await player.seek(time);\n        };\n        $(document).on('click', '#rewind', async function(e) {\n            e.preventDefault();\n            rewind(e);\n        });\n\n        let rewindInterval;\n        $(document).on('mousedown', '#rewind', async function(e) {\n            e.preventDefault();\n            rewindInterval = setInterval(async() => {\n                rewind(e);\n                if (await player.getCurrentTime() <= start) {\n                    clearInterval(rewindInterval);\n                }\n            }, 200);\n        });\n\n        $(document).on('mouseup mouseleave', '#rewind', function() {\n            clearInterval(rewindInterval);\n        });\n\n        // Remove all event listeners before leaving the page.\n        window.addEventListener('beforeunload', function() {\n            $(document).off();\n            cancelAnimationFrame(onPlayingInterval);\n        });\n\n        // Event lister for bulk action.\n        $(document).on('click', '#annotation-list-bulk-edit', async function(e) {\n            e.preventDefault();\n            document.body.focus();\n            if ($(this).hasClass('active')) {\n                // Remove all checkboxes.\n                $('#annotation-list').find('.form-check').remove();\n                $(this).removeClass('active');\n                $('#annotation-list').find('tr').each(function() {\n                    $(this).removeClass('b-active');\n                });\n                $('body').removeClass('iv-bulk-edit');\n                $('#annotation-list-bulk-checkall').addClass('d-none');\n                return;\n            }\n            $(this).addClass('active');\n            $('#annotation-list-bulk-checkall').removeClass('d-none active');\n            $('body').addClass('iv-bulk-edit');\n            let li = $('#annotation-list').find('tr');\n            li.each(function() {\n                let id = $(this).data('id');\n                let type = $(this).data('type');\n                // Find first td.\n                let td = $(this).find('td').first().find('div');\n                td.prepend(`<div class=\"form-check form-check-inline iv-mr-0\">\n                        <input class=\"form-check-input\" type=\"checkbox\" data-type=\"${type}\" id=\"annotation-${id}\" value=\"${id}\">\n                        <label class=\"form-check-label\" for=\"annotation-${id}\"></label></div>`);\n            });\n        });\n\n        // Event lister for bulk check all.\n        $(document).on('click', '#annotation-list-bulk-checkall', function(e) {\n            e.preventDefault();\n            let check = !$(this).hasClass('active');\n\n            // Uncheck all checkboxes.\n            $('tr.annotation .form-check-input').each(function() {\n                if ((!$(this).is(':checked') && check) || ($(this).is(':checked') && !check)) {\n                    $(this).trigger('click');\n                }\n            });\n\n            $(this).toggleClass('active');\n\n        });\n\n        $(document).on('click', 'tr.annotation .form-check-input', function(e) {\n            e.stopImmediatePropagation();\n            if ($(this).is(':checked')) {\n                $(this).closest('tr').addClass('b-active');\n            } else {\n                $(this).closest('tr').removeClass('b-active');\n            }\n\n            let checked = $('#annotation-list').find('tr .form-check-input:checked');\n\n            if (checked.length == 0) {\n                $('#annotation-list-bulk .bulk-actions').hide();\n            } else {\n                $('#annotation-list-bulk .bulk-actions').show();\n            }\n        });\n\n        $(document).on('click', '#annotation-list-bulk-delete', async function(e) {\n            e.preventDefault();\n            let ids = [];\n            let types = [];\n            let checked = $('#annotation-list').find('tr .form-check-input:checked');\n            checked.each(function() {\n                ids.push($(this).val());\n                types.push($(this).data('type'));\n            });\n            if (ids.length == 0) {\n                return;\n            }\n            const promises = ids.map((id, index) => {\n                return new Promise((resolve) => {\n                    let type = types[index];\n                    ctRenderer[type].deleteAnnotation(annotations, id, true);\n                    resolve();\n                });\n            });\n\n            await Promise.all(promises);\n            dispatchEvent('annotationsdeleted', {\n                annotations: this.annotations,\n                ids: ids,\n            });\n        });\n\n        $(document).on('click', '#annotation-list-bulk-copy', async function(e) {\n            e.preventDefault();\n            let copiedIds = $('#annotation-list').find('tr .form-check-input:checked')\n                .map(function() {\n                    return $(this).val();\n                }).get();\n            if (copiedIds.length == 0) {\n                return;\n            }\n            let copiedAnnotations = annotations.filter(x => copiedIds.includes(x.id));\n            copiedAnnotations = copiedAnnotations.map(function(item) {\n                item.wwwroot = M.cfg.wwwroot;\n                return item;\n            });\n            copiedAnnotations = JSON.stringify(copiedAnnotations);\n            // Copy to storage.\n            window.localStorage.setItem('copiedAnnotations', copiedAnnotations);\n            $('#annotation-list-bulk-paste').removeAttr('disabled');\n            $('#annotation-list-bulk-paste').addClass('btn-primary');\n            $('#annotation-list-bulk-paste').find('i').removeClass('bi-clipboard').addClass('bi-clipboard-fill');\n            addNotification(M.util.get_string('annotationscopied', 'mod_interactivevideo'), 'success');\n        });\n\n        $(document).on('click', '#annotation-list-bulk-download', async function(e) {\n            e.preventDefault();\n            $(this).attr('disabled', 'disabled');\n            $(this).find('i').addClass('fa-spin fa-circle-o-notch fa').removeClass('bi bi-download');\n            let downloadIds = $('#annotation-list').find('tr .form-check-input:checked')\n                .map(function() {\n                    return $(this).val();\n                }).get();\n\n            if (downloadIds.length == 0) {\n                return;\n            }\n\n            let copiedAnnotations = annotations.filter(x => downloadIds.includes(x.id));\n            copiedAnnotations = copiedAnnotations.map(function(item) {\n                item.wwwroot = M.cfg.wwwroot;\n                return item;\n            });\n\n            const downloadTask = await $.ajax({\n                url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                method: \"POST\",\n                dataType: \"text\",\n                data: {\n                    action: 'download_annotations',\n                    sesskey: M.cfg.sesskey,\n                    contextid: M.cfg.contextid,\n                    courseid: course,\n                    annotations: JSON.stringify(copiedAnnotations).replace(/</g, '&lt;').replace(/>/g, '&gt;'),\n                    cmid: coursemodule\n                }\n            });\n\n            window.open(downloadTask, '_blank');\n\n            $(this).removeAttr('disabled');\n            $(this).find('i').removeClass('fa-spin fa-circle-o-notch fa').addClass('bi bi-download');\n        });\n\n        // Bulk set as defaults.\n        $(document).on('click', '#annotation-list-bulk-setdefault', async function(e) {\n            e.preventDefault();\n            let selectedIds = $('#annotation-list').find('tr .form-check-input:checked')\n                .map(function() {\n                    return $(this).val();\n                }).get();\n            if (selectedIds.length == 0) {\n                return;\n            }\n            let selectedAnnotations = annotations.filter(x => selectedIds.includes(x.id));\n            // Make sure the annotations are unique based on type.\n            selectedAnnotations = selectedAnnotations.filter((item, index, self) =>\n                index === self.findIndex((t) => (\n                    t.type === item.type\n                ))\n            );\n\n            await $.ajax({\n                url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                method: \"POST\",\n                dataType: \"text\",\n                data: {\n                    action: 'set_defaults',\n                    sesskey: M.cfg.sesskey,\n                    contextid: M.cfg.contextid,\n                    courseid: course,\n                    defaults: JSON.stringify(selectedAnnotations),\n                }\n            });\n            // Trigger the -edit button to reset the view.\n            $('#annotation-list-bulk-edit').trigger('click');\n            addNotification(M.util.get_string('annotationssavedasdefaults', 'mod_interactivevideo'), 'success');\n        });\n\n        // Bulk upload.\n        let ModalForm;\n        $(document).on('click', '#annotation-list-bulk-upload', async function(e) {\n            e.preventDefault();\n            if (!ModalForm) {\n                ModalForm = await import('core_form/modalform');\n            }\n\n            const data = {\n                contextid: M.cfg.contextid,\n                id: coursemodule,\n                courseid: course,\n                annotationid: interaction,\n                prevent: annotations.filter(x => JSON.parse(x.prop).allowmultiple == false).map(x => x.type).join(','),\n            };\n\n            let title = M.util.get_string('uploadannotations', 'mod_interactivevideo');\n            const form = new ModalForm({\n                modalConfig: {\n                    title: title,\n                },\n                formClass: \"mod_interactivevideo\\\\form\\\\bulk_upload_form\",\n                args: data,\n            });\n\n            form.show();\n\n            form.addEventListener(form.events.FORM_SUBMITTED, async(e) => {\n                let imported = e.detail.new;\n                // Check if the imported annotations are valid.\n                imported = imported.filter(x => contentTypes.find(y => y.name === x.type));\n                annotations = annotations.concat(imported);\n                dispatchEvent('annotationupdated', {\n                    annotations: annotations,\n                    action: 'import'\n                });\n            });\n        });\n\n        window.addEventListener('storage', function(e) {\n            // Activate paste button on other tabs.\n            e.stopImmediatePropagation();\n            if (e.key === 'copiedAnnotations') {\n                // Activate paste button.\n                $('#annotation-list-bulk-paste').removeAttr('disabled');\n                $('#annotation-list-bulk-paste').addClass('btn-primary');\n                $('#annotation-list-bulk-paste').find('i').removeClass('bi-clipboard').addClass('bi-clipboard-fill');\n            }\n        });\n\n        // Activate paste button on page load if there are copied annotations.\n        let copiedAnnotations = window.localStorage.getItem('copiedAnnotations');\n        if (copiedAnnotations !== null) {\n            // Don't activate if the same cm.\n            copiedAnnotations = JSON.parse(copiedAnnotations);\n            if (copiedAnnotations[0].cmid == coursemodule) {\n                return;\n            }\n            // Activate paste button.\n            $('#annotation-list-bulk-paste').removeAttr('disabled');\n            $('#annotation-list-bulk-paste').addClass('btn-primary');\n            $('#annotation-list-bulk-paste').find('i').removeClass('bi-clipboard').addClass('bi-clipboard-fill');\n        }\n\n        // Paste annotations.\n        $(document).on('click', '#annotation-list-bulk-paste', async function(e) {\n            e.preventDefault();\n            let copiedAnnotations = window.localStorage.getItem('copiedAnnotations');\n            if (copiedAnnotations === null) {\n                return;\n            }\n            copiedAnnotations = JSON.parse(copiedAnnotations);\n            // Make sure we don't copy the interaction with allowmultiple false;\n            copiedAnnotations = copiedAnnotations.filter(x => {\n                let allowmultiple = JSON.parse(x.prop).allowmultiple;\n                return allowmultiple || (!allowmultiple && !annotations.find(y => y.type == x.type));\n            });\n            if (copiedAnnotations.length == 0) {\n                addNotification(M.util.get_string('annotationscopied', 'mod_interactivevideo'), 'danger');\n                return;\n            }\n            const fromCourse = copiedAnnotations[0].courseid;\n            const fromCm = copiedAnnotations[0].cmid;\n            const toCourse = course;\n            // If it is from the same cm, we need to change the title.\n            if (fromCm == coursemodule) {\n                copiedAnnotations = copiedAnnotations.filter(a => a.type != 'skipsegment').map(function(item) {\n                    if (item.timestamp >= 0) {\n                        item.timestamp = Number(item.timestamp) + 0.1;\n                        item.title = item.title + ' (' + M.util.get_string('copynoun', 'mod_interactivevideo') + ')';\n                    }\n                    return item;\n                });\n            }\n\n            let interactions = await $.ajax({\n                url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                method: \"POST\",\n                dataType: \"text\",\n                data: {\n                    action: 'import_annotations',\n                    sesskey: M.cfg.sesskey,\n                    contextid: M.cfg.contextid,\n                    annotations: JSON.stringify(copiedAnnotations),\n                    tocourse: toCourse,\n                    fromcourse: fromCourse,\n                    tocm: interaction,\n                    fromcm: fromCm,\n                    module: coursemodule\n                }\n            });\n            interactions = JSON.parse(interactions);\n            // Add the imported annotations to the current annotations.\n            annotations = annotations.concat(interactions);\n            dispatchEvent('annotationupdated', {\n                annotations: annotations,\n                action: 'import'\n            });\n\n            // Get interaction that allowmultiple false and init each one.\n            interactions.forEach(int => {\n                if (!int.allowmultiple) {\n                    ctRenderer[int.type].init();\n                }\n            });\n\n        });\n\n        // Bulk deleted\n        $(document).on('annotationsdeleted', function(e) {\n            const ids = e.originalEvent.detail.ids;\n            ids.forEach(function(id) {\n                $(`tr[data-id=\"${id}\"]`).addClass('deleted');\n            });\n            $('#annotation-list-bulk-edit').trigger('click');\n            setTimeout(function() {\n                annotations = annotations.filter(function(item) {\n                    return !ids.includes(item.id);\n                });\n                renderAnnotationItems(annotations);\n                addNotification(M.util.get_string('interactionsdeleted', 'mod_interactivevideo', ids.length), 'success');\n            }, 1000);\n        });\n\n        // Implement keyboard shortcuts.\n        document.addEventListener('keydown', async function(e) {\n            // Ignore spacebar when focus is on an input, textarea, or button\n            const activeTag = document.activeElement.tagName.toLowerCase();\n            if (activeTag !== 'body') {\n                return;\n            }\n\n            if ($('body').hasClass('disablekb')) {\n                return;\n            }\n\n            if (e.code === 'Space') {\n                e.preventDefault(); // Prevent page scroll.\n                if (await player.isPaused()) {\n                    player.play();\n                } else {\n                    player.pause();\n                }\n            } else if (e.code === 'KeyA' && !e.ctrlKey && !e.metaKey) {\n                e.preventDefault();\n                // Launch add content modal.\n                $addcontent.trigger('click');\n            } else if (e.code === 'ArrowRight') {\n                e.preventDefault();\n                // Fast forward.\n                let time = await player.getCurrentTime();\n                if (time >= end || time + 1 > end) {\n                    return;\n                }\n                player.seek(time + 1);\n            } else if (e.code === 'ArrowLeft') {\n                e.preventDefault();\n                // Rewind 10 seconds.\n                let time = await player.getCurrentTime();\n                if (time <= start || time - 1 < start) {\n                    return;\n                }\n                player.seek(time - 1);\n            } else if (e.code === 'KeyI') {\n                e.preventDefault();\n                // Launch import content modal.\n                $('#importcontent').trigger('click');\n            } else if (e.code === 'KeyX') {\n                e.preventDefault();\n                // Launch delete content modal.\n                $('#annotation-list-bulk-delete').trigger('click');\n            } else if (e.code === 'KeyD') {\n                e.preventDefault();\n                // Launch download content modal.\n                $('#annotation-list-bulk-download').trigger('click');\n            } else if (e.code === 'KeyC') {\n                e.preventDefault();\n                // Launch copy content modal.\n                $('#annotation-list-bulk-copy').trigger('click');\n            } else if (e.code === 'KeyP') {\n                e.preventDefault();\n                // Launch paste content modal.\n                $('#annotation-list-bulk-paste').trigger('click');\n            } else if (e.code === 'KeyE') {\n                e.preventDefault();\n                // Launch edit content modal.\n                $('#annotation-list-bulk-edit').trigger('click');\n            } else if (e.code === 'KeyA' && (e.ctrlKey || e.metaKey) && $('#annotation-list-bulk-edit').hasClass('active')) {\n                e.preventDefault();\n                // Launch add content modal.\n                $('#annotation-list-bulk-checkall').trigger('click');\n            } else if (e.code === 'KeyU') {\n                e.preventDefault();\n                // Launch upload content modal.\n                $('#annotation-list-bulk-upload').trigger('click');\n            } else if (e.code === 'Equal') {\n                e.preventDefault();\n                // Launch download content modal.\n                $('#zoomin').trigger('click');\n            } else if (e.code === 'Minus') {\n                e.preventDefault();\n                // Launch download content modal.\n                $('#zoomout').trigger('click');\n            } else if (e.code === 'KeyS' && (e.ctrlKey || e.metaKey)) {\n                e.preventDefault();\n                // Save content.\n                $('#savedraft').trigger('click');\n            }\n        });\n    }\n};\n"],"names":["ModalFactory","player","totaltime","currentTime","ctRenderer","playerReady","isRTL","attr","isBS5","hasClass","bsAffix","$loader","$progressbar","$scrollbar","$scrollhead","$videonav","replaceProgressBars","percentage","css","renderVideoNav","async","annos","start","length","find","empty","remove","forEach","render","x","type","renderItemOnVideoNavigation","time","getCurrentTime","init","url","coursemodule","interaction","course","end","coursecontextid","displayoptions","userid","posterimage","extendedcompletion","error","JSON","parse","text","$videotimeline","$annotationlist","$annotationcanvas","$timelinewrapper","$videowrapper","$playpause","$timelineitemswrapper","$addcontent","require","addNotification","msg","Number","isNaN","contentTypes","annotations","convertSecondsToHMS","s","dynamic","rounded","Math","round","hours","floor","minutes","seconds","parseFloat","toFixed","activeid","renderAnnotationItems","removeClass","live","addClass","html","M","util","get_string","sort","a","b","timestamp","String","localeCompare","item","listItem","clone","renderEditItem","xp","filter","map","reduce","activeAnno","id","postEditCallback","getAnnotations","getItems","$","ajax","cfg","wwwroot","method","dataType","data","action","sesskey","contextid","courseContextId","getContentTypes","when","done","items","contenttypes","y","name","getRenderers","Promise","resolve","count","amdmodule","Type","isEditMode","prop","author","authorlink","description","stringify","editMode","validateTimestampFormat","fld","existing","test","val","validateTimeStartEnd","checkduration","checkexisting","checkskipsegment","parts","split","message","skip","annotation","title","runInteraction","modal","not","pause","updateTime","duration","toUpdatetime","cmid","courseid","onReady","MAX_SAFE_INTEGER","isPaused","seek","unMute","audio","passwordprotected","support","playbackrate","quality","t","ratio","usefixedratio","aspectratio","relWidth","width","startPercentage","newStart","append","i","marker","setCaption","e","onEnded","toggleClass","focus","currentAnnotation","tooltip","setTimeout","onSeek","onPlayingInterval","visualized","onPlaying","intervalFunction","thisTime","isPlaying","isEnded","cancelAnimationFrame","stop","scrollBar","document","getElementById","rect","getBoundingClientRect","left","right","window","innerWidth","scrollIntoView","behavior","block","inline","frequency","trigger","useAnimationFrame","animate","requestAnimationFrame","onplay","visualizer","onPause","VideoPlayer","load","IVPLAYER","one","on","detail","is","originalEvent","updated","push","status","removeAttr","target","ctype","this","contenttype","hastimestamp","allowmultiple","addAnnotation","preventDefault","closest","editAnnotation","cloneAnnotation","deleteCancelPromise","then","deleteAnnotation","catch","saveCancel","theAnnotation","play","stopImmediatePropagation","offsetX","hide","siblings","initialValue","key","show","field","value","success","$vseekbar","appendTimestampMarker","formattedTime","targetAnnotation","draggable","resizable","event","ui","position","skipduration","abs","originalPosition","originalSize","size","direction","off","height","localStorage","setItem","drag","offset","playerWidth","getItem","timelineHeight","contentTypeModal","parentOffset","relX","pageX","fadeIn","fadeOut","currentLevel","newLevel","parseInt","timelineElement","scrollWidth","clientWidth","ctrlKey","metaKey","deltaY","addEventListener","scrollLeft","style","scrollHeight","draftAnnotations","create","body","backdrop","removeOnHide","root","getRoot","$body","ModalEvents","hidden","shown","handle","confirmationMessage","returnValue","rate","setRate","getQualities","currentQuality","qualities","qualitiesLabel","q","dropdown","setQuality","resizeTimeout","timelineWrapper","resizeObserver","ResizeObserver","clearTimeout","observe","importmodal","footer","large","removeOnClose","isVerticallyCentered","courses","fullname","courseSelect","shortname","selectfield","destroy","cms","cmSelect","cm","after","interactions","int","icon","outside","disabled","inputs","inputgroup","hascompletion","$selected","selectedInt","each","$row","trim","tocourse","courseId","fromcourse","tocm","fromcm","module","concat","search","toLowerCase","includes","fastforward","fastForwardInterval","setInterval","clearInterval","rewind","rewindInterval","ModalForm","first","prepend","check","ids","types","promises","index","all","copiedIds","get","copiedAnnotations","downloadIds","downloadTask","replace","open","selectedIds","selectedAnnotations","self","findIndex","defaults","annotationid","prevent","join","form","modalConfig","formClass","args","events","FORM_SUBMITTED","imported","new","fromCourse","fromCm","toCourse","activeElement","tagName","code"],"mappings":"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"}