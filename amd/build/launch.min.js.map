{"version":3,"file":"launch.min.js","sources":["../src/launch.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Launch the interactive video in modal on course page\n *\n * @module     mod_interactivevideo/launch\n * @copyright  2024 Sokunthearith Makara <sokunthearithmakara@gmail.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport $ from 'jquery';\nimport {getString} from 'core/str';\nimport Templates from 'core/templates';\nimport ModalEvents from 'core/modal_events';\nimport {dispatchEvent} from 'core/event_dispatcher';\n\nlet playerModal;\nlet ModalFactory;\nexport default {\n    init: async function() {\n        if (!ModalFactory) {\n            try {\n                ModalFactory = await import('core/modal_factory');\n            } catch (error) {\n                ModalFactory = await import('core/modal');\n            }\n        }\n        const launchVideo = async($card, course, contextid, id) => {\n            // Save the current document title.\n            let title = document.title;\n            // Get current url.\n            let currentUrl = window.location.href;\n            // Get showcontrols from cache.\n            let showcontrols = localStorage.getItem('showcontrols') ? true : false;\n\n            // Get fullscreen from cache.\n            let resized = localStorage.getItem('resized') ? true : false;\n            let fullscreen = resized ? false : true;\n\n            if (playerModal) {\n                playerModal.destroy();\n            }\n\n            playerModal = await ModalFactory.create({\n                body: await Templates.render('mod_interactivevideo/playermodal', {\n                    id,\n                    wwwroot: M.cfg.wwwroot,\n                    title: title,\n                    fullscreen,\n                }),\n                large: true,\n                show: false,\n                removeOnClose: false,\n                isVerticallyCentered: true,\n            });\n\n            const root = playerModal.getRoot();\n            let rootheader = root.find('#head').html();\n            let rootbody = root.find('#body').html();\n            root.find('.modal-header').addClass(`border-0 text-white align-items-center py-0 h-0 position-absolute w-100\n                         z-index-1 iv-rounded-0`)\n                .empty()\n                .append(rootheader);\n\n            root.find('.modal-body').addClass('p-0').html(rootbody);\n            root.find('#background-loading').show();\n            root.addClass(fullscreen ? 'modal-fullscreen iv-rounded-0' : 'modal-resized');\n            root.attr('id', 'playermodal');\n            root.find('.modal-dialog').addClass('modal-xl ' + (fullscreen ? 'iv-rounded-0' : ''))\n                .removeClass('modal-lg');\n            root.find('.modal-content').addClass('border-0 show-control '\n                + (fullscreen ? 'iv-rounded-0' : ''));\n\n            playerModal.show();\n            root.find('.toggle-controls').trigger('click');\n\n            let $header = root.find('.modal-header');\n            let $content = root.find('.modal-content');\n            let $toggle = root.find('.toggle-controls');\n            if (showcontrols && !$content.hasClass('show-control')) {\n                $toggle.trigger('click');\n            }\n\n            const headerFunction = function() {\n                if ($header.hasClass('show')) {\n                    return;\n                }\n\n                $header.addClass('show');\n                $header.fadeIn();\n                if (!root.hasClass('locked')) {\n                    setTimeout(function() {\n                        $header.removeClass('show');\n                        $header.fadeOut();\n                    }, 5000);\n                }\n            };\n\n            let iframeDoc, iframeAnnos, details, player, iframeWindow;\n            root.off(ModalEvents.shown);\n            root.on(ModalEvents.shown, function() {\n                $('body').addClass('overflow-hidden');\n                $header.addClass('show');\n                if (localStorage.getItem('lock-bar')) {\n                    $(this).find('.lock-bar').trigger('click');\n                }\n                // Copy the activity information to the modal header.\n                if ($card) {\n                    let $completion = $card.find('[data-region=activity-information]');\n                    $completion = $completion.clone();\n                    $(this).find('[data-region=\"activity-completion\"]').html($completion);\n                }\n                // Listen the player timeupdate event in the iframe.\n                let checkIframeDoc = function() {\n                    try {\n                        iframeDoc = document.getElementById('ivplayer').contentDocument;\n                    } catch (e) {\n                        cancelAnimationFrame(checkIframeDoc);\n                        return;\n                    }\n                    iframeWindow = document.getElementById('ivplayer').contentWindow;\n                    iframeAnnos = iframeWindow.IVANNO;\n                    if (!iframeDoc.getElementById('player')) {\n                        requestAnimationFrame(checkIframeDoc);\n                        return;\n                    }\n                    // Hide the background-loading.\n                    $('#background-loading').hide(0);\n                    if (!iframeAnnos) {\n                        requestAnimationFrame(checkIframeDoc);\n                        return;\n                    }\n\n                    player = iframeWindow.IVPLAYER;\n                    if (player.doptions.hidemainvideocontrols == 1) {\n                        showcontrols = true;\n                        $toggle.remove();\n                    }\n\n                    if (showcontrols) {\n                        iframeDoc.querySelector('body').classList.add('showcontrols');\n                    } else {\n                        iframeDoc.querySelector('body').classList.remove('showcontrols');\n                    }\n\n                    let nocontrols = false;\n                    if (!iframeDoc.getElementById('controller')) {\n                        $content.addClass('show-control');\n                        // Remove the toggle button.\n                        $toggle.remove();\n                        nocontrols = true;\n                    }\n\n                    if (iframeDoc.getElementById('player')) {\n                        // Focus on the iframe.\n                        iframeWindow.focus();\n                        $header.removeClass('show');\n                        $toggle.removeClass('d-none');\n\n                        if (!showcontrols && !nocontrols) {\n                            setTimeout(function() {\n                                $content.removeClass('show-control');\n                            }, 1000);\n                        }\n\n                        $toggle.on('click', function() {\n                            $content.toggleClass('show-control');\n                            showcontrols = $content.hasClass('show-control');\n                            if (showcontrols) {\n                                localStorage.setItem('showcontrols', '1');\n                                iframeDoc.querySelector('body').classList.add('showcontrols');\n                            } else {\n                                localStorage.removeItem('showcontrols');\n                                iframeDoc.querySelector('body').classList.remove('showcontrols');\n                            }\n                        });\n\n                        iframeDoc.addEventListener('annotationitemsrendered', function(e) {\n                            details = e.detail;\n                        });\n\n                        $(iframeDoc).on('mousemove', '#interactivevideo-container', function() {\n                            if (root.hasClass('locked')) {\n                                return;\n                            }\n                            let $message = iframeDoc.querySelector('#message:not(.sticky)');\n                            let $activestart = iframeDoc.querySelector('#start-screen:not(.d-none) .hasintro');\n                            if ($message || $activestart) {\n                                $header.removeClass('show');\n                            } else {\n                                headerFunction();\n                            }\n                        });\n\n                        iframeDoc.addEventListener('videoPaused', function() {\n                            if (root.hasClass('locked')) {\n                                return;\n                            }\n                            let $message = iframeDoc.querySelector('#message:not(.sticky)');\n                            let $activestart = iframeDoc.querySelector('#start-screen:not(.d-none) .hasintro');\n                            if ($message || $activestart) {\n                                $header.removeClass('show');\n                            } else {\n                                headerFunction();\n                            }\n                            $toggle.fadeOut(300);\n                        });\n\n                        iframeDoc.addEventListener('iv:playerPlay', function() {\n                            $toggle.fadeIn(300);\n                        });\n\n                        iframeDoc.addEventListener('iv:playerReload', function(e) {\n                            player = e.detail.player;\n                        });\n\n                        // Analytics progress bar.\n                        if ($card === null) {\n                            return;\n                        }\n                        let $progressbar = $card.find('.analytics.progress .progress-bar');\n                        if ($progressbar.length == 0) {\n                            return;\n                        }\n                        let current = $progressbar.data('current');\n                        iframeDoc.addEventListener('analyticsupdated', function(e) {\n                            let percentage = e.detail.percentage;\n                            if (percentage > current) {\n                                $progressbar.css('width', percentage + '%')\n                                    .data('current', percentage);\n                                $card.find('.analytics-percentage').text(Math.round(percentage));\n                            }\n                            if (!player) {\n                                // Remove modal.\n                                root.remove();\n                            }\n                        });\n                    } else {\n                        requestAnimationFrame(checkIframeDoc);\n                    }\n                };\n                requestAnimationFrame(checkIframeDoc);\n\n                $(this).off(ModalEvents.hidden).on(ModalEvents.hidden, function() {\n                    cancelAnimationFrame(checkIframeDoc);\n                });\n\n                root.off('click', '[data-action=\"toggle-manual-completion\"]')\n                    .on('click', '[data-action=\"toggle-manual-completion\"]', function() {\n                        $(this).parent().addClass('updated');\n                        if ($(this).data('withavailability') == 1) {\n                            history.pushState(null, null, M.cfg.wwwroot + '/course/view.php?id='\n                                + course + '#module-' + id);\n                        }\n                    });\n\n\n                // Update the browser url to the current activity.\n                history.pushState(null, null, M.cfg.wwwroot + '/mod/interactivevideo/view.php?id=' + id);\n                // Update the title of tab to the activity name.\n                if ($card) {\n                    let activitytitle = $card.data('title');\n                    document.title = activitytitle;\n                } else {\n                    document.title = $('li[data-id=\"' + id + '\"] .activityname').text();\n                }\n            });\n\n            $(document).off('interactivevideo:closemodal');\n            $(document).on('interactivevideo:closemodal', async function() {\n                $('body').removeClass('overflow-hidden');\n\n                // Trigger hover on .image-container for 2 seconds.\n                if ($card) {\n                    setTimeout(function() {\n                        $card.find('.image-container').removeClass('hovered');\n                    }, 1000);\n                }\n\n                if (player) { // Must check this in case user close modal before the player is ready.\n                    await player.pause();\n                } else {\n                    return;\n                }\n\n                if ($card) {\n                    // If there is automatic completion conditions, we have to update it.\n                    let $autocompletion = $card.find('.automatic-completion-conditions');\n                    if ($autocompletion.length > 0) {\n                        const completion = await $.ajax({\n                            url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                            method: 'POST',\n                            dataType: 'text',\n                            data: {\n                                action: 'get_cm_completion',\n                                cmid: id,\n                                sesskey: M.cfg.sesskey,\n                                contextid: contextid,\n                                courseid: course,\n                                userid: M.cfg.userId || 0,\n                            }\n                        });\n\n                        if (completion) {\n                            const completiondata = JSON.parse(completion);\n                            // Check if the iframe document has withavailability class. If so, refresh the page.\n                            if (iframeDoc.body.classList.contains('withavailability') && completiondata.overallcompletion) {\n                                // eslint-disable-next-line max-depth\n                                if (currentUrl.indexOf('#module-') > -1) {\n                                    currentUrl = currentUrl.replace(/#module-\\d+/, '#module-' + id);\n                                } else {\n                                    currentUrl = currentUrl + '#module-' + id;\n                                }\n                                window.location.href = currentUrl;\n                                return;\n                            }\n                            $card.find('[data-region=activity-information]')\n                                .html($(completiondata.completion).html());\n                        }\n                    }\n\n                    // If there is manual completion, we have to copy the button to the course page.\n                    let $manualcompletion = $(this).find('.completion-info.updated');\n                    if ($manualcompletion.length > 0) {\n                        $card.find('.completion-info').html($manualcompletion.html());\n                    }\n\n                    if (details) {\n                        let progressbar = $card.find('.tasks .progress-bar');\n                        if (progressbar.length > 0 && details.total > 0) {\n                            let percentage = Math.round(details.completed / details.total * 100);\n                            progressbar.css('width', percentage + '%');\n                            if (details.completed == details.total) {\n                                progressbar.addClass('bg-success').removeClass('bg-primary');\n                            } else {\n                                progressbar.removeClass('bg-success').addClass('bg-primary');\n                            }\n                            $card.find('.percentage')\n                                .text(percentage);\n                            $card.find('.items').text(`(${details.completed}/${details.total})`);\n                            $card.find('.xp').text(details.xp);\n                        }\n                    }\n                }\n\n                // Update the browser url to the current course.\n                history.pushState(null, null, currentUrl);\n                document.title = title;\n\n                if ($card) {\n                    if (iframeAnnos) {\n                        // Remove the new-bagde from the poster.\n                        $card.find('.new-badge').remove();\n                    }\n\n                    $card.closest('.modtype_interactivevideo')[0]\n                        .scrollIntoView({behavior: \"smooth\", block: \"center\", inline: \"center\"});\n                }\n\n                if (iframeDoc) {\n                    $(iframeDoc).off();\n                    iframeAnnos = null;\n                    details = null;\n                    player = null;\n\n                    if ($card.find('.analytics.progress .progress-bar').length == 0) {\n                        // Remove the iframe.\n                        playerModal.hide();\n                        iframeDoc = null;\n                    }\n                }\n            });\n\n            root.off(ModalEvents.hidden);\n            root.on(ModalEvents.hidden, function() {\n                if (playerModal) {\n                    playerModal.hide();\n                }\n            });\n\n            $(document).find('iframe#ivplayer').off('load').on('load', function() {\n                if ($(this).closest('.modal').hasClass('hide')) {\n                    playerModal.destroy();\n                }\n            });\n\n            // Close modal when the browser back button is clicked.\n            window.onpopstate = function(e) {\n                if (e.target.location.pathname == '/course/view.php') {\n                    if (player) {\n                        try {\n                            player.pause();\n                        } catch (error) {\n                            // Do nothing.\n                        }\n                    }\n                    playerModal.hide();\n                }\n            };\n\n            $(document)\n                .off('click', '[data-action=\"hidemodal\"]')\n                .on('click', '[data-action=\"hidemodal\"]', async function(e) {\n                    e.preventDefault();\n\n                    iframeWindow.postMessage({\n                        event: 'closemodal',\n                    }, '*');\n\n                    $(this).find('i').removeClass('fa-arrow-left fa-arrow-right').addClass('fa-circle-o-notch fa-spin');\n                    if (player) {\n                        try {\n                            await player.pause();\n                        } catch (e) {\n                            // Do nothing.\n                        }\n                    }\n                    setTimeout(() => {\n                        dispatchEvent('interactivevideo:closemodal');\n                        root.find('[data-action=\"hide\"]').trigger('click');\n                    }, player ? 1500 : 0);\n                });\n\n            root.find('[data-action=\"hide\"]').on('click', function() {\n                root.attr('data-region', 'modal-container');\n                $('.modal-backdrop.show').remove();\n            });\n\n            $(document).off('click', '.lock-bar').on('click', '.lock-bar', async function(e) {\n                e.preventDefault();\n                $(this).toggleClass('locked');\n                root.toggleClass('locked');\n                if ($(this).hasClass('locked')) {\n                    $(this).attr('title', await getString('unlock', 'mod_interactivevideo'));\n                    $(this).find('i').removeClass('fa-unlock').addClass('fa-lock');\n                    $header.addClass('show');\n                    // Save to local storage.\n                    localStorage.setItem('lock-bar', '1');\n                    headerFunction();\n                } else {\n                    $(this).attr('title', await getString('lock', 'mod_interactivevideo'));\n                    $(this).find('i').removeClass('fa-lock').addClass('fa-unlock');\n                    // Remove from local storage.\n                    localStorage.removeItem('lock-bar');\n                    setTimeout(function() {\n                        $header.removeClass('show');\n                    }, 5000);\n                }\n            });\n\n            root.off('click', '.resize').on('click', '.resize', function(e) {\n                e.preventDefault();\n                root.toggleClass('modal-fullscreen iv-rounded-0 modal-resized');\n                root.find('.modal-dialog, .modal-content').toggleClass('iv-rounded-0');\n                $(this).find('i').toggleClass('fa-expand fa-compress');\n                if (root.hasClass('modal-fullscreen')) {\n                    localStorage.removeItem('resized');\n                    let showcontrols = localStorage.getItem('showcontrols') ? true : false;\n                    if (showcontrols) {\n                        iframeDoc.querySelector('body').classList.add('showcontrols');\n                    } else {\n                        iframeDoc.querySelector('body').classList.remove('showcontrols');\n                    }\n                } else {\n                    localStorage.setItem('resized', '1');\n                    iframeDoc.querySelector('body').classList.add('showcontrols');\n                }\n            });\n        };\n\n        // Launch the interactive video in modal\n        $(document).on('click', '.launch-interactivevideo', async function(e) {\n            e.preventDefault();\n            const id = $(this).data('id');\n            const instance = $(this).data('instance');\n            const course = $(this).data('course');\n            const contextid = $(this).data('contextid');\n            const $card = $(this).closest('#interactivevideo-' + instance);\n            $card.find('.image-container').addClass('hovered');\n            launchVideo($card, course, contextid, id);\n        });\n\n        $(document).on('click', '.activityname a[href*=\"mod/interactivevideo/view.php\"]', async function(e) {\n            if ($(this).closest('li').hasClass('launchinpopup')) {\n                e.preventDefault();\n                const id = $(this).closest('li').data('id');\n                launchVideo(null, M.cfg.courseId, null, id);\n            }\n        });\n\n        $(document).on('click', '.open-external-link', function() {\n            playerModal.hide();\n            window.open($(this).data('href'), '_blank');\n        });\n\n        $(document).on('click', '.interactivevideo-card .description-toggle', function() {\n            const $description = $(this).closest('.top-section').find('.description');\n            $description.slideToggle('fast', 'swing');\n            $(this).find('.description-show').toggleClass('rotate');\n        });\n\n        // Get the #hash from the url and scroll to the element and hover it.\n        $(document).ready(function() {\n            let hash = window.location.hash;\n            if (hash) {\n                let $element = $(hash);\n                if ($element.length > 0 && $element.hasClass('modtype_interactivevideo')) {\n                    $element.addClass('highlighted');\n                    setTimeout(() => {\n                        $element[0].scrollIntoView({behavior: \"smooth\", block: \"center\", inline: \"center\"});\n                        setTimeout(function() {\n                            $element.removeClass('highlighted');\n                            // Remove the hash from the url.\n                            history.pushState(null, null, window.location.href.split('#module')[0]);\n                        }, 3000);\n                    }, 1000);\n                }\n            }\n        });\n\n        // Launch report modal.\n        $(document).on('click', '.launch-report', async function(e) {\n            e.preventDefault();\n            const href = $(this).data('href');\n\n            // If control or command key is pressed, open the modal. Otherwise, follow the link.\n            if (!e.ctrlKey && !e.metaKey) {\n                window.location.href = href;\n                return;\n            }\n\n            const reportModal = await ModalFactory.create({\n                body: await Templates.render('mod_interactivevideo/backgroundloading', {show: true}) +\n                    `<iframe src=\"${href}&embed=1\"\n                         class=\"w-100 position-absolute h-100 border-0\"\n                         allow=\"autoplay\"\n                         style=\"z-index:1050;\"></iframe>`,\n                title: await getString('reportfor', 'mod_interactivevideo', $(this).data('title')),\n                large: true,\n                show: false,\n                removeOnClose: true,\n                isVerticallyCentered: true,\n            });\n\n            const root = reportModal.getRoot();\n            root.attr('id', 'reportModal').addClass('modal-fullscreen iv-modal');\n            root.find('.modal-body').addClass('p-0');\n            reportModal.show();\n            root.off(ModalEvents.hidden);\n            root.on(ModalEvents.hidden, function() {\n                reportModal.destroy();\n            });\n        });\n\n        // Quick form for interactive video settings.\n        let ModalForm, addToast;\n        $(document).on('click', '.iv_quickform', async function(e) {\n            const $this = $(this);\n            e.preventDefault();\n            const href = $this.data('href');\n            if (!e.ctrlKey && !e.metaKey) {\n                window.location.href = href;\n                return;\n            }\n\n            let formdata = {\n                contextid: $(this).data('contextid'),\n                cmid: $(this).data('cmid'),\n                courseid: $(this).data('courseid'),\n                interaction: $(this).data('interaction'),\n                origin: 'coursepage',\n            };\n\n            if (!ModalForm) {\n                ModalForm = await import('core_form/modalform');\n            }\n\n            if (!addToast) {\n                addToast = await import('core/toast');\n            }\n\n            let form = new ModalForm({\n                formClass: 'mod_interactivevideo\\\\form\\\\quicksettings_form',\n                args: formdata,\n                modalConfig: {\n                    title: await getString('quicksettings', 'mod_interactivevideo'),\n                    removeOnClose: true,\n                }\n            });\n\n            form.show();\n\n            form.addEventListener(form.events.LOADED, async(e) => {\n\n                e.stopImmediatePropagation();\n                let root = form.modal.getRoot();\n                root.find('.modal-dialog').removeClass('modal-lg').addClass('modal-xl');\n                root.addClass('path-mod-interactivevideo');\n                let moresettings = await getString('moresettings', 'mod_interactivevideo');\n                let resettodefaults = await getString('resettodefaults', 'mod_interactivevideo');\n                let strings = [moresettings, resettodefaults];\n                root.find('[data-region=\"footer\"]').css('align-items', 'unset')\n                    .prepend(`<span class=\"btn btn-secondary iv-mr-1 default\" title=\"${strings[1]}\">\n                        <i class=\"fa fa-refresh\"></i></span>\n                        <a type=\"button\" class=\"btn btn-secondary iv-mr-auto\" target=\"_blank\" data-dismiss=\"modal\"\n                         data-bs-dismiss=\"modal\" title=\"${strings[0]}\"\n                            href=\"${M.cfg.wwwroot}/course/modedit.php?update=${formdata.cmid}\"><i class=\"fa fa-cog\"></i>\n                            </a>`);\n            });\n\n            form.addEventListener(form.events.FORM_SUBMITTED, (e) => {\n                e.stopImmediatePropagation();\n                addToast.add(getString('settingssaved', 'mod_interactivevideo'), {\n                    type: 'success',\n                });\n                // Replace the activity card with the new one.\n                let $newcard = $(e.detail.html);\n                $this.closest('.modtype_interactivevideo').replaceWith($newcard).trigger('click');\n            });\n\n            let DynamicForm;\n            $(document).off('click', '.modal-footer .btn.default').on('click', '.modal-footer .btn.default', async function(e) {\n                e.preventDefault();\n                formdata.action = 'reset';\n                if (!DynamicForm) {\n                    DynamicForm = await import('core_form/dynamicform');\n                }\n                let form = new DynamicForm(document.querySelector('[data-region=\"body\"]'),\n                    'mod_interactivevideo\\\\form\\\\quicksettings_form');\n                form.load(formdata);\n                addToast.add(getString('formvaluesarereset', 'mod_interactivevideo'), {\n                    type: 'info',\n                });\n            });\n        });\n    },\n};"],"names":["playerModal","ModalFactory","init","async","error","launchVideo","$card","course","contextid","id","title","document","currentUrl","window","location","href","showcontrols","localStorage","getItem","fullscreen","destroy","create","body","Templates","render","wwwroot","M","cfg","large","show","removeOnClose","isVerticallyCentered","root","getRoot","rootheader","find","html","rootbody","addClass","empty","append","attr","removeClass","trigger","$header","$content","$toggle","hasClass","headerFunction","fadeIn","setTimeout","fadeOut","iframeDoc","iframeAnnos","details","player","iframeWindow","off","ModalEvents","shown","on","this","$completion","clone","checkIframeDoc","getElementById","contentDocument","e","cancelAnimationFrame","contentWindow","IVANNO","requestAnimationFrame","hide","IVPLAYER","doptions","hidemainvideocontrols","remove","querySelector","classList","add","nocontrols","focus","toggleClass","setItem","removeItem","addEventListener","detail","$message","$activestart","$progressbar","length","current","data","percentage","css","text","Math","round","hidden","parent","history","pushState","activitytitle","pause","completion","$","ajax","url","method","dataType","action","cmid","sesskey","courseid","userid","userId","completiondata","JSON","parse","contains","overallcompletion","indexOf","replace","$manualcompletion","progressbar","total","completed","xp","closest","scrollIntoView","behavior","block","inline","onpopstate","target","pathname","preventDefault","postMessage","event","ModalForm","addToast","instance","courseId","open","slideToggle","ready","hash","$element","split","ctrlKey","metaKey","reportModal","$this","formdata","interaction","origin","DynamicForm","form","formClass","args","modalConfig","events","LOADED","stopImmediatePropagation","modal","strings","prepend","FORM_SUBMITTED","type","$newcard","replaceWith","load"],"mappings":"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"}