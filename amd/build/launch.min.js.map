{"version":3,"file":"launch.min.js","sources":["../src/launch.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Launch the interactive video in modal on course page\n *\n * @module     mod_interactivevideo/launch\n * @copyright  2024 Sokunthearith Makara <sokunthearithmakara@gmail.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/str', 'core/templates', 'core/modal_factory', 'core/modal_events', 'core/event_dispatcher'],\n    function($, str, Templates, ModalFactory, ModalEvents, eventDispatcher) {\n        let playerModal;\n        return {\n            init: async function() {\n                const launchVideo = async($card, course, contextid, id) => {\n                    // Save the current document title.\n                    let title = document.title;\n                    // Get current url.\n                    let currentUrl = window.location.href;\n                    // Get showcontrols from cache.\n                    let showcontrols = localStorage.getItem('showcontrols') ? true : false;\n\n                    // Get fullscreen from cache.\n                    let resized = localStorage.getItem('resized') ? true : false;\n                    let fullscreen = resized ? false : true;\n\n                    if (playerModal) {\n                        playerModal.destroy();\n                    }\n\n                    playerModal = await ModalFactory.create({\n                        body: await Templates.render('mod_interactivevideo/playermodal', {\n                            id,\n                            wwwroot: M.cfg.wwwroot,\n                            title: title,\n                            fullscreen,\n                        }),\n                        large: true,\n                        show: false,\n                        removeOnClose: false,\n                        isVerticallyCentered: true,\n                    });\n\n                    const root = playerModal.getRoot();\n                    let rootheader = root.find('#head').html();\n                    let rootbody = root.find('#body').html();\n                    root.find('.modal-header').addClass(`border-0 text-white align-items-center py-0 h-0 position-absolute w-100\n                         z-index-1 iv-rounded-0`)\n                        .empty()\n                        .append(rootheader);\n\n                    root.find('.modal-body').addClass('p-0').html(rootbody);\n                    root.find('#background-loading').show();\n                    root.addClass(fullscreen ? 'modal-fullscreen iv-rounded-0' : 'modal-resized');\n                    root.attr('id', 'playermodal');\n                    root.find('.modal-dialog').addClass('modal-xl ' + (fullscreen ? 'iv-rounded-0' : ''))\n                        .removeClass('modal-lg');\n                    root.find('.modal-content').addClass('border-0 show-control '\n                        + (fullscreen ? 'iv-rounded-0' : ''));\n\n                    playerModal.show();\n                    root.find('.toggle-controls').trigger('click');\n\n                    let $header = root.find('.modal-header');\n                    let $content = root.find('.modal-content');\n                    let $toggle = root.find('.toggle-controls');\n                    if (showcontrols && !$content.hasClass('show-control')) {\n                        $toggle.trigger('click');\n                    }\n\n                    const headerFunction = function() {\n                        if ($header.hasClass('show')) {\n                            return;\n                        }\n\n                        $header.addClass('show');\n                        $header.fadeIn();\n                        if (!root.hasClass('locked')) {\n                            setTimeout(function() {\n                                $header.removeClass('show');\n                                $header.fadeOut();\n                            }, 5000);\n                        }\n                    };\n\n                    let iframeDoc, iframeAnnos, details, player, iframeWindow;\n                    root.off(ModalEvents.shown);\n                    root.on(ModalEvents.shown, function() {\n                        $('body').addClass('overflow-hidden');\n                        $header.addClass('show');\n                        if (localStorage.getItem('lock-bar')) {\n                            $(this).find('.lock-bar').trigger('click');\n                        }\n                        // Copy the activity information to the modal header.\n                        if ($card) {\n                            let $completion = $card.find('[data-region=activity-information]');\n                            $completion = $completion.clone();\n                            $(this).find('[data-region=\"activity-completion\"]').html($completion);\n                        }\n                        // Listen the player timeupdate event in the iframe.\n                        let checkIframeDoc = function() {\n                            try {\n                                iframeDoc = document.getElementById('ivplayer').contentDocument;\n                            } catch (e) {\n                                cancelAnimationFrame(checkIframeDoc);\n                                return;\n                            }\n                            iframeWindow = document.getElementById('ivplayer').contentWindow;\n                            iframeAnnos = iframeWindow.IVANNO;\n                            if (!iframeDoc.getElementById('player')) {\n                                requestAnimationFrame(checkIframeDoc);\n                                return;\n                            }\n                            // Hide the background-loading.\n                            $('#background-loading').hide(0);\n                            if (!iframeAnnos) {\n                                requestAnimationFrame(checkIframeDoc);\n                                return;\n                            }\n\n                            player = iframeWindow.IVPLAYER;\n                            if (player.doptions.hidemainvideocontrols == 1) {\n                                showcontrols = true;\n                                $toggle.remove();\n                            }\n\n                            if (showcontrols) {\n                                iframeDoc.querySelector('body').classList.add('showcontrols');\n                            } else {\n                                iframeDoc.querySelector('body').classList.remove('showcontrols');\n                            }\n\n                            let nocontrols = false;\n                            if (!iframeDoc.getElementById('controller')) {\n                                $content.addClass('show-control');\n                                // Remove the toggle button.\n                                $toggle.remove();\n                                nocontrols = true;\n                            }\n\n                            if (iframeDoc.getElementById('player')) {\n                                // Focus on the iframe.\n                                iframeWindow.focus();\n                                $header.removeClass('show');\n                                $toggle.removeClass('d-none');\n\n                                if (!showcontrols && !nocontrols) {\n                                    setTimeout(function() {\n                                        $content.removeClass('show-control');\n                                    }, 1000);\n                                }\n\n                                $toggle.on('click', function() {\n                                    $content.toggleClass('show-control');\n                                    showcontrols = $content.hasClass('show-control');\n                                    if (showcontrols) {\n                                        localStorage.setItem('showcontrols', '1');\n                                        iframeDoc.querySelector('body').classList.add('showcontrols');\n                                    } else {\n                                        localStorage.removeItem('showcontrols');\n                                        iframeDoc.querySelector('body').classList.remove('showcontrols');\n                                    }\n                                });\n\n                                iframeDoc.addEventListener('annotationitemsrendered', function(e) {\n                                    details = e.detail;\n                                });\n\n                                $(iframeDoc).on('mousemove', '#interactivevideo-container', function() {\n                                    if (root.hasClass('locked')) {\n                                        return;\n                                    }\n                                    let $message = iframeDoc.querySelector('#message:not(.sticky)');\n                                    let $activestart = iframeDoc.querySelector('#start-screen:not(.d-none) .hasintro');\n                                    if ($message || $activestart) {\n                                        $header.removeClass('show');\n                                    } else {\n                                        headerFunction();\n                                    }\n                                });\n\n                                iframeDoc.addEventListener('videoPaused', function() {\n                                    if (root.hasClass('locked')) {\n                                        return;\n                                    }\n                                    let $message = iframeDoc.querySelector('#message:not(.sticky)');\n                                    let $activestart = iframeDoc.querySelector('#start-screen:not(.d-none) .hasintro');\n                                    if ($message || $activestart) {\n                                        $header.removeClass('show');\n                                    } else {\n                                        headerFunction();\n                                    }\n                                    $toggle.fadeOut(300);\n                                });\n\n                                iframeDoc.addEventListener('iv:playerPlay', function() {\n                                    $toggle.fadeIn(300);\n                                });\n\n                                iframeDoc.addEventListener('iv:playerReload', function(e) {\n                                    player = e.detail.player;\n                                });\n\n                                // Analytics progress bar.\n                                if ($card === null) {\n                                    return;\n                                }\n                                let $progressbar = $card.find('.analytics.progress .progress-bar');\n                                if ($progressbar.length == 0) {\n                                    return;\n                                }\n                                let current = $progressbar.data('current');\n                                iframeDoc.addEventListener('analyticsupdated', function(e) {\n                                    let percentage = e.detail.percentage;\n                                    if (percentage > current) {\n                                        $progressbar.css('width', percentage + '%')\n                                            .data('current', percentage);\n                                        $card.find('.analytics-percentage').text(Math.round(percentage));\n                                    }\n                                    if (!player) {\n                                        // Remove modal.\n                                        root.remove();\n                                    }\n                                });\n                            } else {\n                                requestAnimationFrame(checkIframeDoc);\n                            }\n                        };\n                        requestAnimationFrame(checkIframeDoc);\n\n                        $(this).off(ModalEvents.hidden).on(ModalEvents.hidden, function() {\n                            cancelAnimationFrame(checkIframeDoc);\n                        });\n\n                        root.off('click', '[data-action=\"toggle-manual-completion\"]')\n                            .on('click', '[data-action=\"toggle-manual-completion\"]', function() {\n                                $(this).parent().addClass('updated');\n                                if ($(this).data('withavailability') == 1) {\n                                    history.pushState(null, null, M.cfg.wwwroot + '/course/view.php?id='\n                                        + course + '#module-' + id);\n                                }\n                            });\n\n\n                        // Update the browser url to the current activity.\n                        history.pushState(null, null, M.cfg.wwwroot + '/mod/interactivevideo/view.php?id=' + id);\n                        // Update the title of tab to the activity name.\n                        if ($card) {\n                            let activitytitle = $card.data('title');\n                            document.title = activitytitle;\n                        } else {\n                            document.title = $('li[data-id=\"' + id + '\"] .activityname').text();\n                        }\n                    });\n\n                    $(document).off('interactivevideo:closemodal');\n                    $(document).on('interactivevideo:closemodal', async function() {\n                        $('body').removeClass('overflow-hidden');\n\n                        // Trigger hover on .image-container for 2 seconds.\n                        if ($card) {\n                            setTimeout(function() {\n                                $card.find('.image-container').removeClass('hovered');\n                            }, 1000);\n                        }\n\n                        if (player) { // Must check this in case user close modal before the player is ready.\n                            await player.pause();\n                        } else {\n                            return;\n                        }\n\n                        if ($card) {\n                            // If there is automatic completion conditions, we have to update it.\n                            let $autocompletion = $card.find('.automatic-completion-conditions');\n                            if ($autocompletion.length > 0) {\n                                const completion = await $.ajax({\n                                    url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                                    method: 'POST',\n                                    dataType: 'text',\n                                    data: {\n                                        action: 'get_cm_completion',\n                                        cmid: id,\n                                        sesskey: M.cfg.sesskey,\n                                        contextid: contextid,\n                                        courseid: course,\n                                        userid: M.cfg.userId || 0,\n                                    }\n                                });\n\n                                if (completion) {\n                                    const completiondata = JSON.parse(completion);\n                                    // Check if the iframe document has withavailability class. If so, refresh the page.\n                                    if (iframeDoc.body.classList.contains('withavailability') && completiondata.overallcompletion) {\n                                        // eslint-disable-next-line max-depth\n                                        if (currentUrl.indexOf('#module-') > -1) {\n                                            currentUrl = currentUrl.replace(/#module-\\d+/, '#module-' + id);\n                                        } else {\n                                            currentUrl = currentUrl + '#module-' + id;\n                                        }\n                                        window.location.href = currentUrl;\n                                        return;\n                                    }\n                                    $card.find('[data-region=activity-information]')\n                                        .html($(completiondata.completion).html());\n                                }\n                            }\n\n                            // If there is manual completion, we have to copy the button to the course page.\n                            let $manualcompletion = $(this).find('.completion-info.updated');\n                            if ($manualcompletion.length > 0) {\n                                $card.find('.completion-info').html($manualcompletion.html());\n                            }\n\n                            if (details) {\n                                let progressbar = $card.find('.tasks .progress-bar');\n                                if (progressbar.length > 0 && details.total > 0) {\n                                    let percentage = Math.round(details.completed / details.total * 100);\n                                    progressbar.css('width', percentage + '%');\n                                    if (details.completed == details.total) {\n                                        progressbar.addClass('bg-success').removeClass('bg-primary');\n                                    } else {\n                                        progressbar.removeClass('bg-success').addClass('bg-primary');\n                                    }\n                                    $card.find('.percentage')\n                                        .text(percentage);\n                                    $card.find('.items').text(`(${details.completed}/${details.total})`);\n                                    $card.find('.xp').text(details.xp);\n                                }\n                            }\n                        }\n\n                        // Update the browser url to the current course.\n                        history.pushState(null, null, currentUrl);\n                        document.title = title;\n\n                        if ($card) {\n                            if (iframeAnnos) {\n                                // Remove the new-bagde from the poster.\n                                $card.find('.new-badge').remove();\n                            }\n\n                            $card.closest('.modtype_interactivevideo')[0]\n                                .scrollIntoView({behavior: \"smooth\", block: \"center\", inline: \"center\"});\n                        }\n\n                        if (iframeDoc) {\n                            $(iframeDoc).off();\n                            iframeAnnos = null;\n                            details = null;\n                            player = null;\n\n                            if ($card.find('.analytics.progress .progress-bar').length == 0) {\n                                // Remove the iframe.\n                                playerModal.hide();\n                                iframeDoc = null;\n                            }\n                        }\n                    });\n\n                    root.off(ModalEvents.hidden);\n                    root.on(ModalEvents.hidden, function() {\n                        if (playerModal) {\n                            playerModal.hide();\n                        }\n                    });\n\n                    $(document).find('iframe#ivplayer').off('load').on('load', function() {\n                        if ($(this).closest('.modal').hasClass('hide')) {\n                            playerModal.destroy();\n                        }\n                    });\n\n                    // Close modal when the browser back button is clicked.\n                    window.onpopstate = function(e) {\n                        if (e.target.location.pathname == '/course/view.php') {\n                            if (player) {\n                                try {\n                                    player.pause();\n                                } catch (error) {\n                                    // Do nothing.\n                                }\n                            }\n                            playerModal.hide();\n                        }\n                    };\n\n                    $(document)\n                        .off('click', '[data-action=\"hidemodal\"]')\n                        .on('click', '[data-action=\"hidemodal\"]', async function(e) {\n                            e.preventDefault();\n\n                            iframeWindow.postMessage({\n                                event: 'closemodal',\n                            }, '*');\n\n                            $(this).find('i').removeClass('fa-arrow-left fa-arrow-right').addClass('fa-circle-o-notch fa-spin');\n                            if (player) {\n                                try {\n                                   await player.pause();\n                                } catch (e) {\n                                    // Do nothing.\n                                }\n                            }\n                            setTimeout(() => {\n                                eventDispatcher.dispatchEvent('interactivevideo:closemodal');\n                                root.find('[data-action=\"hide\"]').trigger('click');\n                            }, player ? 1500 : 0);\n                        });\n\n                    root.find('[data-action=\"hide\"]').on('click', function() {\n                        root.attr('data-region', 'modal-container');\n                        $('.modal-backdrop.show').remove();\n                    });\n\n                    $(document).off('click', '.lock-bar').on('click', '.lock-bar', async function(e) {\n                        e.preventDefault();\n                        $(this).toggleClass('locked');\n                        root.toggleClass('locked');\n                        if ($(this).hasClass('locked')) {\n                            $(this).attr('title', await str.get_string('unlock', 'mod_interactivevideo'));\n                            $(this).find('i').removeClass('fa-unlock').addClass('fa-lock');\n                            $header.addClass('show');\n                            // Save to local storage.\n                            localStorage.setItem('lock-bar', '1');\n                            headerFunction();\n                        } else {\n                            $(this).attr('title', await str.get_string('lock', 'mod_interactivevideo'));\n                            $(this).find('i').removeClass('fa-lock').addClass('fa-unlock');\n                            // Remove from local storage.\n                            localStorage.removeItem('lock-bar');\n                            setTimeout(function() {\n                                $header.removeClass('show');\n                            }, 5000);\n                        }\n                    });\n\n                    root.off('click', '.resize').on('click', '.resize', function(e) {\n                        e.preventDefault();\n                        root.toggleClass('modal-fullscreen iv-rounded-0 modal-resized');\n                        root.find('.modal-dialog, .modal-content').toggleClass('iv-rounded-0');\n                        $(this).find('i').toggleClass('fa-expand fa-compress');\n                        if (root.hasClass('modal-fullscreen')) {\n                            localStorage.removeItem('resized');\n                            let showcontrols = localStorage.getItem('showcontrols') ? true : false;\n                            if (showcontrols) {\n                                iframeDoc.querySelector('body').classList.add('showcontrols');\n                            } else {\n                                iframeDoc.querySelector('body').classList.remove('showcontrols');\n                            }\n                        } else {\n                            localStorage.setItem('resized', '1');\n                            iframeDoc.querySelector('body').classList.add('showcontrols');\n                        }\n                    });\n                };\n\n                // Launch the interactive video in modal\n                $(document).on('click', '.launch-interactivevideo', async function(e) {\n                    e.preventDefault();\n                    const id = $(this).data('id');\n                    const instance = $(this).data('instance');\n                    const course = $(this).data('course');\n                    const contextid = $(this).data('contextid');\n                    const $card = $(this).closest('#interactivevideo-' + instance);\n                    $card.find('.image-container').addClass('hovered');\n                    launchVideo($card, course, contextid, id);\n                });\n\n                $(document).on('click', '.activityname a[href*=\"mod/interactivevideo/view.php\"]', async function(e) {\n                    if ($(this).closest('li').hasClass('launchinpopup')) {\n                        e.preventDefault();\n                        const id = $(this).closest('li').data('id');\n                        launchVideo(null, M.cfg.courseId, null, id);\n                    }\n                });\n\n                $(document).on('click', '.open-external-link', function() {\n                    playerModal.hide();\n                    window.open($(this).data('href'), '_blank');\n                });\n\n                $(document).on('click', '.interactivevideo-card .description-toggle', function() {\n                    const $description = $(this).closest('.top-section').find('.description');\n                    $description.slideToggle('fast', 'swing');\n                    $(this).find('.description-show').toggleClass('rotate');\n                });\n\n                // Get the #hash from the url and scroll to the element and hover it.\n                $(document).ready(function() {\n                    let hash = window.location.hash;\n                    if (hash) {\n                        let $element = $(hash);\n                        if ($element.length > 0 && $element.hasClass('modtype_interactivevideo')) {\n                            $element.addClass('highlighted');\n                            setTimeout(() => {\n                                $element[0].scrollIntoView({behavior: \"smooth\", block: \"center\", inline: \"center\"});\n                                setTimeout(function() {\n                                    $element.removeClass('highlighted');\n                                    // Remove the hash from the url.\n                                    history.pushState(null, null, window.location.href.split('#module')[0]);\n                                }, 3000);\n                            }, 1000);\n                        }\n                    }\n                });\n\n                // Launch report modal.\n                $(document).on('click', '.launch-report', async function(e) {\n                    e.preventDefault();\n                    const href = $(this).data('href');\n\n                    // If control or command key is pressed, open the modal. Otherwise, follow the link.\n                    if (!e.ctrlKey && !e.metaKey) {\n                        window.location.href = href;\n                        return;\n                    }\n\n                    const reportModal = await ModalFactory.create({\n                        body: await Templates.render('mod_interactivevideo/backgroundloading', {show: true}) +\n                            `<iframe src=\"${href}&embed=1\"\n                         class=\"w-100 position-absolute h-100 border-0\"\n                         allow=\"autoplay\"\n                         style=\"z-index:1050;\"></iframe>`,\n                        title: await str.get_string('reportfor', 'mod_interactivevideo', $(this).data('title')),\n                        large: true,\n                        show: false,\n                        removeOnClose: true,\n                        isVerticallyCentered: true,\n                    });\n\n                    const root = reportModal.getRoot();\n                    root.attr('id', 'reportModal').addClass('modal-fullscreen iv-modal');\n                    root.find('.modal-body').addClass('p-0');\n                    reportModal.show();\n                    root.off(ModalEvents.hidden);\n                    root.on(ModalEvents.hidden, function() {\n                        reportModal.destroy();\n                    });\n                });\n\n                // Quick form for interactive video settings.\n                let ModalForm, addToast;\n                $(document).on('click', '.iv_quickform', async function(e) {\n                    const $this = $(this);\n                    e.preventDefault();\n                    const href = $this.data('href');\n                    if (!e.ctrlKey && !e.metaKey) {\n                        window.location.href = href;\n                        return;\n                    }\n\n                    let formdata = {\n                        contextid: $(this).data('contextid'),\n                        cmid: $(this).data('cmid'),\n                        courseid: $(this).data('courseid'),\n                        interaction: $(this).data('interaction'),\n                        origin: 'coursepage',\n                    };\n\n                    if (!ModalForm) {\n                        ModalForm = await import('core_form/modalform');\n                    }\n\n                    if (!addToast) {\n                        addToast = await import('core/toast');\n                    }\n\n                    let form = new ModalForm({\n                        formClass: 'mod_interactivevideo\\\\form\\\\quicksettings_form',\n                        args: formdata,\n                        modalConfig: {\n                            title: await str.get_string('quicksettings', 'mod_interactivevideo'),\n                            removeOnClose: true,\n                        }\n                    });\n\n                    form.show();\n\n                    form.addEventListener(form.events.LOADED, (e) => {\n                        e.stopImmediatePropagation();\n                        // Replace the .modal-lg class with .modal-xl.\n                        setTimeout(() => {\n                            $('.modal.show').addClass('path-mod-interactivevideo');\n                            $('.modal-dialog').removeClass('modal-lg').addClass('modal-xl');\n                        }, 1000);\n                        setTimeout(async() => {\n                            let strings = await str.get_strings([\n                                {key: 'moresettings', component: 'mod_interactivevideo'},\n                                {key: 'resettodefaults', component: 'mod_interactivevideo'},\n                            ]);\n                            $('[data-region=\"footer\"]').css('align-items', 'unset')\n                                .prepend(`<span class=\"btn btn-secondary iv-mr-1 default\" title=\"${strings[1]}\">\n                        <i class=\"fa fa-refresh\"></i></span>\n                        <a type=\"button\" class=\"btn btn-secondary iv-mr-auto\" target=\"_blank\" data-dismiss=\"modal\"\n                         data-bs-dismiss=\"modal\" title=\"${strings[0]}\"\n                            href=\"${M.cfg.wwwroot}/course/modedit.php?update=${formdata.cmid}\"><i class=\"fa fa-cog\"></i>\n                            </a>`);\n                        }, 2000);\n                    });\n\n                    form.addEventListener(form.events.FORM_SUBMITTED, (e) => {\n                        e.stopImmediatePropagation();\n                        addToast.add(str.get_string('settingssaved', 'mod_interactivevideo'), {\n                            type: 'success',\n                        });\n                        // Replace the activity card with the new one.\n                        let $newcard = $(e.detail.html);\n                        $this.closest('.modtype_interactivevideo').replaceWith($newcard).trigger('click');\n                    });\n\n                    let DynamicForm;\n                    $(document).off('click', '.default').on('click', '.default', async function(e) {\n                        e.preventDefault();\n                        formdata.action = 'reset';\n                        if (!DynamicForm) {\n                            DynamicForm = await import('core_form/dynamicform');\n                        }\n                        let form = new DynamicForm(document.querySelector('[data-region=\"body\"]'),\n                            'mod_interactivevideo\\\\form\\\\quicksettings_form');\n                        form.load(formdata);\n                        addToast.add(str.get_string('formvaluesarereset', 'mod_interactivevideo'), {\n                            type: 'info',\n                        });\n                    });\n                });\n            },\n        };\n    });"],"names":["define","$","str","Templates","ModalFactory","ModalEvents","eventDispatcher","playerModal","init","async","launchVideo","$card","course","contextid","id","title","document","currentUrl","window","location","href","showcontrols","localStorage","getItem","fullscreen","destroy","create","body","render","wwwroot","M","cfg","large","show","removeOnClose","isVerticallyCentered","root","getRoot","rootheader","find","html","rootbody","addClass","empty","append","attr","removeClass","trigger","$header","$content","$toggle","hasClass","headerFunction","fadeIn","setTimeout","fadeOut","iframeDoc","iframeAnnos","details","player","iframeWindow","off","shown","on","this","$completion","clone","checkIframeDoc","getElementById","contentDocument","e","cancelAnimationFrame","contentWindow","IVANNO","requestAnimationFrame","hide","IVPLAYER","doptions","hidemainvideocontrols","remove","querySelector","classList","add","nocontrols","focus","toggleClass","setItem","removeItem","addEventListener","detail","$message","$activestart","$progressbar","length","current","data","percentage","css","text","Math","round","hidden","parent","history","pushState","activitytitle","pause","completion","ajax","url","method","dataType","action","cmid","sesskey","courseid","userid","userId","completiondata","JSON","parse","contains","overallcompletion","indexOf","replace","$manualcompletion","progressbar","total","completed","xp","closest","scrollIntoView","behavior","block","inline","onpopstate","target","pathname","error","preventDefault","postMessage","event","dispatchEvent","get_string","ModalForm","addToast","instance","courseId","open","slideToggle","ready","hash","$element","split","ctrlKey","metaKey","reportModal","$this","formdata","interaction","origin","DynamicForm","form","formClass","args","modalConfig","events","LOADED","stopImmediatePropagation","strings","get_strings","key","component","prepend","FORM_SUBMITTED","type","$newcard","replaceWith","load"],"mappings":"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"}