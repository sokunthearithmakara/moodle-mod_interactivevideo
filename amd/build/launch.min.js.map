{"version":3,"file":"launch.min.js","sources":["../src/launch.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Launch the interactive video in modal on course page\n *\n * @module     mod_interactivevideo/launch\n * @copyright  2024 Sokunthearith Makara <sokunthearithmakara@gmail.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/str', 'core/templates'], function($, str, Templates) {\n    return {\n        init: async function() {\n            const launchVideo = async($card, course, contextid, id) => {\n                $('#playermodal').off();\n                // Save the current document title.\n                let title = document.title;\n                // Get current url.\n                let currentUrl = window.location.href;\n                // Get showcontrols from cache.\n                let showcontrols = localStorage.getItem('showcontrols') ? true : false;\n                let dataForTemplate = {\n                    id,\n                    showcontrols,\n                    root: M.cfg.wwwroot,\n                };\n\n                // Get fullscreen from cache.\n                let resized = localStorage.getItem('resized') ? true : false;\n                if (resized) {\n                    dataForTemplate.fullscreen = false;\n                } else {\n                    dataForTemplate.fullscreen = true;\n                }\n\n                const modal = await Templates.render('mod_interactivevideo/playermodal', dataForTemplate);\n\n                $('#playermodal').remove(); // Important:: Remove the previous modal ONLY after the new one is created.\n                $('body').append(modal);\n                $('#playermodal').modal('show');\n                $('#playermodal').find('.toggle-controls').trigger('click');\n\n                let $modal = $('#playermodal');\n                let $header = $modal.find('.modal-header');\n                let $content = $modal.find('.modal-content');\n                let $toggle = $modal.find('.toggle-controls');\n                if (showcontrols && !$content.hasClass('show-control')) {\n                    $toggle.trigger('click');\n                }\n\n                const headerFunction = function() {\n                    if ($header.hasClass('show')) {\n                        return;\n                    }\n\n                    $header.addClass('show');\n                    $header.fadeIn();\n                    if (!$modal.hasClass('locked')) {\n                        setTimeout(function() {\n                            $header.removeClass('show');\n                            $header.fadeOut();\n                        }, 5000);\n                    }\n                };\n\n                let iframeDoc, iframeAnnos, details, player, iframeWindow;\n                $modal.on('shown.bs.modal', function() {\n                    $('body').addClass('overflow-hidden');\n                    $header.addClass('show');\n                    if (localStorage.getItem('lock-bar')) {\n                        $(this).find('.lock-bar').trigger('click');\n                    }\n                    // Copy the activity information to the modal header.\n                    if ($card) {\n                        let $completion = $card.find('[data-region=activity-information]');\n                        $completion = $completion.clone();\n                        $(this).find('[data-region=\"activity-completion\"]').html($completion);\n                    }\n                    // Listen the player timeupdate event in the iframe.\n                    let checkIframeDoc = function() {\n                        try {\n                            iframeDoc = document.getElementById('ivplayer').contentDocument;\n                        } catch (e) {\n                            cancelAnimationFrame(checkIframeDoc);\n                            return;\n                        }\n                        iframeWindow = document.getElementById('ivplayer').contentWindow;\n                        iframeAnnos = iframeWindow.IVANNO;\n                        if (!iframeDoc.getElementById('player')) {\n                            requestAnimationFrame(checkIframeDoc);\n                            return;\n                        }\n                        // Hide the background-loading.\n                        $('#background-loading').hide(0);\n                        if (!iframeAnnos) {\n                            requestAnimationFrame(checkIframeDoc);\n                            return;\n                        }\n\n                        player = iframeWindow.IVPLAYER;\n                        if (showcontrols) {\n                            iframeDoc.querySelector('body').classList.add('showcontrols');\n                        } else {\n                            iframeDoc.querySelector('body').classList.remove('showcontrols');\n                        }\n\n                        let nocontrols = false;\n                        if (!iframeDoc.getElementById('controller')) {\n                            $content.addClass('show-control');\n                            // Remove the toggle button.\n                            $toggle.remove();\n                            nocontrols = true;\n                        }\n\n                        if (iframeDoc.getElementById('player')) {\n                            // Focus on the iframe.\n                            iframeWindow.focus();\n                            $header.removeClass('show');\n                            $toggle.removeClass('d-none');\n\n                            if (!showcontrols && !nocontrols) {\n                                setTimeout(function() {\n                                    $content.removeClass('show-control');\n                                }, 1000);\n                            }\n\n                            $toggle.on('click', function() {\n                                $content.toggleClass('show-control');\n                                showcontrols = $content.hasClass('show-control');\n                                if (showcontrols) {\n                                    localStorage.setItem('showcontrols', '1');\n                                    iframeDoc.querySelector('body').classList.add('showcontrols');\n                                } else {\n                                    localStorage.removeItem('showcontrols');\n                                    iframeDoc.querySelector('body').classList.remove('showcontrols');\n                                }\n                            });\n\n                            iframeDoc.addEventListener('annotationitemsrendered', function(e) {\n                                details = e.detail;\n                            });\n\n                            $(iframeDoc).on('mousemove', '#video-wrapper', function() {\n                                if ($('#playermodal').hasClass('locked')) {\n                                    return;\n                                }\n                                let $message = iframeDoc.querySelector('#message:not(.sticky)');\n                                let $activestart = iframeDoc.querySelector('#start-screen:not(.d-none) .hasintro');\n                                if ($message || $activestart) {\n                                    $header.removeClass('show');\n                                } else {\n                                    headerFunction();\n                                }\n                            });\n\n                            iframeDoc.addEventListener('videoPaused', function() {\n                                if ($modal.hasClass('locked')) {\n                                    return;\n                                }\n                                let $message = iframeDoc.querySelector('#message:not(.sticky)');\n                                let $activestart = iframeDoc.querySelector('#start-screen:not(.d-none) .hasintro');\n                                if ($message || $activestart) {\n                                    $header.removeClass('show');\n                                } else {\n                                    headerFunction();\n                                }\n                                $toggle.fadeOut(300);\n                            });\n\n                            iframeDoc.addEventListener('iv:playerPlay', function() {\n                                $toggle.fadeIn(300);\n                            });\n\n                            iframeDoc.addEventListener('iv:playerReload', function(e) {\n                                player = e.detail.player;\n                            });\n\n                            // Analytics progress bar.\n                            if ($card === null) {\n                                return;\n                            }\n                            let $progressbar = $card.find('.analytics.progress .progress-bar');\n                            if ($progressbar.length == 0) {\n                                return;\n                            }\n                            let current = $progressbar.data('current');\n                            iframeDoc.addEventListener('analyticsupdated', function(e) {\n                                let percentage = e.detail.percentage;\n                                if (percentage > current) {\n                                    $progressbar.css('width', percentage + '%')\n                                        .data('current', percentage);\n                                    $card.find('.analytics-percentage').text(Math.round(percentage));\n                                }\n                                if (!player) {\n                                    // Remove modal.\n                                    $modal.remove();\n                                }\n                            });\n                        } else {\n                            requestAnimationFrame(checkIframeDoc);\n                        }\n                    };\n                    requestAnimationFrame(checkIframeDoc);\n\n                    $(this).off('hidden.bs.modal').on('hidden.bs.modal', function() {\n                        cancelAnimationFrame(checkIframeDoc);\n                    });\n\n                    $modal.off('click', '[data-action=\"toggle-manual-completion\"]')\n                        .on('click', '[data-action=\"toggle-manual-completion\"]', function() {\n                            $(this).parent().addClass('updated');\n                            if ($(this).data('withavailability') == 1) {\n                                history.pushState(null, null, M.cfg.wwwroot + '/course/view.php?id='\n                                    + course + '#module-' + id);\n                            }\n                        });\n\n\n                    // Update the browser url to the current activity.\n                    history.pushState(null, null, M.cfg.wwwroot + '/mod/interactivevideo/view.php?id=' + id);\n                    // Update the title of tab to the activity name.\n                    if ($card) {\n                        let activitytitle = $card.data('title');\n                        document.title = activitytitle;\n                    } else {\n                        document.title = $('li[data-id=\"' + id + '\"] .activityname').text();\n                    }\n                });\n\n                $modal.on('hide.bs.modal', async function() {\n                    $('body').removeClass('overflow-hidden');\n                    iframeWindow.postMessage({\n                        event: 'closemodal',\n                    }, '*');\n                    // Trigger hover on .image-container for 2 seconds.\n                    if ($card) {\n                        setTimeout(function() {\n                            $card.find('.image-container').removeClass('hovered');\n                        }, 1000);\n                    }\n\n                    if (player) { // Must check this in case user close modal before the player is ready.\n                        await player.pause();\n                    } else {\n                        $(this).remove();\n                        return;\n                    }\n\n                    if ($card) {\n                        // If there is automatic completion conditions, we have to update it.\n                        let $autocompletion = $card.find('.automatic-completion-conditions');\n                        if ($autocompletion.length > 0) {\n                            const completion = await $.ajax({\n                                url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                                method: 'POST',\n                                dataType: 'text',\n                                data: {\n                                    action: 'get_cm_completion',\n                                    cmid: id,\n                                    sesskey: M.cfg.sesskey,\n                                    contextid: contextid,\n                                    courseid: course,\n                                    userid: M.cfg.userId || 0,\n                                }\n                            });\n\n                            if (completion) {\n                                const completiondata = JSON.parse(completion);\n                                // Check if the iframe document has withavailability class. If so, refresh the page.\n                                if (iframeDoc.body.classList.contains('withavailability') && completiondata.overallcompletion) {\n                                    // eslint-disable-next-line max-depth\n                                    if (currentUrl.indexOf('#module-') > -1) {\n                                        currentUrl = currentUrl.replace(/#module-\\d+/, '#module-' + id);\n                                    } else {\n                                        currentUrl = currentUrl + '#module-' + id;\n                                    }\n                                    window.location.href = currentUrl;\n                                    return;\n                                }\n                                $card.find('[data-region=activity-information]')\n                                    .html($(completiondata.completion).html());\n                            }\n                        }\n\n                        // If there is manual completion, we have to copy the button to the course page.\n                        let $manualcompletion = $(this).find('.completion-info.updated');\n                        if ($manualcompletion.length > 0) {\n                            $card.find('.completion-info').html($manualcompletion.html());\n                        }\n\n                        if (details) {\n                            let progressbar = $card.find('.tasks .progress-bar');\n                            if (progressbar.length > 0 && details.total > 0) {\n                                let percentage = Math.round(details.completed / details.total * 100);\n                                progressbar.css('width', percentage + '%');\n                                if (details.completed == details.total) {\n                                    progressbar.addClass('bg-success').removeClass('bg-primary');\n                                } else {\n                                    progressbar.removeClass('bg-success').addClass('bg-primary');\n                                }\n                                $card.find('.percentage')\n                                    .text(percentage);\n                                $card.find('.items').text(`(${details.completed}/${details.total})`);\n                                $card.find('.xp').text(details.xp);\n                            }\n                        }\n                    }\n\n                    // Update the browser url to the current course.\n                    history.pushState(null, null, M.cfg.wwwroot + '/course/view.php?id=' + course);\n                    document.title = title;\n\n                    if ($card) {\n                        if (iframeAnnos) {\n                            // Remove the new-bagde from the poster.\n                            $card.find('.new-badge').remove();\n                        }\n\n                        $card.closest('.modtype_interactivevideo')[0]\n                            .scrollIntoView({behavior: \"smooth\", block: \"center\", inline: \"center\"});\n                    }\n\n                    if (iframeDoc) {\n                        $(iframeDoc).off();\n                        iframeAnnos = null;\n                        details = null;\n                        player = null;\n\n                        if ($card.find('.analytics.progress .progress-bar').length == 0) {\n                            // Remove the iframe.\n                            $('#playermodal').remove();\n                            iframeDoc = null;\n                        }\n                    }\n                });\n\n                // Close modal when the browser back button is clicked.\n                window.onpopstate = function(e) {\n                    if (e.target.location.pathname == '/course/view.php') {\n                        $modal.modal('hide');\n                    }\n                };\n\n                $(document).off('click', '.close-modal').on('click', '.close-modal', function(e) {\n                    e.preventDefault();\n                    $modal.modal('hide');\n                    $('.modal-backdrop.show').remove();\n                });\n\n                $(document).off('click', '.lock-bar').on('click', '.lock-bar', async function(e) {\n                    e.preventDefault();\n                    $(this).toggleClass('locked');\n                    $modal.toggleClass('locked');\n                    if ($(this).hasClass('locked')) {\n                        $(this).attr('title', await str.get_string('unlock', 'mod_interactivevideo'));\n                        $(this).find('i').removeClass('fa-unlock').addClass('fa-lock');\n                        $header.addClass('show');\n                        // Save to local storage.\n                        localStorage.setItem('lock-bar', '1');\n                        headerFunction();\n                    } else {\n                        $(this).attr('title', await str.get_string('lock', 'mod_interactivevideo'));\n                        $(this).find('i').removeClass('fa-lock').addClass('fa-unlock');\n                        // Remove from local storage.\n                        localStorage.removeItem('lock-bar');\n                        setTimeout(function() {\n                            $header.removeClass('show');\n                        }, 5000);\n                    }\n                });\n\n                $modal.off('click', '.resize').on('click', '.resize', function(e) {\n                    e.preventDefault();\n                    $modal.toggleClass('modal-fullscreen iv-rounded-0 modal-resized');\n                    $modal.find('.modal-dialog, .modal-content').toggleClass('iv-rounded-0');\n                    $(this).find('i').toggleClass('fa-expand fa-compress');\n                    if ($modal.hasClass('modal-fullscreen')) {\n                        localStorage.removeItem('resized');\n                        let showcontrols = localStorage.getItem('showcontrols') ? true : false;\n                        if (showcontrols) {\n                            iframeDoc.querySelector('body').classList.add('showcontrols');\n                        } else {\n                            iframeDoc.querySelector('body').classList.remove('showcontrols');\n                        }\n                    } else {\n                        localStorage.setItem('resized', '1');\n                        iframeDoc.querySelector('body').classList.add('showcontrols');\n                    }\n                });\n            };\n\n            // Launch the interactive video in modal\n            $(document).on('click', '.launch-interactivevideo', async function(e) {\n                e.preventDefault();\n                const id = $(this).data('id');\n                const instance = $(this).data('instance');\n                const course = $(this).data('course');\n                const contextid = $(this).data('contextid');\n                const $card = $(this).closest('#interactivevideo-' + instance);\n                $card.find('.image-container').addClass('hovered');\n                launchVideo($card, course, contextid, id);\n            });\n\n            $(document).on('click', '.activityname a[href*=\"mod/interactivevideo/view.php\"]', async function(e) {\n                if ($(this).closest('li').hasClass('launchinpopup')) {\n                    e.preventDefault();\n                    const id = $(this).closest('li').data('id');\n                    launchVideo(null, M.cfg.courseId, null, id);\n                }\n            });\n\n            $(document).on('click', '.open-external-link', function() {\n                $('#playermodal').modal('hide');\n                window.open($(this).data('href'), '_blank');\n            });\n\n            $(document).on('click', '.interactivevideo-card .description-toggle', function() {\n                const $description = $(this).closest('.top-section').find('.description');\n                $description.slideToggle('fast', 'swing');\n                $(this).find('.description-show').toggleClass('rotate');\n            });\n\n            // Get the #hash from the url and scroll to the element and hover it.\n            $(document).ready(function() {\n                let hash = window.location.hash;\n                if (hash) {\n                    let $element = $(hash);\n                    if ($element.length > 0 && $element.hasClass('modtype_interactivevideo')) {\n                        $element.addClass('highlighted');\n                        setTimeout(() => {\n                            $element[0].scrollIntoView({behavior: \"smooth\", block: \"center\", inline: \"center\"});\n                            setTimeout(function() {\n                                $element.removeClass('highlighted');\n                                // Remove the hash from the url.\n                                history.pushState(null, null, window.location.href.split('#module')[0]);\n                            }, 3000);\n                        }, 1000);\n                    }\n                }\n            });\n\n            // Launch report modal.\n            $(document).on('click', '.launch-report', async function(e) {\n                e.preventDefault();\n                const href = $(this).data('href');\n\n                // If control or command key is pressed, open the modal. Otherwise, follow the link.\n                if (!e.ctrlKey && !e.metaKey) {\n                    window.location.href = href;\n                    return;\n                }\n\n                const data = {\n                    id: 'reportModal',\n                    title: await str.get_string('reportfor', 'mod_interactivevideo', $(this).data('title')),\n                    body: `<iframe src=\"${href}&embed=1\"\n                                        style=\"width: 100%; height: 100%; border: 0; z-index:1050; position:absolute;\"></iframe>`,\n                };\n                let Modal = await Templates.render('mod_interactivevideo/fullscreenmodal', data);\n\n                $('body').append(Modal);\n                $('#reportModal').modal('show');\n                $('#reportModal').on('shown.bs.modal', function() {\n                    $(this).focus();\n                });\n                $('#reportModal').on('hidden.bs.modal', function() {\n                    $(this).remove();\n                });\n            });\n\n            // Quick form for interactive video settings.\n            let ModalForm, addToast;\n            $(document).on('click', '.iv_quickform', async function(e) {\n                const $this = $(this);\n                e.preventDefault();\n                const href = $this.data('href');\n                if (!e.ctrlKey && !e.metaKey) {\n                    window.location.href = href;\n                    return;\n                }\n\n                let formdata = {\n                    contextid: $(this).data('contextid'),\n                    cmid: $(this).data('cmid'),\n                    courseid: $(this).data('courseid'),\n                    interaction: $(this).data('interaction'),\n                    origin: 'coursepage',\n                };\n\n                if (!ModalForm) {\n                    ModalForm = await import('core_form/modalform');\n                }\n\n                if (!addToast) {\n                    addToast = await import('core/toast');\n                }\n\n                let form = new ModalForm({\n                    formClass: 'mod_interactivevideo\\\\form\\\\quicksettings_form',\n                    args: formdata,\n                    modalConfig: {\n                        title: await str.get_string('quicksettings', 'mod_interactivevideo'),\n                        removeOnClose: true,\n                    }\n                });\n\n                form.show();\n\n                form.addEventListener(form.events.LOADED, (e) => {\n                    e.stopImmediatePropagation();\n                    // Replace the .modal-lg class with .modal-xl.\n                    setTimeout(() => {\n                        $('.modal-dialog').removeClass('modal-lg').addClass('modal-xl path-mod-interactivevideo');\n                    }, 1000);\n                    setTimeout(async() => {\n                        let strings = await str.get_strings([\n                            {key: 'moresettings', component: 'mod_interactivevideo'},\n                            {key: 'resettodefaults', component: 'mod_interactivevideo'},\n                        ]);\n                        $('[data-region=\"footer\"]').css('align-items', 'unset')\n                            .prepend(`<span class=\"btn btn-secondary iv-mr-1 default\" title=\"${strings[1]}\">\n                        <i class=\"fa fa-refresh\"></i></span>\n                        <a type=\"button\" class=\"btn btn-secondary iv-mr-auto\" target=\"_blank\" data-dismiss=\"modal\"\n                         data-bs-dismiss=\"modal\" title=\"${strings[0]}\"\n                            href=\"${M.cfg.wwwroot}/course/modedit.php?update=${formdata.cmid}\"><i class=\"fa fa-cog\"></i>\n                            </a>`);\n                    }, 2000);\n                });\n\n                form.addEventListener(form.events.FORM_SUBMITTED, (e) => {\n                    e.stopImmediatePropagation();\n                    addToast.add(str.get_string('settingssaved', 'mod_interactivevideo'), {\n                        type: 'success',\n                    });\n                    // Replace the activity card with the new one.\n                    let $newcard = $(e.detail.html);\n                    $this.closest('.modtype_interactivevideo').replaceWith($newcard).trigger('click');\n                });\n\n                let DynamicForm;\n                $(document).off('click', '.default').on('click', '.default', async function(e) {\n                    e.preventDefault();\n                    formdata.action = 'reset';\n                    if (!DynamicForm) {\n                        DynamicForm = await import('core_form/dynamicform');\n                    }\n                    let form = new DynamicForm(document.querySelector('[data-region=\"body\"]'),\n                        'mod_interactivevideo\\\\form\\\\quicksettings_form');\n                    form.load(formdata);\n                    addToast.add(str.get_string('formvaluesarereset', 'mod_interactivevideo'), {\n                        type: 'info',\n                    });\n                });\n            });\n        },\n    };\n});"],"names":["define","$","str","Templates","init","async","launchVideo","$card","course","contextid","id","off","title","document","currentUrl","window","location","href","showcontrols","localStorage","getItem","dataForTemplate","root","M","cfg","wwwroot","resized","fullscreen","modal","render","remove","append","find","trigger","$modal","$header","$content","$toggle","hasClass","headerFunction","addClass","fadeIn","setTimeout","removeClass","fadeOut","iframeDoc","iframeAnnos","details","player","iframeWindow","on","this","$completion","clone","html","checkIframeDoc","getElementById","contentDocument","e","cancelAnimationFrame","contentWindow","IVANNO","requestAnimationFrame","hide","IVPLAYER","querySelector","classList","add","nocontrols","focus","toggleClass","setItem","removeItem","addEventListener","detail","$message","$activestart","$progressbar","length","current","data","percentage","css","text","Math","round","parent","history","pushState","activitytitle","postMessage","event","pause","completion","ajax","url","method","dataType","action","cmid","sesskey","courseid","userid","userId","completiondata","JSON","parse","body","contains","overallcompletion","indexOf","replace","$manualcompletion","progressbar","total","completed","xp","closest","scrollIntoView","behavior","block","inline","onpopstate","target","pathname","preventDefault","attr","get_string","ModalForm","addToast","instance","courseId","open","slideToggle","ready","hash","$element","split","ctrlKey","metaKey","Modal","$this","formdata","interaction","origin","DynamicForm","form","formClass","args","modalConfig","removeOnClose","show","events","LOADED","stopImmediatePropagation","strings","get_strings","key","component","prepend","FORM_SUBMITTED","type","$newcard","replaceWith","load"],"mappings":"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"}