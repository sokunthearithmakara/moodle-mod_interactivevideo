define("mod_interactivevideo/player/wistia",["exports","jquery","core/event_dispatcher","mod_interactivevideo/player/checkautoplay"],(function(_exports,_jquery,_event_dispatcher,_checkautoplay){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Wistia Player class
   * Doc: https://docs.wistia.com/docs/javascript-player-api
   *
   * @module     mod_interactivevideo/player/wistia
   * @copyright  2024 Sokunthearith Makara <sokunthearithmakara@gmail.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=_interopRequireDefault(_jquery),_checkautoplay=_interopRequireDefault(_checkautoplay);let player={};var _default=class{constructor(){this.type="wistia",this.useAnimationFrame=!0,this.frequency=.3,this.support={playbackrate:!0,quality:!0,password:!0}}async getInfo(url,node){return this.node=node,new Promise((resolve=>{const videoId=/(?:https?:\/\/)?(?:www\.)?(?:wistia\.com)\/medias\/([^/]+)/g.exec(url)[1];this.videoId=videoId,(0,_jquery.default)("#".concat(node)).html('<div class="wistia_embed wistia_async_'.concat(videoId,' wmode=transparent\n             controlsVisibleOnLoad=true playButton=true videoFoam=false silentAutoPlay=allow playsinline=true\n              fullscreenButton=false\n               fitStrategy=contain" style="height:100%;width:100%"></div>'));let self=this;_jquery.default.get("https://fast.wistia.com/oembed.json?url="+url).then((function(data){return self.posterImage=data.thumbnail_url,self.title=data.title,self.posterImage})).catch((()=>{}));const wistiaOptions={id:videoId,onReady:async function(video){player[node]=video,resolve({duration:video.duration(),title:self.title,posterImage:self.posterImage})}};if(window._wq)window._wq.push(wistiaOptions);else{var tag=document.createElement("script");tag.src="https://fast.wistia.com/assets/external/E-v1.js",tag.async=!0,tag.as="script",tag.rel="preload";var firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag);var interval=setInterval((()=>{window._wq&&(clearInterval(interval),window._wq.push(wistiaOptions))}),1e3)}}))}async load(url,start,end){let opts=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const showControls=opts.showControls||!1,node=opts.node||"player";this.node=node,this.allowAutoplay=await(0,_checkautoplay.default)(document.getElementById(node)),this.allowAutoplay||(0,_event_dispatcher.dispatchEvent)("iv:autoplayBlocked"),this.start=start,opts.passwordprotected&&(0,_jquery.default)("#start-screen, .video-block, #video-block").remove(),showControls||(0,_jquery.default)("body").addClass("no-original-controls"),(0,_jquery.default)("#".concat(node)).parent().removeClass("d-none");const videoId=/(?:https?:\/\/)?(?:www\.)?(?:wistia\.com)\/medias\/([^/]+)/g.exec(url)[1];this.videoId=videoId,(0,_jquery.default)("#".concat(node)).html('<div class="wistia_embed wistia_async_'.concat(videoId," wmode=transparent\n             controlsVisibleOnLoad=true playButton=true videoFoam=false silentAutoPlay=allow playsinline=true\n              fullscreenButton=false ").concat(this.allowAutoplay?"time=".concat(start):"",'\n               fitStrategy=contain" style="height:100%;width:100%"></div>'));let self=this;opts.editform&&_jquery.default.get("https://fast.wistia.com/oembed.json?url="+url).then((function(data){return self.posterImage=data.thumbnail_url,self.title=data.title,self.posterImage})).catch((()=>{}));let ready=!1;const wistiaOptions={id:videoId,options:{plugin:{chapters:{on:!1},"postRoll-v1":{on:!1}}},onReady:async function(video){(0,_jquery.default)("#annotation-canvas").removeClass("d-none w-0"),player[node]=video,self.aspectratio=self.ratio();let totaltime=video.duration()-self.frequency;end=end?Math.min(end,totaltime):totaltime,end=Number(end.toFixed(2)),self.end=end,self.totaltime=Number(totaltime.toFixed(2)),self.duration=self.end-self.start;video.mute(),video.play(),await video.time(start),await video.pause(),(0,_jquery.default)(document).find(".w-password-protected").length>0?video.play():ready||(ready=!0,(0,_event_dispatcher.dispatchEvent)("iv:playerReady",null,document.getElementById(node)),video.unmute(),video.on("pause",(()=>{self.paused=!0,(0,_jquery.default)(document).find(".w-password-protected").length>0||(video.time()>=end?(self.ended=!0,(0,_event_dispatcher.dispatchEvent)("iv:playerEnded")):(0,_event_dispatcher.dispatchEvent)("iv:playerPaused"))})),video.on("seek",(e=>{(0,_jquery.default)(document).find(".w-password-protected").length>0||(0,_event_dispatcher.dispatchEvent)("iv:playerSeek",{time:e})})),video.bind("play",(async()=>{video.time()>=end&&await video.time(start),self.paused=!1,(0,_event_dispatcher.dispatchEvent)("iv:playerPlay"),(0,_event_dispatcher.dispatchEvent)("iv:playerPlaying")})),video.on("timechange",(s=>{self.paused=!1,s<start&&video.time(start),s>=end+self.frequency&&video.time(end-self.frequency),s>=end&&(self.ended=!0,(0,_event_dispatcher.dispatchEvent)("iv:playerEnded"))})),video.on("error",(e=>{(0,_event_dispatcher.dispatchEvent)("iv:playerError",{error:e})})),video.on("playbackratechange",(e=>{(0,_event_dispatcher.dispatchEvent)("iv:playerRateChange",{rate:e})})),video.on("volumechange",(e=>{(0,_event_dispatcher.dispatchEvent)("iv:playerVolumeChange",{volume:e})})))},onError:function(e){(0,_event_dispatcher.dispatchEvent)("iv:playerError",{error:e})}};if(window._wq)window._wq.push(wistiaOptions);else{var tag=document.createElement("script");tag.src="https://fast.wistia.com/assets/external/E-v1.js",tag.async=!0,tag.as="script",tag.rel="preload";var firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag);var interval=setInterval((()=>{window._wq&&(clearInterval(interval),window._wq.push(wistiaOptions))}),1e3)}}play(){player[this.node]&&(player[this.node].play(),this.paused=!1)}async pause(){player[this.node]&&(await player[this.node].pause(),this.paused=!0)}stop(starttime){player[this.node]&&(player[this.node].pause(),player[this.node].time(starttime))}seek(time){if(!player[this.node])return time;let currentTime=this.getCurrentTime();return(0,_event_dispatcher.dispatchEvent)("iv:playerSeekStart",{time:currentTime}),player[this.node].time(time),this.ended=!1,(0,_event_dispatcher.dispatchEvent)("iv:playerSeek",{time:time}),time}getCurrentTime(){return player[this.node]?player[this.node].time():0}getDuration(){return player[this.node]?player[this.node].duration():0}isPaused(){return!player[this.node]||(!!this.paused||"paused"===player[this.node].state())}isPlaying(){return!!player[this.node]&&(!this.paused&&"playing"===player[this.node].state())}isEnded(){return!!player[this.node]&&this.ended}ratio(){return player[this.node]?player[this.node].aspect():16/9}destroy(){player[this.node]&&(player[this.node].remove(),player[this.node]=null,(0,_event_dispatcher.dispatchEvent)("iv:playerDestroyed"))}getState(){return player[this.node]?player[this.node].state():"paused"}setRate(rate){player[this.node]&&player[this.node].playbackRate(rate)}mute(){player[this.node]&&player[this.node].mute()}unMute(){player[this.node]&&(player[this.node].unmute(),player[this.node].volume(1))}isMuted(){return!!player[this.node]&&player[this.node].isMuted()}originalPlayer(){return player[this.node]}setQuality(quality){return player[this.node]?(player[this.node].videoQuality(quality),(0,_event_dispatcher.dispatchEvent)("iv:playerQualityChange",{quality:quality}),quality):0}getQualities(){return player[this.node]?{qualities:["auto","360","540","720","1080","2160"],qualitiesLabel:["Auto","360p","540p","720p","1080p","4k"],currentQuality:"auto"==player[this.node].videoQuality()?0:player[this.node].videoQuality()}:null}setCaption(track){return player[this.node]?track:null}};return _exports.default=_default,_exports.default}));

//# sourceMappingURL=wistia.min.js.map