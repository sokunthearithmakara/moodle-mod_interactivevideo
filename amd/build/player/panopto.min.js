define("mod_interactivevideo/player/panopto",["exports","core/event_dispatcher","jquery"],(function(_exports,_event_dispatcher,_jquery){var obj,player;
/**
   * Panopto Player class
   *
   * @module     mod_interactivevideo/player/panopto
   * @copyright  2024 Sokunthearith Makara <sokunthearithmakara@gmail.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=(obj=_jquery)&&obj.__esModule?obj:{default:obj};var _default=class{constructor(){this.useAnimationFrame=!0,this.type="panopto",this.frequency=.25,this.support={playbackrate:!0,quality:!1}}load(url,start,end){let opts=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const showControls=opts.showControls||!1,node=opts.node||"player";var EmbedApi;this.start=start,this.end=end;const matches=url.match(/^[^\/]+:\/\/([^\/]*panopto\.[^\/]+)\/Panopto\/.+\?id=(.+)$/),serverName=matches[1],sessionId=matches[2];var ready=!1,self=this;self.aspectratio=16/9;var options={sessionId:sessionId,serverName:serverName,width:1080,height:720,videoParams:{interactivity:"none",showtitle:!1,autohide:!0,offerviewer:!1,autoplay:!0,showbrand:!1,start:start,hideoverlay:!showControls},events:{onReady:function(){},onIframeReady:async function(){player.loadVideo(),_jquery.default.ajax({url:M.cfg.wwwroot+"/mod/interactivevideo/ajax.php",type:"POST",dataType:"text/plain",data:{action:"get_from_url",contextid:M.cfg.contextid,url:url,sesskey:M.cfg.sesskey},complete:function(res){player.pauseVideo();let totaltime=Number(player.getDuration().toFixed(2))-self.frequency;end=end?Math.min(end,totaltime):totaltime,end=Number(end.toFixed(2)),self.end=end,self.totaltime=totaltime,self.duration=self.end-self.start;let tracks=player.getCaptionTracks();player.disableCaptions(),tracks&&tracks.length>0&&(tracks=tracks.map(((track,i)=>({label:track,code:"code-"+i}))),(0,_event_dispatcher.dispatchEvent)("iv:playerLoaded",{tracks:tracks}));let doc=(new DOMParser).parseFromString(res.responseText,"text/html"),page=(0,_jquery.default)(doc),title=page.find('meta[property="og:title"]').attr("content"),poster=page.find('meta[property="og:image"]').attr("content");self.title=title,self.posterImage=poster,ready=!0,(0,_event_dispatcher.dispatchEvent)("iv:playerReady")}})},onStateChange:function(state){if(!1!==ready)switch(state){case PlayerState.Ended:self.ended=!0,(0,_event_dispatcher.dispatchEvent)("iv:playerEnded");break;case PlayerState.Playing:(player.getCurrentTime()>=self.end||player.getCurrentTime()<self.start)&&player.seekTo(self.start),(0,_event_dispatcher.dispatchEvent)("iv:playerPlaying"),self.ended=!1,this.paused=!1;break;case PlayerState.Paused:if(this.paused=!0,!self.ended&&player.getCurrentTime()>=self.end-self.frequency)return(0,_event_dispatcher.dispatchEvent)("iv:playerEnded"),void(self.ended=!0);(0,_event_dispatcher.dispatchEvent)("iv:playerPaused"),self.ended=!1}else player.pauseVideo()},onPlaybackRateChange:function(e){(0,_event_dispatcher.dispatchEvent)("iv:playerRateChange",{rate:e})},onError:function(error){(0,_event_dispatcher.dispatchEvent)("iv:playerError",{error:error})}}};if(window.EmbedApi)player=new window.EmbedApi(node,options);else{var tag=document.createElement("script");tag.src="https://developers.panopto.com/scripts/embedapi.min.js",tag.type="text/javascript";var firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag),window.onPanoptoEmbedApiReady=function(){EmbedApi=window.EmbedApi,player=new EmbedApi(node,options)}}}play(){player.playVideo(),this.paused=!1}pause(){player.pauseVideo(),this.paused=!0}stop(starttime){player.seekTo(starttime),player.pauseVideo()}async seek(time){return new Promise((resolve=>{player.seekTo(time,!0),(0,_event_dispatcher.dispatchEvent)("iv:playerSeek",{time:time}),resolve(!0)}))}getCurrentTime(){return player.getCurrentTime()}getDuration(){return player.getDuration()}isPaused(){return!!this.paused||player.getState()==PlayerState.Paused}isPlaying(){return!this.paused&&player.getState()==PlayerState.Playing}isEnded(){return!!this.ended||(player.getState()==PlayerState.Ended||player.getCurrentTime()>=this.end)}ratio(){return 16/9}destroy(){player=null,(0,_jquery.default)("#player").remove(),(0,_event_dispatcher.dispatchEvent)("iv:playerDestroyed")}getState(){return 1===player.getState()?"playing":2===player.getState()?"paused":"stopped"}setRate(rate){return player.setPlaybackRate(rate),rate}mute(){player.muteVideo()}unMute(){player.unmuteVideo()}originalPlayer(){return player}setCaption(track){!1!==player.hasCaptions()&&(track?(track=track.replace("code-",""),player.enableCaptions(track)):player.disableCaptions())}};return _exports.default=_default,_exports.default}));

//# sourceMappingURL=panopto.min.js.map