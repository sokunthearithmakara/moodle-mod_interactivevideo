{"version":3,"file":"report.min.js","sources":["../src/report.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Handle report page\n *\n * @module     mod_interactivevideo/report\n * @copyright  2024 Sokunthearith Makara <sokunthearithmakara@gmail.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport $ from 'jquery';\nimport Notification from 'core/notification';\nimport {add as addToast} from 'core/toast';\nimport JSZip from './libraries/jszip';\nimport './libraries/jquery.dataTables';\nimport './libraries/dataTables.bootstrap4';\nimport './libraries/dataTables.buttons';\nimport './libraries/buttons.bootstrap4';\nimport './libraries/buttons.html5';\nimport quickform from './quickform';\n/**\n * Initializes the report functionality for the interactive video module.\n *\n * @param {number} cmid - The course module ID.\n * @param {number} groupid - The group ID.\n * @param {number} grademax - The maximum grade.\n * @param {Array} itemids - The annotation IDs.\n * @param {number} completionpercentage - The completion percentage.\n * @param {string} videourl - The video URL.\n * @param {string} videotype - The video type.\n * @param {Object} cm - The course module object.\n * @param {number} courseid - The course ID.\n * @param {number} start - The start time.\n * @param {number} end - The end time.\n * @param {Object} access - The access object.\n */\nconst init = (cmid, groupid, grademax, itemids, completionpercentage, videourl, videotype, cm, courseid, start, end, access) => {\n    window.JSZip = JSZip;\n    let DataTable = $.fn.dataTable;\n    let player;\n\n    quickform();\n\n    const getContentTypes = $.ajax({\n        url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n        method: \"POST\",\n        dataType: \"text\",\n        data: {\n            action: 'get_all_contenttypes',\n            sesskey: M.cfg.sesskey,\n            contextid: M.cfg.contextid,\n        }\n    });\n\n    const getReportData = $.ajax({\n        url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n        method: 'POST',\n        data: {\n            action: 'get_report_data_by_group',\n            cmid: cmid,\n            sesskey: M.cfg.sesskey,\n            contextid: M.cfg.contextid,\n            ctxid: M.cfg.courseContextId,\n            courseid: courseid,\n            groupid: groupid\n        }\n    });\n\n    let itemsdata = $('#itemsdata').text();\n    itemsdata = JSON.parse(itemsdata);\n    // Init the contenttypes that has initonreport.\n    let initonreport = itemsdata.filter(x => JSON.parse(x.prop).initonreport);\n    initonreport = [...new Set(initonreport.map(x => x.type))];\n\n    let contentTypes;\n    let tabledata;\n    $.when(getContentTypes, getReportData).done(async(ct, data) => {\n        contentTypes = JSON.parse(ct[0]);\n        data = data[0];\n\n        let datatableOptions = {\n            \"data\": data,\n            \"deferRender\": true,\n            \"rowId\": \"id\",\n            \"pageLength\": 25,\n            \"order\": [[1, \"asc\"]],\n            \"columns\": [\n                {\n                    data: \"id\",\n                    visible: false\n                },\n                {\n                    data: \"picture\",\n                    render: function(data, type, row) {\n                        let deletebutton = '';\n                        if (access.canedit == 1) {\n                            deletebutton = `<button title=\"${M.util.get_string('reset', 'mod_interactivevideo')}\"\n                         class=\"btn border-0 btn-sm text-danger reset m-1\" data-record=\"${row.completionid}\"\n                          data-userid=\"${row.id}\">\n                         <i class=\"bi bi-trash3\"></i></button>`;\n                        }\n                        // Put _target=blank to open the user profile in a new tab (use regex)\n                        data = data.replace(/<a /g, '<a target=\"_blank\" ');\n                        return `<div class=\"text-truncate d-flex align-items-center justify-content-between\">${data}\n                        ${row.timecreated > 0 ? deletebutton : ''}</div>`;\n                    },\n                    className: \"bg-white sticky-left-0\",\n                },\n                {\n                    data: \"firstname\",\n                    className: \"exportable\"\n                },\n                {\n                    data: \"lastname\",\n                    className: \"exportable\"\n                },\n                {\n                    data: \"email\",\n                    className: \"exportable\"\n                },\n                {\n                    data: \"timecreated\",\n                    \"render\": function(data, type) {\n                        if (!data || data == 0) {\n                            if (type === 'display') {\n                                return M.util.get_string('notstarted', 'mod_interactivevideo');\n                            } else {\n                                return 0;\n                            }\n                        } else {\n                            const date = new Date(data * 1000);\n                            if (type === 'display') {\n                                return date.toLocaleString();\n                            } else if (type === 'filter' || type === 'sort') {\n                                return date.getTime();\n                            }\n                            return data;\n                        }\n                    },\n                    className: \"exportable\"\n                },\n                {\n                    data: \"timecompleted\",\n                    render: function(data, type, row) {\n                        if (!data || data == 0) {\n                            if (!row.timecreated) {\n                                return '';\n                            } else {\n                                if (type === 'display') {\n                                    return M.util.get_string('inprogress', 'mod_interactivevideo');\n                                } else {\n                                    return 0;\n                                }\n                            }\n                        } else {\n                            const date = new Date(data * 1000);\n                            if (type === 'display') {\n                                return date.toLocaleString();\n                            } else if (type === 'filter' || type === 'sort') {\n                                return date.getTime();\n                            }\n                            return data;\n                        }\n                    },\n                    className: \"exportable\"\n                },\n                {\n                    data: \"completionpercentage\",\n                    render: function(data) {\n                        if (data) {\n                            return data + \"%\";\n                        } else {\n                            return \"\";\n                        }\n                    },\n                    className: \"exportable\"\n                },\n                {\n                    data: \"xp\",\n                    render: function(data) {\n                        if (data) {\n                            return data;\n                        } else {\n                            return \"\";\n                        }\n                    },\n                    className: \"exportable\"\n                }\n            ],\n            \"language\": {\n                \"lengthMenu\": \"_MENU_\",\n                \"zeroRecords\": M.util.get_string('nofound', \"mod_interactivevideo\"),\n                \"search\": `<span class=\"d-none d-md-inline\">${M.util.get_string('search', \"mod_interactivevideo\")}</span>`,\n                \"info\": M.util.get_string('datatableinfo', \"mod_interactivevideo\"),\n                \"infoEmpty\": M.util.get_string('datatableinfoempty', \"mod_interactivevideo\"),\n                \"infoFiltered\": M.util.get_string('datatableinfofiltered', \"mod_interactivevideo\"),\n                \"paginate\": {\n                    \"first\": M.util.get_string('first', 'mod_interactivevideo'),\n                    \"last\": M.util.get_string('last', 'mod_interactivevideo'),\n                    \"next\": M.util.get_string('next', 'mod_interactivevideo'),\n                    \"previous\": M.util.get_string('previous', 'mod_interactivevideo')\n                }\n            },\n            stateSaveParams: function(settings, data) {\n                // We only want to save the state of the colvis and length menu\n                data.search.search = \"\";\n                data.start = 0;\n                data.columns.forEach(function(column) {\n                    column.search.search = \"\";\n                });\n                return data;\n            },\n            stateSave: true,\n            \"dom\": `<'d-flex w-100 justify-content-between`\n                + `'<'d-flex align-items-center'Bl>'<''f>>t<'row mt-2'<'col-sm-6'i><'col-sm-6'p>>`,\n            \"buttons\": [\n                {\n                    extend: \"copyHtml5\",\n                    text: '<i class=\"bi bi-copy fa-fw fs-unset\"></i>',\n                    className: \"btn btn-sm border-0\",\n                    messageTop: null,\n                    title: null,\n                    exportOptions: {\n                        columns: ['.exportable'],\n                        format: {\n                            body: function(data) {\n                                // Strip HTML tags to get text only\n                                const div = document.createElement(\"div\");\n                                div.innerHTML = data;\n                                return (div.textContent || div.innerText || \"\").trim();\n                            }\n                        }\n                    }\n                },\n                {\n                    extend: \"csvHtml5\",\n                    text: '<i class=\"bi bi-filetype-csv fa-fw fs-unset\"></i>',\n                    className: \"btn btn-sm border-0\",\n                    exportOptions: {\n                        columns: ['.exportable'],\n                        format: {\n                            body: function(data) {\n                                // Strip HTML tags to get text only\n                                const div = document.createElement(\"div\");\n                                div.innerHTML = data;\n                                return (div.textContent || div.innerText || \"\").trim();\n                            }\n                        }\n                    }\n                },\n                {\n                    extend: \"excelHtml5\",\n                    text: '<i class=\"bi bi-file-earmark-excel fa-fw fs-unset\"></i>',\n                    className: \"btn btn-sm border-0\",\n                    exportOptions: {\n                        columns: ['.exportable'],\n                        format: {\n                            body: function(data) {\n                                // Strip HTML tags to get text only\n                                const div = document.createElement(\"div\");\n                                div.innerHTML = data;\n                                return (div.textContent || div.innerText || \"\").trim();\n                            }\n                        }\n                    }\n                }\n            ],\n            \"initComplete\": function() {\n                $(\"table#completiontable\")\n                    .wrap(\"<div style='overflow:auto;position:relative' class='completiontablewrapper'></div>\");\n                $(\"#reporttable .dataTables_length \").addClass(\"d-inline ml-1\");\n                $(\"#reporttable .dataTables_filter\").addClass(\"d-inline float-right\");\n                $(\"#reporttable .table-responsive\").addClass(\"p-1\");\n                $(\"#reporttable .spinner-grow\").remove();\n                $(\"table#completiontable\").removeClass(\"d-none\");\n                $(\"#background-loading\").fadeOut(300);\n            }\n        };\n\n        $(\"#reporttable th.rotate\").each(function() {\n            const itemid = $(this).data(\"item\").toString();\n            const ctype = $(this).data(\"type\");\n            datatableOptions.columns.push({\n                data: null,\n                sortable: false,\n                className: \"text-center exportable\",\n                render: function(data, rtype, row) {\n                    let completiondetails;\n                    try {\n                        completiondetails = JSON.parse(data.completiondetails).map(x => JSON.parse(x));\n                    } catch (e) {\n                        completiondetails = [];\n                    }\n                    let details = completiondetails.find(x => Number(x.id) == Number(itemid));\n                    if (details) {\n                        return `<span class=\"completion-detail ${details.hasDetails ? 'cursor-pointer' : ''}\"\n                                 data-id=\"${itemid}\" data-userid=\"${row.id}\" data-type=\"${ctype}\">${details.reportView}</span>`;\n                    } else {\n                        return '-';\n                    }\n                },\n            });\n        });\n\n        tabledata = $('#completiontable').DataTable(datatableOptions);\n\n        initonreport.forEach((type) => {\n            let matchingContentTypes = contentTypes.find(x => x.name === type);\n            let amdmodule = matchingContentTypes.amdmodule;\n            require([amdmodule], function(Module) {\n                new Module(player, itemsdata, cmid, courseid, null,\n                    completionpercentage, null, grademax, videotype, null,\n                    end - start, start, end, null, cm).init();\n            });\n        });\n    });\n\n    $(document).on('click', '[data-item] a', function() {\n        const convertSecondsToHMS = (seconds) => {\n            const h = Math.floor(seconds / 3600);\n            const m = Math.floor(seconds % 3600 / 60);\n            const s = Math.floor(seconds % 3600 % 60);\n            return (h > 0 ? h + ':' : '') + (m < 10 ? '0' : '') + m + ':' + (s < 10 ? '0' : '') + s;\n        };\n        let annotationid = $(this).closest('th').data('item');\n        let theAnnotation = itemsdata.find(x => x.id == annotationid);\n        let tabledatajson = tabledata.rows().data().toArray();\n        let title = theAnnotation.formattedtitle;\n        if (theAnnotation.timestamp > 0) {\n            title += \" @ \" + convertSecondsToHMS(theAnnotation.timestamp);\n        }\n        const modal = `<div class=\"modal fade\" id=\"annotation-modal\" role=\"dialog\"\n            aria-labelledby=\"annotation-modal\"\n         aria-hidden=\"true\" data-backdrop=\"static\" data-keyboard=\"false\">\n         <div id=\"message\" data-id=\"${theAnnotation.id}\" data-placement=\"popup\"\n          class=\"modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable ${theAnnotation.type}\" role=\"document\">\n            <div class=\"modal-content rounded-lg\">\n                <div class=\"modal-header d-flex align-items-center shadow-sm\" id=\"title\">\n                    <h5 class=\"modal-title text-truncate mb-0\">${title}</h5>\n                    <div class=\"btns d-flex align-items-center\">\n                        <button class=\"btn close-modal p-0 border-0\" aria-label=\"Close\" data-dismiss=\"modal\">\n                        <i class=\"bi bi-x-lg fa-fw fs-25px\"></i>\n                        </button>\n                    </div>\n                </div>\n                <div class=\"modal-body\" id=\"content\">\n                <div class=\"loader w-100 mt-5\"></div>\n                </div>\n                </div>\n            </div>\n            </div>`;\n        $('body').append(modal);\n        $('#annotation-modal').modal('show');\n        $('#annotation-modal').on('hide.bs.modal', function() {\n            $('#annotation-modal').remove();\n        });\n\n        $('#annotation-modal').on('shown.bs.modal', function() {\n            $('#annotation-modal .modal-body').fadeIn(300);\n            let matchingContentTypes = contentTypes.find(x => x.name === theAnnotation.type);\n            let amdmodule = matchingContentTypes.amdmodule;\n            require([amdmodule], function(Module) {\n                theAnnotation.completed = true;\n                new Module(player, itemsdata, cmid, courseid, null,\n                    completionpercentage, null, grademax, videotype, null,\n                    end - start, start, end, theAnnotation.prop, cm).displayReportView(theAnnotation, tabledatajson, DataTable);\n            });\n            $(this).find('.close-modal').focus();\n        });\n    });\n\n    $(document).on('click', 'td .reset', function(e) {\n        e.preventDefault();\n        const recordid = $(this).data('record');\n        let $this = $(this);\n        try {\n            Notification.deleteCancelPromise(\n                M.util.get_string('deletecompletion', 'mod_interactivevideo'),\n                M.util.get_string('areyousureyouwanttoresetthecompletiondata', 'mod_interactivevideo'),\n                M.util.get_string('delete', 'mod_interactivevideo')\n            ).then(() => {\n                return $.ajax({\n                    url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                    method: 'POST',\n                    dataType: \"text\",\n                    data: {\n                        action: 'delete_progress_by_id',\n                        recordid,\n                        courseid: courseid,\n                        cmid: cmid,\n                        contextid: M.cfg.contextid,\n                        sesskey: M.cfg.sesskey,\n                    },\n                    success: function(response) {\n                        if (response == 'deleted') {\n                            let targetdata = tabledata.row($this.closest('tr')).data();\n                            targetdata.completionpercentage = 0;\n                            targetdata.timecompleted = 0;\n                            targetdata.xp = 0;\n                            targetdata.timecreated = 0;\n                            targetdata.completeditems = null;\n                            targetdata.completiondetails = null;\n                            targetdata.completionid = null;\n                            tabledata.row($this.closest('tr')).data(targetdata).draw();\n                            addToast(M.util.get_string('completionresetsuccess', 'mod_interactivevideo'), {\n                                type: 'success'\n                            });\n                        }\n                    },\n                    error: function() {\n                        addToast(M.util.get_string('completionreseterror', 'mod_interactivevideo'), {\n                            type: 'error'\n                        });\n                    }\n                });\n            }).catch(() => {\n                return;\n            });\n        } catch { // Fallback for older versions of Moodle.\n            Notification.saveCancel(\n                M.util.get_string('deletecompletion', 'mod_interactivevideo'),\n                M.util.get_string('areyousureyouwanttoresetthecompletiondata', 'mod_interactivevideo'),\n                M.util.get_string('delete', 'mod_interactivevideo'),\n                function() {\n                    return $.ajax({\n                        url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                        method: 'POST',\n                        dataType: \"text\",\n                        data: {\n                            action: 'delete_progress_by_id',\n                            recordid,\n                            courseid: courseid,\n                            cmid: cmid,\n                            contextid: M.cfg.contextid,\n                            sesskey: M.cfg.sesskey,\n                        },\n                        success: function(response) {\n                            if (response == 'deleted') {\n                                let targetdata = tabledata.row($this.closest('tr')).data();\n                                targetdata.completionpercentage = 0;\n                                targetdata.timecompleted = 0;\n                                targetdata.xp = 0;\n                                targetdata.timecreated = 0;\n                                targetdata.completeditems = null;\n                                targetdata.completiondetails = null;\n                                targetdata.completionid = null;\n                                tabledata.row($this.closest('tr')).data(targetdata).draw();\n                                addToast(M.util.get_string('completionresetsuccess', 'mod_interactivevideo'), {\n                                    type: 'success'\n                                });\n                            }\n                        },\n                        error: function() {\n                            addToast(M.util.get_string('completionreseterror', 'mod_interactivevideo'), {\n                                type: 'error'\n                            });\n                        }\n                    });\n                }\n            );\n        }\n    });\n\n    $(document).on('click', 'td .completion-detail', function() {\n        let id = $(this).data('id');\n        let userid = $(this).data('userid');\n        let type = $(this).data('type');\n        let matchingContentTypes = contentTypes.find(x => x.name === type);\n        let amdmodule = matchingContentTypes.amdmodule;\n        // Get column header with the item id.\n        let theAnnotation = itemsdata.find(x => x.id == id);\n        require([amdmodule], function(Module) {\n            new Module(player, itemsdata, cmid, courseid, null,\n                completionpercentage, null, grademax, videotype, null,\n                end - start, start, end, theAnnotation.prop, cm).getCompletionData(theAnnotation, userid);\n        });\n    });\n};\n\n\n/**\n * Renders annotation logs in a DataTable with specified options.\n *\n * @param {Object} data - The data to be displayed in the table.\n * @param {Array} data.rows - The rows of data to be displayed.\n * @param {string} node - The DOM node selector where the table will be rendered.\n * @param {string} title - The title used for export options.\n */\nconst renderAnnotationLogs = (data, node, title) => {\n    let tableOptions = {\n        \"data\": data.rows,\n        \"deferRender\": true,\n        \"pageLength\": 25,\n        \"order\": [[0, \"asc\"]],\n        \"columnDefs\": [\n            {\n                \"targets\": 'not-sortable',\n                \"sortable\": false,\n            },\n        ],\n        \"language\": {\n            \"lengthMenu\": \"_MENU_\",\n            \"zeroRecords\": M.util.get_string('nofound', \"mod_interactivevideo\"),\n            \"search\": M.util.get_string('search', \"mod_interactivevideo\"),\n            \"info\": M.util.get_string('datatableinfo', \"mod_interactivevideo\"),\n            \"infoEmpty\": M.util.get_string('datatableinfoempty', \"mod_interactivevideo\"),\n            \"infoFiltered\": M.util.get_string('datatableinfofiltered', \"mod_interactivevideo\"),\n            \"paginate\": {\n                \"first\": M.util.get_string('first', 'mod_interactivevideo'),\n                \"last\": M.util.get_string('last', 'mod_interactivevideo'),\n                \"next\": M.util.get_string('next', 'mod_interactivevideo'),\n                \"previous\": M.util.get_string('previous', 'mod_interactivevideo')\n            }\n        },\n        stateSaveParams: function(settings, data) {\n            // We only want to save the state of the colvis and length menu\n            data.search.search = \"\";\n            data.start = 0;\n            data.columns.forEach(function(column) {\n                column.search.search = \"\";\n            });\n            return data;\n        },\n        stateSave: true,\n        \"dom\": `Blft<'row'<'col-sm-6'i><'col-sm-6'p>>`,\n        \"buttons\": [\n            {\n                extend: \"copyHtml5\",\n                text: '<i class=\"bi bi-copy fa-fw fs-unset\"></i>',\n                className: \"btn btn-sm border-0\",\n                messageTop: null,\n                title: null,\n                exportOptions: {\n                    columns: ['.exportable']\n                }\n            },\n            {\n                extend: \"csvHtml5\",\n                text: '<i class=\"bi bi-filetype-csv fa-fw fs-unset\"></i>',\n                title: title,\n                className: \"btn btn-sm border-0\",\n                exportOptions: {\n                    columns: ['.exportable']\n                }\n            },\n            {\n                extend: \"excelHtml5\",\n                text: '<i class=\"bi bi-file-earmark-excel fa-fw fs-unset\"></i>',\n                className: \"btn btn-sm border-0\",\n                title: title,\n                exportOptions: {\n                    columns: ['.exportable']\n                }\n            }\n        ],\n        \"initComplete\": function() {\n            $(`${node} table`)\n                .wrap(\"<div style='overflow:auto;position:relative' class='completiontablewrapper'></div>\");\n            $(`${node} .dataTables_length`).addClass(\"d-inline ml-1\");\n            $(`${node} .dataTables_filter`).addClass(\"d-inline float-right\");\n            $(`${node} .table-responsive`).addClass(\"p-1\");\n        }\n    };\n\n    $(`${node} table`).DataTable(tableOptions);\n};\n\nexport {\n    init,\n    renderAnnotationLogs\n};"],"names":["cmid","groupid","grademax","itemids","completionpercentage","videourl","videotype","cm","courseid","start","end","access","window","JSZip","DataTable","$","fn","dataTable","getContentTypes","ajax","url","M","cfg","wwwroot","method","dataType","data","action","sesskey","contextid","getReportData","ctxid","courseContextId","itemsdata","text","JSON","parse","contentTypes","tabledata","initonreport","filter","x","prop","Set","map","type","when","done","async","ct","datatableOptions","visible","render","row","deletebutton","canedit","util","get_string","completionid","id","replace","timecreated","className","date","Date","toLocaleString","getTime","stateSaveParams","settings","search","columns","forEach","column","stateSave","extend","messageTop","title","exportOptions","format","body","div","document","createElement","innerHTML","textContent","innerText","trim","wrap","addClass","remove","removeClass","fadeOut","each","itemid","this","toString","ctype","push","sortable","rtype","completiondetails","e","details","find","Number","hasDetails","reportView","amdmodule","name","require","Module","player","init","on","annotationid","closest","theAnnotation","tabledatajson","rows","toArray","formattedtitle","timestamp","seconds","h","Math","floor","m","s","convertSecondsToHMS","modal","append","fadeIn","completed","displayReportView","focus","preventDefault","recordid","$this","deleteCancelPromise","then","success","response","targetdata","timecompleted","xp","completeditems","draw","error","catch","saveCancel","userid","getCompletionData","node","tableOptions"],"mappings":"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"}