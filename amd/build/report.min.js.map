{"version":3,"file":"report.min.js","sources":["../src/report.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Handle report page\n *\n * @module     mod_interactivevideo/report\n * @copyright  2024 Sokunthearith Makara <sokunthearithmakara@gmail.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport $ from 'jquery';\nimport Notification from 'core/notification';\nimport {add as addToast} from 'core/toast';\nimport JSZip from './libraries/jszip';\nimport './libraries/jquery.dataTables';\nimport './libraries/dataTables.bootstrap4';\nimport './libraries/dataTables.buttons';\nimport './libraries/buttons.bootstrap4';\nimport './libraries/buttons.html5';\nimport './libraries/buttons.colVis';\nimport './libraries/dataTables.select';\nimport './libraries/select.bootstrap4';\nimport './libraries/select2';\nimport quickform from './quickform';\nimport ModalEvents from 'core/modal_events';\n\n/**\n * Initializes the report functionality for the interactive video module.\n *\n * @param {number} cmid - The course module ID.\n * @param {number} groupid - The group ID.\n * @param {number} grademax - The maximum grade.\n * @param {Array} itemids - The annotation IDs.\n * @param {number} completionpercentage - The completion percentage.\n * @param {string} videourl - The video URL.\n * @param {string} videotype - The video type.\n * @param {Object} cm - The course module object.\n * @param {number} courseid - The course ID.\n * @param {number} start - The start time.\n * @param {number} end - The end time.\n * @param {string} posterimage - The poster image.\n * @param {string} name - The name of the activity.\n * @param {Object} access - The access object.\n */\nconst init = async(cmid, groupid, grademax, itemids, completionpercentage, videourl, videotype, cm, courseid, start, end,\n    posterimage, name, access) => {\n    window.JSZip = JSZip;\n    let DataTable = $.fn.dataTable;\n    let player;\n    const isBS5 = $('body').hasClass('bs-5');\n    // Const bsAffix = isBS5 ? '-bs' : '';\n    let ModalFactory;\n    try {\n        ModalFactory = await import('core/modal_factory');\n    } catch (error) {\n        ModalFactory = await import('core/modal');\n    }\n\n    quickform();\n\n    require(['theme_boost/bootstrap/tooltip']);\n\n    $('#background-loading').show();\n\n    const getReportData = $.ajax({\n        url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n        method: 'POST',\n        data: {\n            action: 'get_report_data_by_group',\n            cmid: cmid,\n            sesskey: M.cfg.sesskey,\n            contextid: M.cfg.contextid,\n            ctxid: M.cfg.courseContextId,\n            courseid: courseid,\n            groupid: groupid,\n        }\n    });\n\n    let itemsdata = $('#itemsdata').text();\n    itemsdata = JSON.parse(itemsdata);\n    // Init the contenttypes that has initonreport.\n    let initonreport = itemsdata.filter(x => JSON.parse(x.prop).initonreport);\n    initonreport = [...new Set(initonreport.map(x => x.type))];\n\n    let contentTypes;\n    let relContentTypeAmd = {};\n    let tabledata;\n\n    $.when(getReportData).done(async(data) => {\n        contentTypes = itemsdata.map(x => JSON.parse(x.prop));\n        // Unique content types based on name.\n        contentTypes = contentTypes.filter((value, index, self) =>\n            index === self.findIndex((t) => (\n                t.name === value.name && t.type === value.type\n            ))\n        );\n        // Require[] all AMD modules that are used in the report.\n        const loadPromises = contentTypes.map(contentType => {\n            return new Promise((resolve) => {\n                require([contentType.amdmodule], (Module) => {\n                    relContentTypeAmd[contentType.name] = new Module(player, itemsdata, cmid, courseid, null,\n                        completionpercentage, null, grademax, videotype, null,\n                        end - start, start, end, contentType, cm, null, {}, null, null, {\n                        url: videourl,\n                        posterimage,\n                        name,\n                    });\n                    resolve();\n                });\n            });\n        });\n\n        await Promise.all(loadPromises);\n\n        const renderFilterBox = (element) => {\n            let input = '';\n            switch (element.type) {\n                case 'text':\n                case 'textarea':\n                case 'url':\n                case 'email':\n                    input = `<input type=\"text\" class=\"form-control form-control-sm\" id=\"filter-${element.index}\"\n                         data-index=\"${element.index}\"/>`;\n                    break;\n                case 'menu':\n                    var options = data.map(x => x[element.name]);\n                    options = [...new Set(options)];\n                    // Don't include empty options.\n                    options = options.filter(x => x !== '');\n                    if (options.length > 1) {\n                        options.sort();\n                        input = `<select class=\"${isBS5 ? 'form' : 'custom'}-select ${isBS5 ? 'form' : 'custom'}-select-sm w-100\"\n                         multiple id=\"filter-${element.index}\"\n                         data-index=\"${element.index}\">\n                            ${options.map(x => `<option value=\"${x}\">${x}</option>`).join('')}\n                        </select>`;\n                    } else {\n                        input = `<input type=\"text\" class=\"form-control form-control-sm\" id=\"filter-${element.index}\"\n                         data-index=\"${element.index}\"/>`;\n                    }\n                    break;\n                case 'checkbox':\n                    var optionsc = data.map(x => x[element.name]);\n                    optionsc = [...new Set(optionsc)];\n                    // Don't include empty options.\n                    optionsc = optionsc.filter(x => x !== '');\n                    if (optionsc.length > 1) {\n                        optionsc.sort();\n                        input = `<select class=\"${isBS5 ? 'form' : 'custom'}-select ${isBS5 ? 'form' : 'custom'}-sm w-100\"\n                         multiple id=\"filter-${element.index}\"\n                         data-index=\"${element.index}\">\n                            ${optionsc.map(x => `<option value=\"${x}\">${x}</option>`).join('')}\n                        </select>`;\n                    } else {\n                        input = `<input type=\"text\" class=\"form-control form-control-sm\" id=\"filter-${element.index}\"\n                         data-index=\"${element.index}\"/>`;\n                    }\n                    break;\n                case 'datetime':\n                    // Date range.\n                    input = `<div class=\"input-group input-group-sm\">\n                            <input type=\"date\" class=\"form-control custom-field\" data-index=\"${element.index}\"\n                             id=\"filter-${element.index}-start\"/>\n                            <input type=\"date\" class=\"form-control custom-field\" data-index=\"${element.index}\"\n                             id=\"filter-${element.index}-end\"/>\n                        </div>`;\n                    break;\n                default:\n                    input = `<input type=\"text\" class=\"form-control form-control-sm\" id=\"filter-${element.index}\"\n                         data-index=\"${element.index}\"/>`;\n                    break;\n            }\n            return `<div class=\"col-sm-6 col-md-4 col-lg-3 col-xl-${element.type == 'datetime' ? '4' : '2'} iv-pl-0 iv-pr-2 mb-2\">\n                                    <div class=\"iv-form-group mb-1\">\n                                    <label for=\"filter-${element.index}\">${element.text}</label>\n                                        ${input}\n                                    </div>\n                                </div>`;\n        };\n        const hasCompletion = data.some(x => x.timecreated > 0);\n        let profileFields = [];\n        let customProfileFields = data.map(x => x.customfields);\n        // Combine all custom profile fields and remove duplicates.\n        customProfileFields = customProfileFields.reduce((acc, val) => {\n            return acc.concat(val);\n        }, []);\n        customProfileFields = [...new Set(customProfileFields)];\n        // Remove the undefined values.\n        customProfileFields = customProfileFields.filter(x => x !== undefined);\n        $(\"#completiontable th.profilefield\").each(function() {\n            const pr = {\n                index: $(\"th\").index($(this)),\n                text: $(this).text(),\n                name: $(this).attr('id'),\n                type: 'text'\n            };\n            if (customProfileFields && customProfileFields.length > 0) {\n                const customField = customProfileFields.find(x => x.shortname === pr.name.replace('profile_field_', ''));\n                if (customField) {\n                    pr.type = customField.type;\n                }\n            }\n            profileFields.push(pr);\n        });\n\n        let exportOptions = {\n            columns: ['.exportable'],\n            format: {\n                body: function(data) {\n                    // Strip HTML tags to get text only\n                    const div = document.createElement(\"div\");\n                    div.innerHTML = data;\n                    return (div.textContent || div.innerText || \"\").trim();\n                },\n                header: function(data) {\n                    const div = document.createElement(\"div\");\n                    div.innerHTML = data;\n                    // Remove .controls from the header.\n                    if (div.querySelector('.controls')) {\n                        div.querySelector('.controls').remove();\n                    }\n                    return (div.textContent || div.innerText || \"\").trim();\n                }\n            }\n        };\n\n        let columns = [\n            {\n                data: \"id\",\n                visible: false,\n                className: \"exportable inv d-none\",\n            },\n            {\n                data: \"picture\",\n                render: function(data, type, row) {\n                    if (type === 'sort') {\n                        return row.fullname;\n                    }\n                    let deletebutton = '';\n                    if (access.canedit == 1) {\n                        deletebutton = `<button title=\"${M.util.get_string('reset', 'mod_interactivevideo')}\"\n                 class=\"btn border-0 btn-sm text-danger reset m-1\" data-record=\"${row.completionid}\"\n                  data-userid=\"${row.id}\">\n                 <i class=\"bi bi-trash3\"></i></button>`;\n                    }\n                    // Put _target=blank to open the user profile in a new tab (use regex)\n                    data = data.replace(/<a /g, '<a target=\"_blank\" ');\n                    return `<div class=\"d-flex align-items-center\">\n                    ${access.canedit == 1 ? `<input class=\"iv-mr-3 bulk\" type=\"checkbox\"\n                         data-record=\"${row.completionid}\" ${row.timecreated > 0 ? '' : 'disabled'}\n                         data-userid=\"${row.id}\"/>` : ''}\n                    <div class=\"text-truncate d-flex align-items-center justify-content-between flex-grow-1\">${data}\n                ${row.timecreated > 0 ? deletebutton : ''}</div></div>`;\n                },\n                className: \"bg-white sticky-left-0\",\n            },\n        ];\n\n        let $identitycolumn = $('#reporttable th.profilefield');\n        if ($identitycolumn.length > 0) {\n            $identitycolumn.each(function() {\n                let $this = $(this);\n                columns.push({\n                    data: $(this).attr('id'),\n                    render: function(data, type, row) {\n                        if (!row.customfields) {\n                            return data;\n                        }\n                        let fieldtype = row.customfields.find(x => x.shortname === $this.attr('id')\n                            .replace('profile_field_', ''));\n                        if (!fieldtype) {\n                            return data;\n                        }\n                        if (fieldtype.type === 'datetime' && (type == 'sort' || type == 'filter')) {\n                            return fieldtype.value;\n                        }\n                        return data;\n                    },\n                });\n            });\n        }\n\n        columns = columns.concat([\n            {\n                data: \"timecreated\",\n                \"render\": function(data, type) {\n                    if (!data || data == 0) {\n                        if (type === 'display') {\n                            return '';\n                        } else {\n                            return 0;\n                        }\n                    } else {\n                        const date = new Date(data * 1000);\n                        if (type === 'display') {\n                            return date.toLocaleString();\n                        } else if (type === 'filter' || type === 'sort') {\n                            return date.getTime();\n                        }\n                        return data;\n                    }\n                },\n                className: \"exportable timecreated\"\n            },\n            {\n                data: \"timecompleted\",\n                render: function(data, type, row) {\n                    if (!data || data == 0) {\n                        if (!row.timecreated) {\n                            if (type === 'display') {\n                                return '';\n                            } else {\n                                return 0;\n                            }\n                        } else {\n                            if (type === 'display') {\n                                return M.util.get_string('inprogress', 'mod_interactivevideo');\n                            } else {\n                                return 0;\n                            }\n                        }\n                    } else {\n                        const date = new Date(data * 1000);\n                        if (type === 'display') {\n                            return date.toLocaleString();\n                        } else if (type === 'filter' || type === 'sort') {\n                            return date.getTime();\n                        }\n                        return data;\n                    }\n                },\n                className: \"exportable\" + (itemids.length == 0 ? \" inv d-none\" : \"\")\n            },\n            {\n                data: \"completionpercentage\",\n                render: function(data, type) {\n                    if (data) {\n                        return data + \"%\";\n                    } else {\n                        if (type === 'display') {\n                            return \"\";\n                        }\n                        return 0;\n                    }\n                },\n                className: \"exportable\" + (itemids.length == 0 ? \" inv d-none\" : \"\")\n            },\n            {\n                data: \"xp\",\n                render: function(data) {\n                    if (data) {\n                        return data;\n                    } else {\n                        return \"\";\n                    }\n                },\n                className: \"exportable\" + (itemids.length == 0 ? \" inv d-none\" : \"\")\n            }\n        ]);\n\n        let datatableOptions = {\n            \"data\": data,\n            \"deferRender\": true,\n            \"rowId\": \"id\",\n            \"pageLength\": 25,\n            // Sort by timecreated in descending order by default and then by fullname in ascending order.\n            \"order\": [[columns.findIndex(c => c.data == 'timecreated'), 'desc'], [1, 'asc']],\n            \"columns\": columns,\n            \"columnDefs\": [\n                {\n                    \"targets\": 'not-sortable',\n                    \"sortable\": false,\n                },\n                {\n                    \"targets\": 'inv',\n                    \"visible\": false,\n                },\n                {\n                    \"targets\": 'colvis',\n                    \"visible\": false,\n                }\n            ],\n            \"pagingType\": \"full\",\n            \"language\": {\n                \"lengthMenu\": \"_MENU_\",\n                \"zeroRecords\": M.util.get_string('nofound', \"mod_interactivevideo\"),\n                \"search\": `<span class=\"d-none d-md-inline\">${M.util.get_string('search', \"mod_interactivevideo\")}</span>`,\n                \"info\": M.util.get_string('datatableinfo', \"mod_interactivevideo\"),\n                \"infoEmpty\": M.util.get_string('datatableinfoempty', \"mod_interactivevideo\"),\n                \"infoFiltered\": M.util.get_string('datatableinfofiltered', \"mod_interactivevideo\"),\n                \"paginate\": {\n                    \"first\": '<i class=\"bi bi-chevron-double-left fs-unset\"></i>',\n                    \"last\": '<i class=\"bi bi-chevron-double-right fs-unset\"></i>',\n                    \"next\": '<i class=\"bi bi-chevron-right fs-unset\"></i>',\n                    \"previous\": '<i class=\"bi bi-chevron-left fs-unset\"></i>'\n                },\n                \"select\": {\n                    rows: {\n                        _: M.util.get_string('rowsselected', 'mod_interactivevideo'),\n                    }\n                }\n            },\n            select: {\n                style: 'multi',\n                selector: 'input[type=\"checkbox\"].bulk',\n            },\n            stateSaveParams: function(settings, data) {\n                // We only want to save the state of the colvis and length menu\n                data.search.search = \"\";\n                data.start = 0;\n                data.columns.forEach(function(column) {\n                    column.search.search = \"\";\n                });\n                // Reset the inv columns.\n                data.columns.forEach(function(column) {\n                    if (column.visible === false) {\n                        column.visible = true;\n                    }\n                });\n                return data;\n            },\n            stateSave: true,\n            \"dom\": `<'d-flex w-100 justify-content-between`\n                + `'<'d-flex align-items-center'Bl>'<''f>>`\n                + `<'#filterregion.w-100 row mx-0 my-2 p-3 bg-light iv-rounded border'>t<'row mt-2'<'col-sm-6'i><'col-sm-6'p>>`,\n            \"buttons\": [\n                {\n                    extend: \"copyHtml5\",\n                    text: '<i class=\"bi bi-copy fa-fw fs-unset\"></i>',\n                    className: \"btn btn-sm border-0\",\n                    messageTop: null,\n                    title: null,\n                    exportOptions: exportOptions\n                },\n                {\n                    extend: \"csvHtml5\",\n                    text: '<i class=\"bi bi-filetype-csv fa-fw fs-unset\"></i>',\n                    className: \"btn btn-sm border-0\",\n                    exportOptions: exportOptions\n                },\n                {\n                    extend: \"excelHtml5\",\n                    text: '<i class=\"bi bi-file-earmark-excel fa-fw fs-unset\"></i>',\n                    className: \"btn btn-sm border-0\",\n                    exportOptions: exportOptions\n                },\n                {\n                    extend: \"colvis\",\n                    text: '<i class=\"bi bi-layout-three-columns fa-fw fs-unset\"></i>',\n                    titleAttr: \"\",\n                    className: \"btn btn-sm border-0\",\n                    columns: '.colvis'\n                },\n            ],\n            // New footerCallback to update footer with summary info\n            footerCallback: function() {\n                var api = this.api();\n                var rowCount = api.rows({filter: 'applied'}).count();\n                // Helper: find index of a column by its data property in our original columns array\n                /**\n                 * Find the index of the column in the original columns array.\n                 * @param {string} prop - The data property of the column.\n                 * @returns {number} - The index of the column in the original columns array.\n                 */\n                function findColIndex(prop) {\n                    return columns.findIndex(function(col) {\n                        return col.data === prop;\n                    });\n                }\n                var timecreatedIdx = findColIndex('timecreated');\n                var timecompletedIdx = findColIndex('timecompleted');\n                var completionpercentageIdx = findColIndex('completionpercentage');\n                var xpIdx = findColIndex('xp');\n\n                // Calculate percentage for timecreated > 0\n                var timecreatedData = api.column(timecreatedIdx, {filter: 'applied'}).data();\n                var countTimecreated = timecreatedData.reduce(function(acc, val) {\n                    return acc + ((val && val > 0) ? 1 : 0);\n                }, 0);\n                var timecreatedPerc = ((countTimecreated / rowCount) * 100).toFixed(1) + '%';\n                if (rowCount === 0) {\n                    timecreatedPerc = '0%';\n                }\n\n                // Calculate percentage for timecompleted > 0\n                var timecompletedData = api.column(timecompletedIdx, {filter: 'applied'}).data();\n                var countTimecompleted = timecompletedData.reduce(function(acc, val) {\n                    return acc + ((val && val > 0) ? 1 : 0);\n                }, 0);\n                var timecompletedPerc = ((countTimecompleted / rowCount) * 100).toFixed(1) + '%';\n                if (rowCount === 0) {\n                    timecompletedPerc = '0%';\n                }\n\n                // Average xp\n                var xpData = api.column(xpIdx, {filter: 'applied'}).data().toArray();\n                xpData = xpData.map(x => parseFloat(x) || 0);\n                var minXP = Math.min(...xpData);\n                var maxXP = Math.max(...xpData);\n                var sumXp = xpData.reduce(function(acc, val) {\n                    return acc + val;\n                }, 0);\n                var avgXp = (sumXp / rowCount).toFixed(1);\n                if (rowCount === 0) {\n                    avgXp = '0';\n                    minXP = '0';\n                    maxXP = '0';\n                }\n\n                // Average completion percentage\n                var cpData = api.column(completionpercentageIdx, {filter: 'applied'}).data().toArray();\n                cpData = cpData.map(x => parseFloat(x) || 0);\n                var minCp = Math.min(...cpData);\n                var maxCp = Math.max(...cpData);\n                var sumCp = cpData.reduce(function(acc, val) {\n                    return acc + val;\n                }, 0);\n                var avgCp = (sumCp / rowCount).toFixed(1) + '%';\n                if (rowCount === 0) {\n                    avgCp = '0%';\n                    minCp = '0';\n                    maxCp = '0';\n                }\n\n                // Update footer for these specific columns\n                if (api.column(timecreatedIdx).footer()) {\n                    api.column(timecreatedIdx).footer().innerHTML = '<small>' + M.util.get_string('started', 'mod_interactivevideo')\n                        + '</small>' + '<br>' + timecreatedPerc + ' (' + countTimecreated + '/' + rowCount + ')';\n                }\n                if (api.column(timecompletedIdx).footer()) {\n                    api.column(timecompletedIdx).footer().innerHTML = '<small>'\n                        + M.util.get_string('completed', 'mod_interactivevideo')\n                        + '</small>' + '<br>' + timecompletedPerc + ' (' + countTimecompleted + '/' + rowCount + ')';\n                }\n                if (api.column(xpIdx).footer()) {\n                    api.column(xpIdx).footer().innerHTML = '<small>' + M.util.get_string('avg', 'mod_interactivevideo')\n                        + ' (' + M.util.get_string('min', 'mod_interactivevideo') + '/' +\n                        M.util.get_string('max', 'mod_interactivevideo')\n                        + ')</small>' + '<br>' + avgXp + ' (' + minXP + '/' + maxXP + ')';\n                }\n                if (api.column(completionpercentageIdx).footer()) {\n                    api.column(completionpercentageIdx).footer().innerHTML\n                        = '<small>' + M.util.get_string('avg', 'mod_interactivevideo')\n                        + ' (' + M.util.get_string('min', 'mod_interactivevideo') + '/' +\n                        M.util.get_string('max', 'mod_interactivevideo')\n                        + ')</small>' + '<br>' + avgCp + ' (' + minCp + '/' + maxCp + ')';\n                }\n\n                // For dynamic interaction item columns: check header attribute 'data-item'.\n                columns.forEach(function(column) {\n                    if (column.itemid) {\n                        var itemid = column.itemid;\n                        var itemIdx = columns.findIndex(col => col.itemid === itemid);\n                        var itemData = api.column(itemIdx, {filter: 'applied'}).data();\n                        var countItem = itemData.reduce(function(acc, val) {\n                            let completiondetails;\n                            try {\n                                completiondetails = JSON.parse(val.completiondetails).map(x => JSON.parse(x));\n                            } catch (e) {\n                                return acc;\n                            }\n                            let details = completiondetails.find(x => Number(x.id) == Number(itemid));\n                            if (details) {\n                                if (details.deleted) {\n                                    return acc;\n                                }\n                                return acc + 1;\n                            }\n                            return acc;\n                        }, 0);\n                        var itemPerc = ((countItem / rowCount) * 100).toFixed(1) + '%';\n                        if (rowCount === 0) {\n                            itemPerc = '0%';\n                        }\n                        if (api.column(itemIdx).footer()) {\n                            api.column(itemIdx).footer().innerHTML = itemPerc;\n                        }\n                    }\n                });\n            },\n            // Modified initComplete to add a tfoot if missing\n            \"initComplete\": function() {\n                let $reportTable = $('#reporttable');\n                if (hasCompletion) {\n                    $reportTable.find('th .controls').removeClass(\"d-none\");\n                }\n                if (itemids.length == 0) {\n                    $reportTable.find('th .controls').addClass(\"d-none\");\n                }\n                $reportTable.find(\"table#completiontable\")\n                    .wrap(\"<div style='overflow:auto;position:relative' class='completiontablewrapper my-2'></div>\");\n                $reportTable.find('.dataTables_length').addClass(\"d-inline iv-ml-1\");\n                $reportTable.find(\".dataTables_filter\").addClass(\"d-inline iv-float-right\");\n                $reportTable.find(\".table-responsive\").addClass(\"p-1\");\n                $reportTable.find(\".spinner-grow\").remove();\n                $reportTable.find(\"table#completiontable\").removeClass(\"invisible\");\n                $reportTable.find(\"#background-loading\").fadeOut(300);\n\n                $(`<a class=\"btn btn-sm btn-secondary iv-font-weight-bold iv-ml-1 d-inline-block\"\n                    href=\"javascript:void(0)\" id=\"filters\"\n                    title=\"Filter\"><i class=\"bi bi-funnel left fa-fw fs-unset\"></i></a>`).insertAfter(\".dataTables_filter label\");\n                $(document).off('click', '#filters').on('click', '#filters', function() {\n                    $('#filterregion').slideToggle('fast', 'swing');\n                    $(this).find('i').toggleClass('bi-funnel bi-funnel-fill');\n                });\n                $reportTable.find('#filterregion').hide();\n\n                profileFields.forEach((element) => {\n                    $(renderFilterBox(element)).appendTo(\"#filterregion\");\n                });\n\n                // Init select2\n                $(`#filterregion .${isBS5 ? 'form' : 'custom'}-select[multiple]`).select2({\n                    dropdownParent: $('body'), // Little hack to prevent page overflow when select2 is open\n                    width: '100%',\n                    placeholder: M.util.get_string('select', 'mod_interactivevideo'),\n                    allowClear: true,\n                });\n                $(`.${isBS5 ? 'form' : 'custom'}-select`)\n                    .on('select2:open', function(e) { // Little hack to prevent page overflow when select2 is open\n                        const evt = \"scroll.select2\";\n                        $(e.target).parents().off(evt);\n                        $(window).off(evt);\n                    });\n\n                // Date range for timecreated.\n                $reportTable.find(\"#filterregion\").append(`<div class=\"col-sm-6 col-md-4 col-lg-3 col-xl-4 iv-pl-0 iv-pr-2 mb-2\">\n                    <div class=\"iv-form-group mb-1\" id=\"timecreatedrange\">\n                    <label for=\"timecreatedrange\">${M.util.get_string('timecreatedrange', 'mod_interactivevideo')}</label>\n                    <div class=\"input-group input-group-sm\">\n                        <input type=\"date\" class=\"form-control\" id=\"timecreatedstart\"/>\n                        <input type=\"date\" class=\"form-control\" id=\"timecreatedend\"/>\n                    </div>\n                    </div>\n                </div>\n                <div class=\"col-sm-6 col-md-4 col-lg-3 col-xl-4 iv-pl-0 iv-pr-2 mb-2\">\n                    <div class=\"iv-form-group mb-1\" id=\"timecompletedrange\">\n                    <label for=\"timecompletedrange\">${M.util.get_string('timecompletedrange', 'mod_interactivevideo')}</label>\n                    <div class=\"input-group input-group-sm\">\n                        <input type=\"date\" class=\"form-control\" id=\"timecompletedstart\"/>\n                        <input type=\"date\" class=\"form-control\" id=\"timecompletedend\"/>\n                    </div>\n                    </div>\n                </div>\n                `);\n\n                $reportTable.find(\"#filterregion\").append(`<div class=\"col-12 p-0 mx-0\">\n                    <span class=\"text-muted small\">${M.util.get_string('separatesearchtermsbyslash', 'mod_interactivevideo')}</span>\n                    </div>`);\n                $reportTable.find(`table [data${isBS5 ? '-bs' : ''}-toggle=\"tooltip\"]`).tooltip();\n                if (isBS5) {\n                    $('.custom-select').toggleClass('custom-select form-select');\n                }\n            }\n            // ...existing datatableOptions properties if any\n        };\n\n        $(\"#reporttable th.rotate\").each(function() {\n            const itemid = $(this).data(\"item\").toString();\n            const ctype = $(this).data(\"type\");\n            datatableOptions.columns.push({\n                data: null,\n                itemid: itemid,\n                sortable: false,\n                className: \"text-center exportable data-cell\",\n                render: function(data, rtype, row) {\n                    let completiondetails;\n                    try {\n                        completiondetails = JSON.parse(data.completiondetails).map(x => JSON.parse(x));\n                    } catch (e) {\n                        completiondetails = [];\n                    }\n                    let details = completiondetails.find(x => Number(x.id) == Number(itemid));\n                    if (details) {\n                        if (details.deleted) {\n                            if (rtype === 'display') {\n                                return `<i class=\"bi bi-trash3 text-muted\"\n                             title=\"${M.util.get_string('deletedbyinstructor', 'mod_interactivevideo')}\"></i>`;\n                            } else {\n                                return '-';\n                            }\n                        }\n                        // Convert tooltip bs4 to bs5 for reportView.\n                        if (isBS5) {\n                            details.reportView = details.reportView.replace(/data-toggle=\"tooltip\"/g, 'data-bs-toggle=\"tooltip\"');\n                            details.reportView = details.reportView.replace(/data-original-title/g, 'data-bs-original-title');\n                            details.reportView = details.reportView.replace(/data-title/g, 'title');\n                            details.reportView = details.reportView.replace(/data-placement/g, 'data-bs-placement');\n                            details.reportView = details.reportView.replace(/data-html/g, 'data-bs-html');\n                        }\n                        let module = relContentTypeAmd[ctype];\n                        let reportView = details.reportView;\n                        let res = '';\n                        if (module) {\n                            let theAnnotation = itemsdata.find(x => x.id == itemid);\n                            res = module.renderReportView(theAnnotation, details, {\n                                access: access,\n                                itemid: itemid,\n                                ctype: ctype,\n                                row: row,\n                                data: data,\n                            });\n                        } else {\n                            res = `<span class=\"completion-detail ${details.hasDetails ? 'cursor-pointer' : ''}\"\n                                 data-id=\"${itemid}\" data-userid=\"${row.id}\" data-type=\"${ctype}\">${reportView}</span>`;\n                            if (access.canedit == 1) {\n                                res += `<i class=\"bi bi-trash3 fs-unset text-danger cursor-pointer position-absolute delete-cell\"\n                                  title=\"${M.util.get_string('delete', 'mod_interactivevideo')}\"></i>`;\n                            }\n                        }\n                        return res;\n                    } else {\n                        return '-';\n                    }\n                },\n                \"createdCell\": function(td) {\n                    $(td).attr(\"data-item\", itemid);\n                    $(td).attr(\"data-type\", ctype);\n                },\n            });\n        });\n\n        // Create the footer for the table.\n        let $tfoot = $('<tfoot></tfoot>');\n        let $tr = $('<tr></tr>');\n        columns.forEach(function(column) {\n            let $td = $('<td></td>');\n            if (column.data) {\n                $td.attr('id', column.data);\n            }\n            if (column.itemid) {\n                $td.attr('data-item', column.itemid);\n            }\n            $tr.append($td);\n        });\n        $tfoot.append($tr);\n        $('#completiontable').append($tfoot);\n\n        tabledata = $('#completiontable').DataTable(datatableOptions);\n\n        // Handle select.\n        tabledata.on(\"draw\", function() {\n            $('tr.selected td.checkbox input').prop(\"checked\", true);\n            $('tr:not(.selected) td.checkbox input').prop(\"checked\", false);\n        });\n\n        tabledata.on(\"search\", function() {\n            // De-select all rows\n            tabledata.rows().deselect();\n        });\n\n        tabledata.on(\"select deselect\", function(e) {\n            e.stopImmediatePropagation();\n            // Change the checkbox state\n            var selectedRows = tabledata.rows({selected: true});\n            // For each selected row, find the checkbox with class \"checked\" in the first column and check it\n            selectedRows.every(function() {\n                var row = this.node();\n                $(row).find(\"td:first-child input\").prop(\"checked\", true);\n                return true;\n            });\n\n            var deselectedRows = tabledata.rows({selected: false});\n            // For each deselected row, find the checkbox with class \"checked\" in the first column and uncheck it\n            deselectedRows.every(function() {\n                var row = this.node();\n                $(row).find(\"td:first-child input\").prop(\"checked\", false);\n                return true;\n            });\n\n            // Allow 20 rows to be selected at once.\n            $('#bulkactions').remove();\n\n            if (selectedRows.count() > 0 && selectedRows.count() <= 20) {\n                // Insert the bulk actions\n                $('#completiontable_length').after(`<div class=\"d-flex align-items-center\" id=\"bulkactions\">\n                    <button class=\"btn btn-sm btn-danger iv-ml-1\" id=\"bulkdelete\">\n                        <i class=\"bi bi-trash3 iv-mr-1 fs-unset\"></i>${M.util.get_string('delete', 'mod_interactivevideo')}\n                         (${selectedRows.count()})\n                    </button>\n                    </div>`);\n            }\n        });\n\n        $('#filterregion :input:not([type=date])').on('keyup change', function() {\n            let index = $(this).data('index');\n            let value = $(this).val();\n            if (typeof value !== 'string') {\n                value = value.join('|');\n            }\n            // Split the input by '|' and remove any empty terms.\n            let regex = value.split('|').map(term => term.trim()).filter(term => term.length > 0).join('|');\n            // Use regex mode (true) and disable smart searching (false).\n            tabledata.column(index).search(regex, true, false).draw();\n        });\n\n        $('#filterregion :input[type=date].custom-field').on('change', function() {\n            let index = $(this).data('index');\n            $.fn.dataTable.ext.search.push(function(settings, data) {\n                if (settings.nTable.id !== 'completiontable') {\n                    return true;\n                }\n                let start = $(`#filter-${index}-start`).val();\n                if (start !== '') {\n                    // Append the start of the day to the date.\n                    start = new Date(start);\n                    start.setHours(0, 0, 0);\n                }\n                let end = $(`#filter-${index}-end`).val();\n                if (end !== '') {\n                    // Append the end of the day to the date.\n                    end = new Date(end);\n                    end.setHours(23, 59, 59);\n                }\n                let value = data[index];\n                if (isNaN(value) || value == '') {\n                    value = 0;\n                }\n                value = value * 1000;\n                if ((start !== '' || end !== '') && value == 0) {\n                    return false;\n                }\n                if ((start === '' && end === '')\n                    || (start === '' && value <= new Date(end).getTime())\n                    || (end === '' && value >= new Date(start).getTime())\n                    || (value >= new Date(start).getTime() && value <= new Date(end).getTime())) {\n                    return true;\n                }\n                return false;\n            });\n            tabledata.draw();\n        });\n\n        $('#reporttable th#timecreated input').on('click', function(e) {\n            e.stopPropagation();\n            let index = columns.findIndex(x => x.data === 'timecreated');\n            let started = $('th#timecreated input[data-start=true]').is(':checked');\n            let notstarted = $('th#timecreated input[data-start=false]').is(':checked');\n            if (started && notstarted) {\n                tabledata.column(index).search('', true, false).draw();\n            } else if (started) {\n                // Filter by timecreated that is not 0.\n                tabledata.column(index).search('^(?!0$)', true, false).draw();\n            } else if (notstarted) {\n                // Filter by timecreated that is 0.\n                tabledata.column(index).search('^0$', true, false).draw();\n            } else {\n                tabledata.column(index).search('-', true, false).draw();\n            }\n        });\n\n        $('#reporttable th#timecompleted input').on('click', function(e) {\n            e.stopPropagation();\n            let index = columns.findIndex(x => x.data === 'timecompleted');\n            let inprogress = $('th#timecompleted input[data-completed=false]').is(':checked');\n            let completed = $('th#timecompleted input[data-completed=true]').is(':checked');\n            if (inprogress && completed) {\n                tabledata.column(index).search('', true, false).draw();\n            } else if (inprogress) {\n                // Filter by timecompleted that is 0.\n                tabledata.column(index).search('^0$', true, false).draw();\n            } else if (completed) {\n                // Filter by timecompleted that is not 0.\n                tabledata.column(index).search('^(?!0$)', true, false).draw();\n            } else {\n                tabledata.column(index).search('-', true, false).draw();\n            }\n        });\n\n        $('#reporttable th[data-type] input').on('click', function(e) {\n            e.stopPropagation();\n            let index = columns.findIndex(x => x.itemid == $(this).data('item'));\n            if ($(this).is(':checked')) {\n                // Filter this column by not equal to -.\n                tabledata.column(index).search('^(?!-$)', true, false).draw();\n            } else {\n                tabledata.column(index).search('', true, false).draw();\n            }\n        });\n\n        $('#reporttable th#completionpercentage input').on('click', function(e) {\n            e.stopPropagation();\n            let $this = $(this);\n            $.fn.dataTable.ext.search.push(function(settings, data) {\n                if (settings.nTable.id !== 'completiontable') {\n                    return true;\n                }\n                let index = columns.findIndex(x => x.data === 'completionpercentage');\n                let percent = $this.data('percentage');\n                let showless = $('th#completionpercentage input.less').is(':checked');\n                let showmore = $('th#completionpercentage input.more').is(':checked');\n                let value = data[index];\n                value = parseInt(value.replace('%', ''));\n                if (showless && showmore) {\n                    return true;\n                } else if (showless) {\n                    return value < percent;\n                } else if (showmore) {\n                    return value >= percent;\n                } else {\n                    return false;\n                }\n            });\n            tabledata.draw();\n        });\n\n        // Filter by timecreated range.\n        $('#filterregion #timecreatedrange input').on('change', function() {\n            $.fn.dataTable.ext.search.push(function(settings, data) {\n                if (settings.nTable.id !== 'completiontable') {\n                    return true;\n                }\n                let start = $('#timecreatedstart').val();\n                if (start !== '') {\n                    // Append the start of the day to the date.\n                    start = new Date(start);\n                    start.setHours(0, 0, 0);\n                }\n                let end = $('#timecreatedend').val();\n                if (end !== '') {\n                    // Append the end of the day to the date.\n                    end = new Date(end);\n                    end.setHours(23, 59, 59);\n                }\n                let index = columns.findIndex(x => x.data === 'timecreated');\n                let value = data[index];\n                if ((start !== '' || end !== '') && value == 0) {\n                    return false;\n                }\n                if ((start === '' && end === '')\n                    || (start === '' && value <= new Date(end).getTime())\n                    || (end === '' && value >= new Date(start).getTime())\n                    || (value >= new Date(start).getTime() && value <= new Date(end).getTime())) {\n                    return true;\n                }\n                return false;\n            }\n            );\n            tabledata.draw();\n        });\n\n        // Filter by timecompleted range.\n        $('#filterregion #timecompletedrange input').on('change', function() {\n            $.fn.dataTable.ext.search.push(function(settings, data) {\n                if (settings.nTable.id !== 'completiontable') {\n                    return true;\n                }\n                let start = $('#timecompletedstart').val();\n                if (start !== '') {\n                    // Append the start of the day to the date.\n                    start = new Date(start);\n                    start.setHours(0, 0, 0);\n                }\n                let end = $('#timecompletedend').val();\n                if (end !== '') {\n                    // Append the end of the day to the date.\n                    end = new Date(end);\n                    end.setHours(23, 59, 59);\n                }\n                let index = columns.findIndex(x => x.data === 'timecompleted');\n                let value = data[index];\n                if ((start !== '' || end !== '') && value == 0) {\n                    return false;\n                }\n                if ((start === '' && end === '')\n                    || (start === '' && value <= new Date(end).getTime())\n                    || (end === '' && value >= new Date(start).getTime())\n                    || (value >= new Date(start).getTime() && value <= new Date(end).getTime())) {\n                    return true;\n                }\n                return false;\n            }\n            );\n            tabledata.draw();\n        });\n\n        // Right-click on data-cell to delete completion data for specific user and specific item.\n        $(document).on('click', 'td.data-cell .delete-cell', function(e) {\n            e.preventDefault();\n            if (access.canedit != 1) {\n                return;\n            }\n            let $this = $(this).closest('td');\n            let itemid = $this.data('item');\n            if ($this.text() === '-' || $this.text() === '') {\n                return;\n            }\n            let userid = $this.closest('tr').attr('id');\n            let userfullname = data.find(x => x.id == userid).fullname;\n            let recordid = $this.closest('tr').find('td').eq(0).find('button').data('record');\n            let cellIndex = $this.index();\n            let title = $this.closest('table').find('th').eq(cellIndex).text();\n\n            const deleteCompletionData = async() => {\n                let theAnnotation = itemsdata.find(x => x.id == itemid);\n                const module = relContentTypeAmd[theAnnotation.type];\n                if (module.deleteCompletionData(recordid, itemid, userid)) {\n                    let targetdata = tabledata.row($this.closest('tr')).data();\n                    targetdata.completeditems = JSON.stringify(\n                        JSON.parse(targetdata.completeditems).filter(x => x.id != itemid));\n                    let completiondetails = JSON.parse(targetdata.completiondetails);\n                    completiondetails = completiondetails.map(x => {\n                        x = JSON.parse(x);\n                        if (x.id == itemid) {\n                            x.hasDetails = true;\n                            x.deleted = true;\n                            x.reportView = '<i class=\"bi bi-trash3 text-danger\"></i>';\n                        }\n                        return JSON.stringify(x);\n                    });\n                    targetdata.completiondetails = JSON.stringify(completiondetails);\n                    tabledata.row($this.closest('tr')).data(targetdata).draw();\n                    addToast(M.util.get_string('completedeletedforthisitem', 'mod_interactivevideo', {\n                        item: title,\n                        user: userfullname\n                    }), {\n                        type: 'success'\n                    });\n                } else {\n                    addToast(M.util.get_string('completionreseterror', 'mod_interactivevideo'), {\n                        type: 'error'\n                    });\n                }\n            };\n\n            try {\n                Notification.deleteCancelPromise(\n                    M.util.get_string('deletecompletion', 'mod_interactivevideo'),\n                    M.util.get_string('deleterecordforitemforuserconfirm', 'mod_interactivevideo', {\n                        item: title,\n                        user: userfullname\n                    }),\n                    M.util.get_string('delete', 'mod_interactivevideo')\n                ).then(async() => {\n                    return deleteCompletionData();\n                }).catch(() => {\n                    return;\n                });\n            } catch { // Fallback for older versions of Moodle.\n                Notification.saveCancel(\n                    M.util.get_string('deletecompletion', 'mod_interactivevideo'),\n                    M.util.get_string('deleterecordforitemforuserconfirm', 'mod_interactivevideo', {\n                        item: title,\n                        user: userfullname\n                    }),\n                    M.util.get_string('delete', 'mod_interactivevideo'),\n                    function() {\n                        return deleteCompletionData();\n                    }\n                );\n            }\n        });\n\n        initonreport.forEach((type) => {\n            let module = relContentTypeAmd[type];\n            if (module) {\n                module.init();\n                return;\n            }\n            let matchingContentTypes = contentTypes.find(x => x.name === type);\n            let amdmodule = matchingContentTypes.amdmodule;\n            require([amdmodule], function(Module) {\n                new Module(player, itemsdata, cmid, courseid, null,\n                    completionpercentage, null, grademax, videotype, null,\n                    end - start, start, end, null, cm).init();\n            });\n        });\n    });\n\n    $(document).on('click', '[data-item] a', async function() {\n        const convertSecondsToHMS = (seconds) => {\n            const h = Math.floor(seconds / 3600);\n            const m = Math.floor(seconds % 3600 / 60);\n            const s = Math.floor(seconds % 3600 % 60);\n            return (h > 0 ? h + ':' : '') + (m < 10 ? '0' : '') + m + ':' + (s < 10 ? '0' : '') + s;\n        };\n        let annotationid = $(this).closest('th').data('item');\n        let theAnnotation = itemsdata.find(x => x.id == annotationid);\n        let tabledatajson = tabledata.rows().data().toArray();\n        let title = theAnnotation.formattedtitle;\n        if (theAnnotation.timestamp > 0) {\n            title += \" @ \" + convertSecondsToHMS(theAnnotation.timestamp);\n        }\n\n        $('#annotation-modal').remove();\n        let modal = await ModalFactory.create({\n            body: `<div class=\"modal-body loader\"></div>`,\n            large: true,\n            show: false,\n            removeOnClose: true,\n            isVerticallyCentered: true,\n        });\n\n        let root = modal.getRoot();\n        root.attr({\n            'id': 'annotation-modal',\n            'data-id': theAnnotation.id,\n        });\n\n        if ($('body').hasClass('iframe')) {\n            root.addClass('modal-fullscreen');\n        }\n\n        root.find('.modal-dialog').attr({\n            'data-id': theAnnotation.id,\n            'data-placement': 'popup',\n            'id': 'message',\n        }).addClass('active ' + theAnnotation.type);\n        root.find('#message').html(`<div class=\"modal-content iv-rounded-lg\">\n                <div class=\"modal-header d-flex align-items-center shadow-sm\" id=\"title\">\n                    <h5 class=\"modal-title text-truncate mb-0\">${title}</h5>\n                    <div class=\"btns d-flex align-items-center\">\n                        <button id=\"close-${theAnnotation.id}\" class=\"btn close-modal p-0 border-0\"\n                         aria-label=\"Close\" data${isBS5 ? '-bs' : ''}-dismiss=\"modal\">\n                        <i class=\"bi bi-x-lg fa-fw fs-25px\"></i>\n                        </button>\n                    </div>\n                </div>\n                <div class=\"modal-body\" id=\"content\">\n                <div class=\"loader w-100 mt-5\"></div>\n                </div>\n                </div>\n            </div>`);\n\n        root.find('#message').on('click', '#close-' + theAnnotation.id, function() {\n            root.attr('data-region', 'modal-container');\n            root.fadeOut(300, function() {\n                modal.hide();\n            });\n        });\n\n        root.off(ModalEvents.hidden).on(ModalEvents.hidden, function() {\n            $('#annotation-modal').modal('hide');\n            $('#annotation-modal').remove();\n        });\n\n        // If click outside the modal, add jelly animation.\n        root.off('click').on('click', function(e) {\n            if ($(e.target).closest('.modal-content').length === 0) {\n                root.addClass('jelly-anim');\n            }\n        });\n\n        // When modal is shown, resolve the promise.\n        root.off(ModalEvents.shown).on(ModalEvents.shown, function() {\n            root.attr('data-region', 'popup'); // Must set to avoid dismissing the modal when clicking outside.\n            setTimeout(() => {\n                root.addClass('jelly-anim');\n            }, 10);\n\n            $('#annotation-modal .modal-body').fadeIn(300);\n            let module = relContentTypeAmd[theAnnotation.type];\n            if (module) {\n                module.displayReportView(theAnnotation, tabledatajson, DataTable);\n            } else {\n                let matchingContentTypes = contentTypes.find(x => x.name === theAnnotation.type);\n                let amdmodule = matchingContentTypes.amdmodule;\n                require([amdmodule], function(Module) {\n                    theAnnotation.completed = true;\n                    new Module(player, itemsdata, cmid, courseid, null,\n                        completionpercentage, null, grademax, videotype, null,\n                        end - start, start, end, theAnnotation.prop, cm).displayReportView(theAnnotation, tabledatajson, DataTable);\n                });\n            }\n            $(this).find('.close-modal').focus();\n            root.find('.modal-body').removeClass('loader');\n        });\n\n        root.on('animationend', function() {\n            root.removeClass('jelly-anim');\n        });\n\n        modal.show();\n    });\n\n    // Delete single completion record.\n    $(document).on('click', 'td .reset', function(e) {\n        e.preventDefault();\n        const recordid = $(this).data('record');\n        let $this = $(this);\n        const deleteSingle = async() => {\n            return $.ajax({\n                url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                method: 'POST',\n                dataType: \"text\",\n                data: {\n                    action: 'delete_progress_by_id',\n                    recordid,\n                    courseid: courseid,\n                    cmid: cmid,\n                    contextid: M.cfg.contextid,\n                    sesskey: M.cfg.sesskey,\n                },\n                success: function(response) {\n                    if (response == 'deleted') {\n                        let targetdata = tabledata.row($this.closest('tr')).data();\n                        targetdata.completionpercentage = 0;\n                        targetdata.timecompleted = 0;\n                        targetdata.xp = 0;\n                        targetdata.timecreated = 0;\n                        targetdata.completeditems = null;\n                        targetdata.completiondetails = null;\n                        targetdata.completionid = null;\n                        tabledata.row($this.closest('tr')).data(targetdata).draw();\n                        addToast(M.util.get_string('completionresetsuccess', 'mod_interactivevideo'), {\n                            type: 'success'\n                        });\n                    }\n                },\n                error: function() {\n                    addToast(M.util.get_string('completionreseterror', 'mod_interactivevideo'), {\n                        type: 'error'\n                    });\n                }\n            });\n        };\n        try {\n            Notification.deleteCancelPromise(\n                M.util.get_string('deletecompletion', 'mod_interactivevideo'),\n                M.util.get_string('areyousureyouwanttoresetthecompletiondata', 'mod_interactivevideo'),\n                M.util.get_string('delete', 'mod_interactivevideo')\n            ).then(() => {\n                return deleteSingle();\n            }).catch(() => {\n                return;\n            });\n        } catch { // Fallback for older versions of Moodle.\n            Notification.saveCancel(\n                M.util.get_string('deletecompletion', 'mod_interactivevideo'),\n                M.util.get_string('areyousureyouwanttoresetthecompletiondata', 'mod_interactivevideo'),\n                M.util.get_string('delete', 'mod_interactivevideo'),\n                function() {\n                    return deleteSingle();\n                }\n            );\n        }\n    });\n\n    // Delete multiple completion records.\n    $(document).on('click', '#bulkdelete', function() {\n        let selectedRows = tabledata.rows({selected: true});\n        let selectedData = selectedRows.data().toArray();\n        let selectedIds = selectedData.map(x => x.completionid);\n        let selectedUsers = selectedData.map(x => x.id);\n        const bulkDeleteCompletionData = async() => {\n            return $.ajax({\n                url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                method: 'POST',\n                dataType: \"text\",\n                data: {\n                    action: 'delete_progress_by_ids',\n                    completionids: selectedIds.join(','),\n                    courseid: courseid,\n                    cmid: cmid,\n                    contextid: M.cfg.contextid,\n                    sesskey: M.cfg.sesskey,\n                },\n                success: function(response) {\n                    if (response == 'deleted') {\n                        selectedRows.every(function() {\n                            let targetdata = this.data();\n                            targetdata.completionpercentage = 0;\n                            targetdata.timecompleted = 0;\n                            targetdata.xp = 0;\n                            targetdata.timecreated = 0;\n                            targetdata.completeditems = null;\n                            targetdata.completiondetails = null;\n                            targetdata.completionid = null;\n                            tabledata.row(this.node()).data(targetdata);\n                            return true;\n                        });\n                        tabledata.draw();\n                        addToast(M.util.get_string('completionresetsuccess', 'mod_interactivevideo'), {\n                            type: 'success'\n                        });\n                    }\n                },\n                error: function() {\n                    addToast(M.util.get_string('completionreseterror', 'mod_interactivevideo'), {\n                        type: 'error'\n                    });\n                }\n            });\n        };\n        try {\n            Notification.deleteCancelPromise(\n                M.util.get_string('deletecompletion', 'mod_interactivevideo'),\n                M.util.get_string('deleterecordforselectedusers', 'mod_interactivevideo', selectedUsers.length),\n                M.util.get_string('delete', 'mod_interactivevideo')\n            ).then(async() => {\n                return bulkDeleteCompletionData();\n            }).catch(() => {\n                return;\n            });\n        } catch { // Fallback for older versions of Moodle.\n            Notification.saveCancel(\n                M.util.get_string('deletecompletion', 'mod_interactivevideo'),\n                M.util.get_string('deleterecordforselectedusers', 'mod_interactivevideo', selectedUsers.length),\n                M.util.get_string('delete', 'mod_interactivevideo'),\n                function() {\n                    return bulkDeleteCompletionData();\n                }\n            );\n        }\n    });\n\n    $(document).on('click', 'td .completion-detail', function() {\n        let id = $(this).closest('td').data('item');\n        let userid = $(this).closest('tr').attr('id');\n        let type = $(this).closest('td').data('type');\n        let theAnnotation = itemsdata.find(x => x.id == id);\n        let module = relContentTypeAmd[type];\n        if (module) {\n            module.getCompletionData(theAnnotation, userid);\n            return;\n        }\n        let matchingContentTypes = contentTypes.find(x => x.name === type);\n        let amdmodule = matchingContentTypes.amdmodule;\n        // Get column header with the item id.\n        require([amdmodule], function(Module) {\n            new Module(player, itemsdata, cmid, courseid, null,\n                completionpercentage, null, grademax, videotype, null,\n                end - start, start, end, theAnnotation.prop, cm).getCompletionData(theAnnotation, userid);\n        });\n    });\n};\n\n\n/**\n * Renders annotation logs in a DataTable with specified options.\n *\n * @param {Object} data - The data to be displayed in the table.\n * @param {Array} data.rows - The rows of data to be displayed.\n * @param {string} node - The DOM node selector where the table will be rendered.\n * @param {string} title - The title used for export options.\n */\nconst renderAnnotationLogs = (data, node, title) => {\n    let tableOptions = {\n        \"data\": data.rows,\n        \"deferRender\": true,\n        \"pageLength\": 25,\n        \"order\": [[0, \"asc\"]],\n        \"columnDefs\": [\n            {\n                \"targets\": 'not-sortable',\n                \"sortable\": false,\n            },\n        ],\n        \"pagingType\": \"full\",\n        \"language\": {\n            \"lengthMenu\": \"_MENU_\",\n            \"zeroRecords\": M.util.get_string('nofound', \"mod_interactivevideo\"),\n            \"search\": `<span class=\"d-none d-md-inline\">${M.util.get_string('search', \"mod_interactivevideo\")}</span>`,\n            \"info\": M.util.get_string('datatableinfo', \"mod_interactivevideo\"),\n            \"infoEmpty\": M.util.get_string('datatableinfoempty', \"mod_interactivevideo\"),\n            \"infoFiltered\": M.util.get_string('datatableinfofiltered', \"mod_interactivevideo\"),\n            \"paginate\": {\n                \"first\": '<i class=\"bi bi-chevron-double-left fs-unset\"></i>',\n                \"last\": '<i class=\"bi bi-chevron-double-right fs-unset\"></i>',\n                \"next\": '<i class=\"bi bi-chevron-right fs-unset\"></i>',\n                \"previous\": '<i class=\"bi bi-chevron-left fs-unset\"></i>'\n            },\n            \"select\": {\n                rows: {\n                    _: M.util.get_string('rowsselected', 'mod_interactivevideo'),\n                }\n            }\n        },\n        stateSaveParams: function(settings, data) {\n            // We only want to save the state of the colvis and length menu\n            data.search.search = \"\";\n            data.start = 0;\n            data.columns.forEach(function(column) {\n                column.search.search = \"\";\n            });\n            return data;\n        },\n        stateSave: true,\n        \"dom\": `Blft<'row'<'col-sm-6'i><'col-sm-6'p>>`,\n        \"buttons\": [\n            {\n                extend: \"copyHtml5\",\n                text: '<i class=\"bi bi-copy fa-fw fs-unset\"></i>',\n                className: \"btn btn-sm border-0\",\n                messageTop: null,\n                title: null,\n                exportOptions: {\n                    columns: ['.exportable'],\n                    format: {\n                        body: function(data) {\n                            // Remove any HTML tags from the data.\n                            const text = document.createElement(\"div\");\n                            text.innerHTML = data;\n                            return text.textContent.replace(/\\n/g, ' ').replace(/\\t/g, ' ').replace(/\\r/g, ' ');\n                        }\n                    }\n                }\n            },\n            {\n                extend: \"csvHtml5\",\n                text: '<i class=\"bi bi-filetype-csv fa-fw fs-unset\"></i>',\n                title: title,\n                className: \"btn btn-sm border-0\",\n                exportOptions: {\n                    columns: ['.exportable']\n                }\n            },\n            {\n                extend: \"excelHtml5\",\n                text: '<i class=\"bi bi-file-earmark-excel fa-fw fs-unset\"></i>',\n                className: \"btn btn-sm border-0\",\n                title: title,\n                exportOptions: {\n                    columns: ['.exportable']\n                }\n            }\n        ],\n        \"initComplete\": function() {\n            $(`${node} table`)\n                .wrap(\"<div style='overflow:auto;position:relative;width:100%' class='completiontablewrapper'></div>\");\n            $(`${node} .dataTables_length`).addClass(\"d-inline iv-ml-1\");\n            $(`${node} .dataTables_filter`).addClass(\"d-inline iv-float-right\");\n            $(`${node} .table-responsive`).addClass(\"p-1\");\n        }\n    };\n\n    $(`${node} table`).DataTable(tableOptions);\n};\n\nexport {\n    init,\n    renderAnnotationLogs\n};"],"names":["async","cmid","groupid","grademax","itemids","completionpercentage","videourl","videotype","cm","courseid","start","end","posterimage","name","access","window","JSZip","DataTable","$","fn","dataTable","isBS5","hasClass","ModalFactory","error","require","show","getReportData","ajax","url","M","cfg","wwwroot","method","data","action","sesskey","contextid","ctxid","courseContextId","itemsdata","text","JSON","parse","contentTypes","initonreport","filter","x","prop","Set","map","type","tabledata","relContentTypeAmd","when","done","value","index","self","findIndex","t","loadPromises","contentType","Promise","resolve","amdmodule","Module","player","all","hasCompletion","some","timecreated","profileFields","customProfileFields","customfields","reduce","acc","val","concat","undefined","each","pr","this","attr","length","customField","find","shortname","replace","push","exportOptions","columns","format","body","div","document","createElement","innerHTML","textContent","innerText","trim","header","querySelector","remove","visible","className","render","row","fullname","deletebutton","canedit","util","get_string","completionid","id","$identitycolumn","$this","fieldtype","date","Date","toLocaleString","getTime","datatableOptions","c","rows","_","select","style","selector","stateSaveParams","settings","search","forEach","column","stateSave","extend","messageTop","title","titleAttr","footerCallback","api","rowCount","count","findColIndex","col","timecreatedIdx","timecompletedIdx","completionpercentageIdx","xpIdx","countTimecreated","timecreatedPerc","toFixed","countTimecompleted","timecompletedPerc","xpData","toArray","parseFloat","minXP","Math","min","maxXP","max","avgXp","cpData","minCp","maxCp","avgCp","footer","itemid","itemIdx","itemPerc","completiondetails","e","details","Number","deleted","$reportTable","removeClass","addClass","wrap","fadeOut","insertAfter","off","on","slideToggle","toggleClass","hide","element","input","options","sort","join","optionsc","renderFilterBox","appendTo","select2","dropdownParent","width","placeholder","allowClear","evt","target","parents","append","tooltip","toString","ctype","sortable","rtype","reportView","module","res","theAnnotation","renderReportView","hasDetails","td","$tfoot","$tr","$td","deselect","stopImmediatePropagation","selectedRows","selected","every","node","after","regex","split","term","draw","ext","nTable","setHours","isNaN","stopPropagation","started","is","notstarted","inprogress","completed","percent","showless","showmore","parseInt","preventDefault","closest","userid","userfullname","recordid","eq","cellIndex","deleteCompletionData","targetdata","completeditems","stringify","item","user","deleteCancelPromise","then","catch","saveCancel","init","annotationid","tabledatajson","formattedtitle","timestamp","seconds","h","floor","m","s","convertSecondsToHMS","modal","create","large","removeOnClose","isVerticallyCentered","root","getRoot","html","ModalEvents","hidden","shown","setTimeout","fadeIn","displayReportView","focus","deleteSingle","dataType","success","response","timecompleted","xp","selectedData","selectedIds","selectedUsers","bulkDeleteCompletionData","completionids","getCompletionData","tableOptions"],"mappings":"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"}