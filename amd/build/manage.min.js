var _systemImportTransformerGlobalIdentifier="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:{};
/**
 * TODO describe module manage
 *
 * @module     mod_interactivevideo/manage
 * @copyright  2025 Sokunthearith Makara <sokunthearithmakara@gmail.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */define("mod_interactivevideo/manage",["jquery"],(function($){return{settings:async function(courseid,coursecontextid,userid){let addToast=await("function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["core/toast"],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require("core/toast")):Promise.resolve(_systemImportTransformerGlobalIdentifier["core/toast"])),DynamicForm=await("function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["core_form/dynamicform"],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require("core_form/dynamicform")):Promise.resolve(_systemImportTransformerGlobalIdentifier["core_form/dynamicform"])),string=await("function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["core/str"],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require("core/str")):Promise.resolve(_systemImportTransformerGlobalIdentifier["core/str"]));$(document).ready((function(){const selector=document.querySelector("#region-main-box #settings"),settingform=new DynamicForm(selector,"mod_interactivevideo\\form\\settings_form");settingform.addEventListener(settingform.events.FORM_SUBMITTED,(e=>{e.preventDefault(),addToast.add(string.get_string("settingssaved","mod_interactivevideo"),{type:"success"})})),settingform.addEventListener(settingform.events.CANCEL_BUTTON_PRESSED,(e=>{e.preventDefault(),settingform.load({courseid:courseid,contextid:coursecontextid,userid:userid,action:"reset"}),addToast.add(string.get_string("formvaluesarereset","mod_interactivevideo"),{type:"info"})}))}))},list:async function(courseid,coursecontextid){let ModalForm,str,addToast=await("function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["core/toast"],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require("core/toast")):Promise.resolve(_systemImportTransformerGlobalIdentifier["core/toast"])),JSZip=await("function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["mod_interactivevideo/libraries/jszip"],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require("mod_interactivevideo/libraries/jszip")):Promise.resolve(_systemImportTransformerGlobalIdentifier["mod_interactivevideo/libraries/jszip"]));window.JSZip=JSZip,await("function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["mod_interactivevideo/libraries/jquery.dataTables"],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require("mod_interactivevideo/libraries/jquery.dataTables")):Promise.resolve(_systemImportTransformerGlobalIdentifier["mod_interactivevideo/libraries/jquery.dataTables"])),await("function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["mod_interactivevideo/libraries/dataTables.bootstrap4"],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require("mod_interactivevideo/libraries/dataTables.bootstrap4")):Promise.resolve(_systemImportTransformerGlobalIdentifier["mod_interactivevideo/libraries/dataTables.bootstrap4"])),await("function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["mod_interactivevideo/libraries/dataTables.buttons"],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require("mod_interactivevideo/libraries/dataTables.buttons")):Promise.resolve(_systemImportTransformerGlobalIdentifier["mod_interactivevideo/libraries/dataTables.buttons"])),await("function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["mod_interactivevideo/libraries/buttons.html5"],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require("mod_interactivevideo/libraries/buttons.html5")):Promise.resolve(_systemImportTransformerGlobalIdentifier["mod_interactivevideo/libraries/buttons.html5"])),await("function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["mod_interactivevideo/libraries/dataTables.select"],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require("mod_interactivevideo/libraries/dataTables.select")):Promise.resolve(_systemImportTransformerGlobalIdentifier["mod_interactivevideo/libraries/dataTables.select"])),await("function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["mod_interactivevideo/libraries/select.bootstrap4"],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require("mod_interactivevideo/libraries/select.bootstrap4")):Promise.resolve(_systemImportTransformerGlobalIdentifier["mod_interactivevideo/libraries/select.bootstrap4"])),await("function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["mod_interactivevideo/libraries/buttons.bootstrap4"],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require("mod_interactivevideo/libraries/buttons.bootstrap4")):Promise.resolve(_systemImportTransformerGlobalIdentifier["mod_interactivevideo/libraries/buttons.bootstrap4"])),await("function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["mod_interactivevideo/libraries/buttons.colVis"],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require("mod_interactivevideo/libraries/buttons.colVis")):Promise.resolve(_systemImportTransformerGlobalIdentifier["mod_interactivevideo/libraries/buttons.colVis"])),await("function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["mod_interactivevideo/libraries/dataTables.rowGroup"],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require("mod_interactivevideo/libraries/dataTables.rowGroup")):Promise.resolve(_systemImportTransformerGlobalIdentifier["mod_interactivevideo/libraries/dataTables.rowGroup"])),await("function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["mod_interactivevideo/libraries/select2"],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require("mod_interactivevideo/libraries/select2")):Promise.resolve(_systemImportTransformerGlobalIdentifier["mod_interactivevideo/libraries/select2"]));let data=$("#listdata").text(),columns=[{data:"id",className:"w-0 exportable checkbox",render:function(data,type,row){return'<input type="checkbox" class="checked" value="'.concat(row.id,'">')},createdCell:function(td,cellData){$(td).data("id",cellData)},title:'<span class="sr-only">ID</span><input type="checkbox" id="select-all"/>'},{data:null,className:"w-0 actions nosort",render:function(data,type,row){let retrn='<div class="actions-wrapper d-flex flex-column">';return row.edit&&(retrn+='<a href="javascript:void(0)" data-href="'.concat(M.cfg.wwwroot,"/course/modedit.php?update=").concat(row.id,'"\n                             class="p-1 iv_quickform" data-contextid="').concat(row.contextid,'" data-cmid="').concat(row.id,'"\n                              data-interaction="').concat(row.instance,'" data-courseid="').concat(row.courseid,'"\n                              data-toggle="tooltip" data-placement="right" data-html="true"\n                              title="').concat(M.util.get_string("edit","mod_interactivevideo"),'">\n                             <i class="fa fa-edit" aria-hidden="true"></i></a>')),row.editinteraction&&(retrn+='<a href="'.concat(M.cfg.wwwroot,"/mod/interactivevideo/interactions.php?id=").concat(row.id,'" target="_blank"\n                            class="p-1" data-toggle="tooltip" data-placement="right"\n                             title="').concat(M.util.get_string("interactions","mod_interactivevideo"),'">\n                             <i class="fa fa-bullseye" aria-hidden="true"></i></a>')),row.report&&(retrn+='<a href="'.concat(M.cfg.wwwroot,"/mod/interactivevideo/report.php?id=").concat(row.id,'" target="_blank"\n                             data-title="').concat(row.title,'"\n                             data-href="').concat(M.cfg.wwwroot,"/mod/interactivevideo/report.php?id=").concat(row.id,'"\n                              data-toggle="tooltip" data-placement="right" data-html="true"\n                             title="').concat(M.util.get_string("report","mod_interactivevideo"),'"\n                             class="p-1 launch-report"><i class="fa fa-table" aria-hidden="true"></i></a>')),retrn+"</div>"}},{data:"instance",className:"d-none",render:function(data,type,row){return'<a href="'.concat(row.editurl,'" title="').concat(row.title,'">').concat(row.id,"</a>")}},{data:null,className:"poster exportable",render:function(data,type,row){return"display"===type?'<div class="wrapper d-flex flex-row align-items-start">\n                                <div class="cursor-pointer poster-wrapper"\n                         data-id="'.concat(row.id,'" data-instance="').concat(row.instance,'">\n                                    <img src="').concat(row.posterimage,'"\n                                        alt="').concat(row.title,'"\n                                        class="poster-image ').concat(row.squareposter,'"\n                                        loading="lazy">\n                                    <div class="poster-overlay w-100 h-100 position-absolute">\n                                        <i class="fa fa-play text-white fa-2x"></i>\n                                        </div>\n                                </div>\n                                <a href="').concat(M.cfg.wwwroot+"/mod/interactivevideo/view.php?id="+row.id,'" target="_blank" class="title font-weight-bold py-2 px-3"\n                                      title="').concat(row.title,'">').concat(row.title,"</a>\n                                </div>"):row.title}},{data:"title",className:"d-none title exportable",render:function(data){return data}},{data:"sectionnum",className:"d-none w-0 exportable"},{data:"type",className:"w-0 type exportable"},{data:"view",className:"w-0 view exportable"},{data:"duration",className:"w-0 exportable",render:function(data,type){if("display"===type){let seconds=Math.round(data),hours=Math.floor(seconds/3600);hours=hours>=10?hours:"0"+hours;let minutes=Math.floor((seconds-3600*hours)/60);minutes=minutes>=10?minutes:"0"+minutes;let remainingSeconds=seconds-3600*hours-60*minutes;return remainingSeconds=remainingSeconds>=10?remainingSeconds:"0"+remainingSeconds,"".concat(hours,":").concat(minutes,":").concat(remainingSeconds)}return data}},{data:"xp",className:"w-0 exportable"},{data:"count",className:"w-0 exportable"}],activitytypes=JSON.parse(data)[0].activitycount;activitytypes=activitytypes.map((x=>x.name)),activitytypes.sort(),activitytypes.forEach((x=>{columns.push({data:null,className:"bg-light exportable "+x,render:function(row){return row.activitycount.find((a=>a.name==x)).count},createdCell:function(td){$(td).text()>0&&$(td).addClass("alert-success")}})})),columns.push({data:"sectionname",className:"d-none sectionname w-0 exportable"}),columns.push({data:"url",className:"exportable",render:function(data){return'<a href="'.concat(data,'" target="_blank">').concat(data,"</a>")}});let Modal,Templates,datatable=$("#videolist").DataTable({dom:"<'d-flex w-100 justify-content-between'<'d-flex align-items-start'Bl>'<'d-flex align-items-start'f>><'row mt-2 top'<'col-sm-6'i><'col-sm-6 d-flex justify-content-end'p>>t<'row mt-2'<'col-sm-6'i><'col-sm-6 d-flex justify-content-end'p>>",buttons:[{extend:"copyHtml5",text:'<i class="bi bi-copy fa-fw fs-unset"></i>',className:"btn btn-sm border-0",messageTop:null,title:null,exportOptions:{columns:[".exportable"],format:{body:function(data){const div=document.createElement("div");return div.innerHTML=data,(div.textContent||div.innerText||"").trim()}}}},{extend:"csvHtml5",text:'<i class="bi bi-filetype-csv fa-fw fs-unset"></i>',className:"btn btn-sm border-0",exportOptions:{columns:[".exportable"],format:{body:function(data){const div=document.createElement("div");return div.innerHTML=data,(div.textContent||div.innerText||"").trim()}}}},{extend:"excelHtml5",text:'<i class="bi bi-file-earmark-excel fa-fw fs-unset"></i>',className:"btn btn-sm border-0",exportOptions:{columns:[".exportable"],format:{body:function(data){const div=document.createElement("div");return div.innerHTML=data,(div.textContent||div.innerText||"").trim()}}}}],initComplete:function(){$("table#videolist").wrap("<div style='overflow:auto;position:relative' class='tablewrapper'></div>"),$("#list .dataTables_length").addClass("d-inline ml-1"),$("#list .dataTables_filter").addClass("d-inline float-right"),$("#list .table-responsive").addClass("p-1"),$("#list .spinner-grow").remove(),$("table#videolist").removeClass("d-none"),$("#background-loading").fadeOut(300),function(){const tabledata=$("#videolist").DataTable();let sectionname=[],videotype=[];const sectionnameIndex=$("#videolist thead th.sectionname").index();sectionname=tabledata.column(sectionnameIndex).data().unique().sort();const videotypeIndex=$("#videolist thead th.type").index();videotype=tabledata.column(videotypeIndex).data().unique().sort(),$('<a class="btn rounded-sm btn-secondary font-weight-bold ml-1" href="javascript:void(0)"\n                     id="filters" title="'.concat(M.util.get_string("filters","mod_interactivevideo"),'">\n                     <i class="fa fa-filter"></i></a>')).insertAfter("#videolist_filter"),$(".btn#filters").on("click",(function(){$(".search-container").slideToggle("fast","swing")})),$('<div class="bg-light rounded hide mb-0 search-container w-100 p-3" id="video-filters">\n                    <div class="px-0 form-group form-group-sm font-size-sm form-row pt-1 w-100 mb-0">\n                    <div class="col-4 mb-1 title">\n                        <label class="small text-muted d-block">'.concat(M.util.get_string("title","mod_interactivevideo"),'</label>\n                        <input type="text" class="form-control form-control-sm mb-1 w-100" data-col="title">\n                    </div>\n                    <div class="col-4 mb-1 sectionname">\n                        <label class="small text-muted d-block">').concat(M.util.get_string("section","mod_interactivevideo"),'</label>\n                        <select class="custom-select custom-select-sm mb-1 w-100" data-col="sectionname" multiple>\n                        ').concat(sectionname.map((section=>'<option value="'.concat(section,'">').concat(section,"</option>"))).join(""),'\n                        </select>\n                    </div>\n                    <div class="col-4 mb-1 type">\n                        <label class="small text-muted d-block">').concat(M.util.get_string("type","mod_interactivevideo"),'</label>\n                        <select class="custom-select custom-select-sm mb-1 w-100" data-col="type" multiple>\n                        ').concat(videotype.map((type=>'<option value="'.concat(type,'">').concat(type,"</option>"))).join(""),"\n                        </select>\n                        </div>\n                    </div>\n                </div>")).insertBefore(".row.top"),$("#video-filters .custom-select[multiple]").select2({dropdownParent:$("body")}),$(".custom-select").on("select2:open",(function(e){const evt="scroll.select2";$(e.target).parents().off(evt),$(window).off(evt)}))}()},deferRender:!0,rowId:"id",pageLength:10,order:[[5,"asc"]],pagingType:"full",language:{lengthMenu:"_MENU_",zeroRecords:M.util.get_string("nofound","mod_interactivevideo"),search:'<span class="d-none d-md-inline">'.concat(M.util.get_string("search","mod_interactivevideo"),"</span>"),info:M.util.get_string("datatableinfo","mod_interactivevideo"),infoEmpty:M.util.get_string("datatableinfoempty","mod_interactivevideo"),infoFiltered:M.util.get_string("datatableinfofiltered","mod_interactivevideo"),paginate:{first:'<i class="bi bi-chevron-double-left fs-unset"></i>',last:'<i class="bi bi-chevron-double-right fs-unset"></i>',next:'<i class="bi bi-chevron-right fs-unset"></i>',previous:'<i class="bi bi-chevron-left fs-unset"></i>'},select:{rows:{_:M.util.get_string("rowsselected","mod_interactivevideo")}}},select:{style:"multi",selector:'td:first-child input[type="checkbox"]'},data:JSON.parse(data),rowGroup:{dataSrc:"sectionname"},columnDefs:[{orderable:!1,targets:[0,1]}],orderFixed:[5,"asc"],columns:columns});$("#video-filters input, #video-filters select").on("keyup change",(function(){let col=$(this).data("col"),val=$(this).val(),isArray=Array.isArray(val);val.length>0?(isArray&&(val=val.join("|")),datatable.column(".".concat(col)).search(val,!0,!1)):datatable.column(".".concat(col)).search("",!0,!1),datatable.draw()})),datatable.on("draw",(function(){$("tr.selected td.checkbox input").prop("checked",!0),$("tr:not(.selected) td.checkbox input").prop("checked",!1)})),datatable.on("search",(function(){$("#select-all").prop("checked",!1),datatable.rows().deselect()})),$(document).on("click","#select-all",(function(){$(this).prop("checked")?(datatable.rows({search:"applied"}).select(),$("td.checkbox input").prop("checked",!0)):(datatable.rows({search:"applied"}).deselect(),$("td.checkbox input").prop("checked",!1))})),datatable.on("select deselect",(function(e){e.stopImmediatePropagation();var selectedRows=datatable.rows({selected:!0});selectedRows.every((function(){var row=this.node();return $(row).find("td:first-child input").prop("checked",!0),!0}));var deselectedRows=datatable.rows({selected:!1});deselectedRows.every((function(){var row=this.node();return $(row).find("td:first-child input").prop("checked",!1),!0})),0===deselectedRows.count()&&$("#select-all").prop("checked",!0),(0===selectedRows.count()||selectedRows.count()<datatable.rows({search:"applied"}).count())&&$("#select-all").prop("checked",!1),selectedRows.count()>0?($("#bulkactions").remove(),$("#videolist_length").after('<div class="d-flex align-items-center" id="bulkactions"><button type="button"\n                        class="btn btn-sm btn-secondary ml-1" id="bulkreset">\n                        '.concat(M.util.get_string("resetsettings","mod_interactivevideo"),'</button>\n                        <button type="button"\n                        class="btn btn-sm btn-secondary ml-1" id="bulkappearance">\n                        ').concat(M.util.get_string("appearancesettings","mod_interactivevideo"),'</button>\n                        <button type="button"\n                        class="btn btn-sm btn-secondary ml-1" id="bulkbehavior">\n                        ').concat(M.util.get_string("behaviorsettings","mod_interactivevideo"),"</button>\n                        </div>"))):$("#bulkactions").remove()})),$(document).on("click","#bulkreset, #bulkappearance, #bulkbehavior",(async function(){let $this=$(this);ModalForm||(ModalForm=await("function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["core_form/modalform"],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require("core_form/modalform")):Promise.resolve(_systemImportTransformerGlobalIdentifier["core_form/modalform"]))),str||(str=await("function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["core/str"],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require("core/str")):Promise.resolve(_systemImportTransformerGlobalIdentifier["core/str"])));let selectedRows=datatable.rows({selected:!0}),ids=[];selectedRows.every((function(){return ids.push(this.data().id),!0}));let bulkdata={courseid:courseid,cmids:ids.join(","),contextid:coursecontextid};bulkdata.action=$this.attr("id").replaceAll("bulk","");let form=new ModalForm({formClass:"mod_interactivevideo\\form\\reset_form",args:bulkdata,modalConfig:{title:M.util.get_string("reset","mod_interactivevideo"),removeOnClose:!0}});form.show(),form.addEventListener(form.events.FORM_SUBMITTED,(e=>{e.stopImmediatePropagation(),addToast.add(str.get_string("settingssaved","mod_interactivevideo"),{type:"success"});let results=e.detail;if("reset"===bulkdata.action||"appearance"===bulkdata.action){let page=datatable.page();results.forEach((result=>{if(result.displayoptions){let displayoptions=JSON.parse(result.displayoptions),newdata=datatable.row("#".concat(result.id)).data();newdata.squareposter=1==displayoptions.squareposterimage?"square":"",newdata.posterimage=result.posterimage,datatable.row("#".concat(result.id)).data(newdata).draw()}})),datatable.page(page).draw(!1)}}))})),$(document).on("click",".checked",(function(){$(this).prop("checked")?datatable.row($(this).closest("tr")).select():datatable.row($(this).closest("tr")).deselect()})),$(document).on("click",".launch-report",(async function(e){e.preventDefault();const href=$(this).data("href");let $this=$(this);Templates||(Templates=await("function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["core/templates"],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require("core/templates")):Promise.resolve(_systemImportTransformerGlobalIdentifier["core/templates"])));const data={id:"reportModal",title:M.util.get_string("reportfor","mod_interactivevideo",$this.data("title")),body:'<iframe src="'.concat(href,'&embed=1"\n                                    style="width: 100%; height: 100%; border: 0; z-index:1050; position:absolute;"></iframe>')};Modal=await Templates.render("mod_interactivevideo/fullscreenmodal",data),$("body").append(Modal),$("#reportModal").modal("show"),$("#reportModal").on("shown.bs.modal",(function(){$(this).focus()})),$("#reportModal").on("hidden.bs.modal",(function(){$(this).remove()}))})),$(document).on("click",".poster-wrapper",(async function(e){e.preventDefault();const modal='<div class="modal fade p-0" id="posterModal" tabindex="-1" role="dialog">\n                    <div class="modal-dialog modal-xl modal-dialog-centered" role="document">\n                        <div class="modal-content bg-black overflow-hidden border-0">\n                            <div class="modal-body position-relative">\n                            <div class="position-absolute w-100 h-100 no-pointer bg-transparent"\n                                id="background-loading">\n                                <div class="d-flex h-100 align-items-center justify-content-center">\n                                    <div class="spinner-border text-danger"\n                                        style="width: 3rem;\n                                                height: 3rem"\n                                        role="status">\n                                        <span class="sr-only">Loading...</span>\n                                    </div>\n                                </div>\n                            </div>\n                            <iframe src="'.concat(M.cfg.wwwroot,"/mod/interactivevideo/view.php?id=").concat($(this).data("id"),'&embed=1&dm=1&df=1&preview=1"\n                             class="w-100 h-100 border-0 position-absolute" style="z-index:1050"></iframe>\n                            </iframe>\n                            </div>\n                        </div>\n                    </div>\n                    </div>');$("body").append(modal),$("#posterModal").modal("show"),$("#posterModal").on("hidden.bs.modal",(function(){$(this).remove()}))})),$(document).on("click",".iv_quickform",(async function(e){const $this=$(this);e.preventDefault();let formdata={contextid:$(this).data("contextid"),cmid:$(this).data("cmid"),courseid:$(this).data("courseid"),interaction:$(this).data("interaction")};ModalForm||(ModalForm=await("function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["core_form/modalform"],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require("core_form/modalform")):Promise.resolve(_systemImportTransformerGlobalIdentifier["core_form/modalform"]))),str||(str=await("function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["core/str"],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require("core/str")):Promise.resolve(_systemImportTransformerGlobalIdentifier["core/str"])));let DynamicForm,form=new ModalForm({formClass:"mod_interactivevideo\\form\\quicksettings_form",args:formdata,modalConfig:{title:await str.get_string("quicksettings","mod_interactivevideo"),removeOnClose:!0}});form.show(),form.addEventListener(form.events.LOADED,(e=>{e.stopImmediatePropagation(),setTimeout((()=>{$(".modal-dialog").removeClass("modal-lg").addClass("modal-xl")}),1e3),setTimeout((async()=>{let strings=await str.get_strings([{key:"moresettings",component:"mod_interactivevideo"},{key:"resettodefaults",component:"mod_interactivevideo"}]);$('[data-region="footer"]').css("align-items","unset").prepend('<span class="btn btn-secondary mr-1 default" title="'.concat(strings[1],'">\n                                <i class="fa fa-refresh"></i></span>\n                                <a type="button" class="btn btn-secondary mr-auto" target="_blank" data-dismiss="modal"\n                                 title="').concat(strings[0],'"\n                                 href="').concat(M.cfg.wwwroot,"/course/modedit.php?update=").concat(formdata.cmid,'"><i class="fa fa-cog"></i>\n                                 </a>'))}),2e3)})),form.addEventListener(form.events.FORM_SUBMITTED,(e=>{e.stopImmediatePropagation(),addToast.add(str.get_string("settingssaved","mod_interactivevideo"),{type:"success"});let newdata=datatable.row($this.closest("tr")).data(),displayoptions=e.detail.displayoptions;displayoptions=JSON.parse(displayoptions),newdata.title=e.detail.name,newdata.squareposter=1==displayoptions.squareposterimage?"square":"",newdata.posterimage=e.detail.posterimage;let page=datatable.page();datatable.row($this.closest("tr")).data(newdata).draw(),datatable.page(page).draw(!1)})),$(document).off("click",".default").on("click",".default",(async function(e){e.preventDefault(),formdata.action="reset",DynamicForm||(DynamicForm=await("function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["core_form/dynamicform"],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require("core_form/dynamicform")):Promise.resolve(_systemImportTransformerGlobalIdentifier["core_form/dynamicform"]))),new DynamicForm(document.querySelector('[data-region="body"]'),"mod_interactivevideo\\form\\quicksettings_form").load(formdata),addToast.add(str.get_string("formvaluesarereset","mod_interactivevideo"),{type:"info"})}))}))}}}));

//# sourceMappingURL=manage.min.js.map